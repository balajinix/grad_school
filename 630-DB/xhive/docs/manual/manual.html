
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/><title><nobr>X-Hive/DB</nobr> 7.0 - Manual</title><link rel="stylesheet" type="text/css" href="./manual.css"/></head><body><div align="right"><a href="manual_simple.html" target="_top">no frames / simple design</a></div>
	





<div class="div1"><h1><nobr>X-Hive/DB</nobr> 7.0 - Manual</h1><h2>release 7.0.0 -  Oct 03 2005</h2><p>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/>
         <br/></p><p>Copyright © 2005 <a href="http://www.x-hive.com/" target="_new">
          <nobr>X-Hive</nobr> Corporation B.V.
        </a><sup>®</sup>, All Rights Reserved.</p><p>
	Rights to the content of this publication<br/>
	This publication contains proprietary information belonging to <nobr>X-Hive</nobr> Corporation. It may not be reproduced without written permission. Disclosure of the contents of this publication to third parties is strictly prohibited.
      </p><p>
	Trademarks<br/>
        <nobr>X-Hive</nobr> and <nobr>X-Hive/DB</nobr> are registered trademarks of <nobr>X-Hive</nobr> Corporation. All other company or product names used in this publication are trademarks of their respective owners.
      </p><p>
	<nobr>X-Hive/DB</nobr> includes software developed by the Apache Software Foundation (<a href="http://www.apache.org" target="_new">http://www.apache.org</a>).
      </p></div>
	
	
	<div class="div1"><h2><a name="toc">Table of Contents</a></h2><p class="toc">1 <a href="#introduction">Introduction</a><br/>    1.1 <a href="#what_is_this">What is this?</a><br/>    1.2 <a href="#who_is_this_manual_for">Who is this manual for?</a><br/>    1.3 <a href="#manual_structure">How is this manual structured?</a><br/>    1.4 <a href="#how_to_use_this_manual">How to use this manual?</a><br/>    1.5 <a href="#conventions">Conventions</a><br/>        1.5.1 <a href="#terminology">Terminology</a><br/>        1.5.2 <a href="#text_usage">Text usage</a><br/>    1.6 <a href="#support_and_feedback">Support and feedback</a><br/>2 <a href="#quickstart">Quickstart</a><br/>    2.1 <a href="#pre_installation">Pre-installation</a><br/>    2.2 <a href="#installing_xhivedb">Installing <nobr>X-Hive/DB</nobr></a><br/>    2.3 <a href="#creating_a_database">Creating a database</a><br/>    2.4 <a href="#running_a_sample">Running a sample</a><br/>3 <a href="#general_info">General information</a><br/>    3.1 <a href="#gen_info_what_is_xhive_db">What is <nobr>X-Hive/DB</nobr>?</a><br/>    3.2 <a href="#gen_info_tech_behind_xhive">The technology behind <nobr>X-Hive/DB</nobr></a><br/>        3.2.1 <a href="#dom_support_data_manip">DOM support and data manipulation</a><br/>        3.2.2 <a href="#searching_indexing">Searching, linking and indexing</a><br/>        3.2.3 <a href="#transaction_control">Session and transaction control</a><br/>        3.2.4 <a href="#admin_features">Administration features</a><br/>        3.2.5 <a href="#import_from_dbs_and_file_sys">Import from non-XML resources and storage of BLOBs</a><br/>        3.2.6 <a href="#transform_xml_using_xslt">Transform XML into various outputs</a><br/>        3.2.7 <a href="#versioning">Versioning</a><br/>    3.3 <a href="#xhive_db_architecture"><nobr>X-Hive/DB</nobr> logical architecture</a><br/>        3.3.1 <a href="#federated_database">Federated database</a><br/>        3.3.2 <a href="#databases">Databases</a><br/>        3.3.3 <a href="#users_user_list">Users and user lists</a><br/>        3.3.4 <a href="#groups_group_lists">Groups and group lists</a><br/>        3.3.5 <a href="#indexes_index_lists">Indexes and index lists</a><br/>        3.3.6 <a href="#libraries">Libraries</a><br/>        3.3.7 <a href="#catalogs_dtds">Catalogs and DTDs and XML Schemas</a><br/>        3.3.8 <a href="#documents">Documents</a><br/>        3.3.9 <a href="#super_user">Super user</a><br/>4 <a href="#installing">Installing <nobr>X-Hive/DB</nobr></a><br/>    4.1 <a href="#installation_requirements">Installation requirements</a><br/>        4.1.1 <a href="#things_to_check_before_installation">Things to check before installation</a><br/>            4.1.1.1 <a href="#supported_platforms">Supported platforms</a><br/>            4.1.1.2 <a href="#system_requirements">System requirements</a><br/>            4.1.1.3 <a href="#java_settings">Java settings</a><br/>        4.1.2 <a href="#things_to_do_before_installation">Things to do before installation</a><br/>            4.1.2.1 <a href="#log_in_as_administrator">Log in as an administrator</a><br/>    4.2 <a href="#installation_procedure">Installation - Windows</a><br/>        4.2.1 <a href="#run_the_installation_program">Run the installation program</a><br/>    4.3 <a href="#unix_installation">Installation - UNIX</a><br/>        4.3.1 <a href="#unix_installation_step1">Starting the installation</a><br/>        4.3.2 <a href="#unix_installation_step2">Entering installation parameters</a><br/>        4.3.3 <a href="#unix_installation_step3">Performing post-installation steps</a><br/>    4.4 <a href="#verify_the_installation">Verify the installation</a><br/>    4.5 <a href="#running_the_sample">Running the samples</a><br/>        4.5.1 <a href="#create_a_database">Create a database</a><br/>        4.5.2 <a href="#execute_sample">Execute the samples</a><br/>    4.6 <a href="#uninstalling">Uninstalling <nobr>X-Hive/DB</nobr></a><br/>    4.7 <a href="#configuring_xhive_bootstrap_property">Configuring the xhive.bootstrap property</a><br/>    4.8 <a href="#using_java_command_line">Using the Java command line instead of xhive-ant</a><br/>    4.9 <a href="#dedicated_server">The <nobr>X-Hive/DB</nobr> dedicated server process</a><br/>        4.9.1 <a href="#dedicated_server_configuring">Configuration of the server</a><br/>        4.9.2 <a href="#command_xhstartserver">XHStartServer</a><br/>        4.9.3 <a href="#command_xhstopserver">XHStopServer</a><br/>5 <a href="#creating">Creating applications</a><br/>    5.1 <a href="#creating_introduction">Introduction</a><br/>    5.2 <a href="#creating_create_a_database">Create a database</a><br/>        5.2.1 <a href="#d1e2456">Creating a database using XHCreateDB
			</a><br/>        5.2.2 <a href="#d1e2510">Creating a database using the adminclient</a><br/>        5.2.3 <a href="#d1e2542">Creating a database using API functions</a><br/>    5.3 <a href="#connect_to_the_database">Connect to the database</a><br/>    5.4 <a href="#using_sessions_and_transactions">Use sessions and transactions</a><br/>    5.5 <a href="#create_library">Create libraries</a><br/>    5.6 <a href="#parse_xml_documents">Parse XML documents</a><br/>    5.7 <a href="#validate_xml_documents">Validate XML documents</a><br/>    5.8 <a href="#store_xml_documents">Store XML documents</a><br/>    5.9 <a href="#dom_configuration">DOM configuration settings</a><br/>        5.9.1 <a href="#dom_configuration_deviations">Deviations from specification</a><br/>        5.9.2 <a href="#dom_configuration_additions">Aditional parameters</a><br/>    5.10 <a href="#load_save_parse_with_context">Parse documents with context</a><br/>    5.11 <a href="#store_blobs">Store BLOBs</a><br/>    5.12 <a href="#import_nonxml_data_from_external_sources">Import non-XML data</a><br/>    5.13 <a href="#create_document">Create documents</a><br/>    5.14 <a href="#retrieve_xml_documents">Retrieve XML documents and document parts</a><br/>        5.14.1 <a href="#retrieve_xml_documents_dom_operations">Through DOM operations</a><br/>        5.14.2 <a href="#retrieve_xml_documents_document_id">By document ID</a><br/>        5.14.3 <a href="#retrieve_xml_documents_document_name">By document name</a><br/>        5.14.4 <a href="#retrieve_xml_documents_executeFullPathXPointerQuery">Using the executeFullPathXPointerQuery() method</a><br/>        5.14.5 <a href="#retrieve_xml_documents_xpath">Using XQuery, XPath and XPointer</a><br/>        5.14.6 <a href="#retrieve_xml_documents_index">Using a Context Conditioned Index</a><br/>    5.15 <a href="#use_xquery">Use XQuery</a><br/>    5.16 <a href="#use_xpath_xpointer">Use XPath and XPointer</a><br/>        5.16.1 <a href="#xpath">XPath</a><br/>        5.16.2 <a href="#xpointer">XPointer</a><br/>        5.16.3 <a href="#xpath_xpointer_namespaces">Working with namespaces</a><br/>    5.17 <a href="#indexing">Use indexes</a><br/>        5.17.1 <a href="#indexing_library_indexes">Library id indexes</a><br/>        5.17.2 <a href="#indexing_library_indexes_name">Library name indexes</a><br/>        5.17.3 <a href="#indexing_id_attribute_indexes">Id attribute indexes</a><br/>        5.17.4 <a href="#indexing_element_name_indexes">Element name indexes</a><br/>        5.17.5 <a href="#indexing_value_indexes">Value indexes</a><br/>        5.17.6 <a href="#indexing_full_text_indexes">Full text indexes</a><br/>        5.17.7 <a href="#indexing_context_conditioned_indexes">Context conditioned indexes</a><br/>            5.17.7.1 <a href="#indexing_creating_index_node_filter">Creating index node filters</a><br/>    5.18 <a href="#traverse_xml_documents">Traverse XML documents</a><br/>        5.18.1 <a href="#traversal_dom_operation">Using DOM operations</a><br/>        5.18.2 <a href="#traversal_dom_traversal">Through DOM Traversal</a><br/>        5.18.3 <a href="#traversal_function_objects">Using function objects</a><br/>    5.19 <a href="#export_xml_documents">Export XML documents</a><br/>    5.20 <a href="#publish_xml_documents">Publish XML documents</a><br/>        5.20.1 <a href="#publish_using_xslt">Publish using XSLT</a><br/>        5.20.2 <a href="#publish_to_pdf">Publish to PDF</a><br/>    5.21 <a href="#use_xlink">Use XLink</a><br/>    5.22 <a href="#use_as_models">Use abstract schemas</a><br/>    5.23 <a href="#Revalidation_document_schema">Revalidate documents with XML schema</a><br/>    5.24 <a href="#use_psvi_interfaces">Access PSVI information</a><br/>    5.25 <a href="#manage_users_and_groups">Manage users and groups</a><br/>    5.26 <a href="#use_versioning">Use versioning</a><br/>        5.26.1 <a href="#use_versioning_check_out_in">Working with versioned documents</a><br/>        5.26.2 <a href="#use_versioning_retrieving_versions">Retrieving (older) versions of documents</a><br/>        5.26.3 <a href="#use_versioning_branching">Branching</a><br/>    5.27 <a href="#use_metadata">Using metadata on library children</a><br/>    5.28 <a href="#use_jaas">Using JAAS to connect to the database</a><br/>6 <a href="#sessions">Using Sessions &amp; Locking</a><br/>    6.1 <a href="#session_objects">Working with sessions</a><br/>        6.1.1 <a href="#sessions_flow">The session lifecycle</a><br/>            6.1.1.1 <a href="#session_createsession">XhiveDriverIf.createSession()</a><br/>            6.1.1.2 <a href="#session_join">join()</a><br/>            6.1.1.3 <a href="#session_leave">leave()</a><br/>            6.1.1.4 <a href="#session_connect">connect()</a><br/>            6.1.1.5 <a href="#session_begin">begin()</a><br/>            6.1.1.6 <a href="#session_commit">commit()</a><br/>            6.1.1.7 <a href="#session_rollback">rollback()</a><br/>            6.1.1.8 <a href="#session_checkpoint">checkpoint()</a><br/>            6.1.1.9 <a href="#session_disconnect">disconnect()</a><br/>            6.1.1.10 <a href="#session_terminate">terminate()</a><br/>        6.1.2 <a href="#sessions_and_objects">Sessions and references to database objects</a><br/>    6.2 <a href="#sessions_visibility">Sessions and transaction isolation</a><br/>    6.3 <a href="#sessions_locking">Sessions and locking</a><br/>        6.3.1 <a href="#session_locks_table">What gets locked when?</a><br/>        6.3.2 <a href="#sessions_locking_what_happens"><nobr>X-Hive/DB</nobr> behavior when a locking conflict occurs</a><br/>        6.3.3 <a href="#sessions_readonly">Readonly transactions</a><br/>    6.4 <a href="#XHSessionInfo_tool">The XHSessionInfo tool</a><br/>7 <a href="#xquery">Using XQuery</a><br/>    7.1 <a href="#xquery_executing">Executing queries</a><br/>    7.2 <a href="#xquery_external_vars_funcs">External variables and functions</a><br/>    7.3 <a href="#xquery_accessing">Accessing documents and libraries</a><br/>    7.4 <a href="#xquery_model_discrepancies">Data model discrepancies</a><br/>    7.5 <a href="#xquery_impl">Current implementation</a><br/>        7.5.1 <a href="#d1e7794">XPath axes</a><br/>        7.5.2 <a href="#d1e7821">Module Imports</a><br/>        7.5.3 <a href="#d1e7878">Supported options and extension expressions (pragmata)</a><br/>        7.5.4 <a href="#xquery_updates">Update Syntax for XQuery</a><br/>        7.5.5 <a href="#xquery_order_by_proprietary">Conditional Order By</a><br/>        7.5.6 <a href="#xquery_extension_functions">Extension functions</a><br/>        7.5.7 <a href="#d1e8426">Namespace declarations</a><br/>        7.5.8 <a href="#d1e8463">Collation support</a><br/>        7.5.9 <a href="#d1e8496">Limitations</a><br/>    7.6 <a href="#xquery_indexes">Using indexes in XQuery</a><br/>        7.6.1 <a href="#d1e8665">Value and element name indexes</a><br/>        7.6.2 <a href="#d1e8773">Range queries</a><br/>        7.6.3 <a href="#d1e8809">Indexes on metadata</a><br/>        7.6.4 <a href="#d1e8839">Multiple indexes</a><br/>        7.6.5 <a href="#d1e8881">Using indexes to enhance order by performance</a><br/>    7.7 <a href="#xquery_type">Type information and XQuery</a><br/>    7.8 <a href="#xquery_misc">Miscellaneous performance tips</a><br/>    7.9 <a href="#xquery_fts">Full text searching</a><br/>        7.9.1 <a href="#d1e9202">xhive:fts function</a><br/>        7.9.2 <a href="#fts_syntax">Full text search query syntax</a><br/>        7.9.3 <a href="#d1e9253">Boolean queries</a><br/>        7.9.4 <a href="#d1e9298">Prefix search</a><br/>        7.9.5 <a href="#d1e9307">Phrase search</a><br/>        7.9.6 <a href="#d1e9319">Wildcards</a><br/>        7.9.7 <a href="#fts_tokenization">Tokenization</a><br/>        7.9.8 <a href="#fts_analyzer">The analyzer</a><br/>        7.9.9 <a href="#d1e9388">Examples</a><br/>        7.9.10 <a href="#d1e9403">Limitations</a><br/>8 <a href="#indexes">Using indexes</a><br/>    8.1 <a href="#indexes_library_indexes">Library indexes</a><br/>        8.1.1 <a href="#indexes_library_indexes_id">Library id indexes</a><br/>        8.1.2 <a href="#indexes_library_indexes_name">Library name indexes</a><br/>    8.2 <a href="#indexes_id_attribute_indexes">Id attribute indexes</a><br/>    8.3 <a href="#indexes_element_name_indexes">Element name indexes</a><br/>    8.4 <a href="#indexes_value_indexes">Value indexes</a><br/>        8.4.1 <a href="#indexes_value_indexes_type">Value Index Types</a><br/>    8.5 <a href="#indexes_path_indexes">Path indexes</a><br/>        8.5.1 <a href="#d1e10055">Path index specification syntax</a><br/>    8.6 <a href="#indexes_full_text_indexes">Full text indexes</a><br/>    8.7 <a href="#indexes_context_conditioned_indexes">Context conditioned indexes</a><br/>    8.8 <a href="#index_performance">Index performance</a><br/>        8.8.1 <a href="#index_performance_scope">Index scope</a><br/>        8.8.2 <a href="#index_performance_selectiveness">Index selectiveness</a><br/>        8.8.3 <a href="#index_performance_sortkeys">Index property: sorted keys</a><br/>        8.8.4 <a href="#index_performance_summary">Summary</a><br/>    8.9 <a href="#indexes_concurrent">Concurrent indexes</a><br/>9 <a href="#catalog">Using validation and the Catalog</a><br/>    9.1 <a href="#catalog_introduction">Introduction</a><br/>    9.2 <a href="#catalog_content">Catalog content</a><br/>        9.2.1 <a href="#catalog_location">Calalog location</a><br/>        9.2.2 <a href="#catalog_model_identification">Identification of XML Schema and DTD models</a><br/>        9.2.3 <a href="#catalog_managing_models">Managing models</a><br/>    9.3 <a href="#catalog_documents_link">Linking models to documents</a><br/>        9.3.1 <a href="#catalog_link_to_dtd">DTDs</a><br/>        9.3.2 <a href="#catalog_link_to_schema">XML Schema</a><br/>    9.4 <a href="#catalog_validated_parsing">Validated parsing</a><br/>        9.4.1 <a href="#catalog_validated_parsing_dtd">DTDs</a><br/>        9.4.2 <a href="#catalog_validated_parsing_schema">XML Schema</a><br/>    9.5 <a href="#catalog_validation">Validation</a><br/>        9.5.1 <a href="#catalog_validation_DTD">DTDs</a><br/>        9.5.2 <a href="#catalog_validation_schema">XML Schema</a><br/>    9.6 <a href="#catalog_PSVI">PSVI</a><br/>10 <a href="#performance">Performance</a><br/>    10.1 <a href="#internal_server">Internal server</a><br/>    10.2 <a href="#database_page_size">Database page size</a><br/>    10.3 <a href="#multiple_disks">Multiple disks</a><br/>    10.4 <a href="#disk_write_caches">Disk write caches</a><br/>11 <a href="#internal_structure">Internal structure of <nobr>X-Hive/DB</nobr></a><br/>    11.1 <a href="#internal_architecture">Segments and files</a><br/>        11.1.1 <a href="#database_segments">Segments</a><br/>        11.1.2 <a href="#database_files">Files</a><br/>        11.1.3 <a href="#database_configurations">Setting up database configurations</a><br/>        11.1.4 <a href="#d1e11273">Log files</a><br/>    11.2 <a href="#database_configurationfiles">Database configuration files</a><br/>        11.2.1 <a href="#database_xhive-clustering_elem">xhive-clustering element</a><br/>        11.2.2 <a href="#database_config_segment_elem">segment element</a><br/>        11.2.3 <a href="#database_file_elem">file element</a><br/>12 <a href="#administering">Administering <nobr>X-Hive/DB</nobr></a><br/>    12.1 <a href="#starting_admin">Starting the adminclient</a><br/>    12.2 <a href="#admin_importing">Importing data</a><br/>    12.3 <a href="#admin_export_edit">Exporting and editing documents</a><br/>    12.4 <a href="#admin_indexes">Adding Indexes</a><br/>    12.5 <a href="#admin_querying">Querying</a><br/>    12.6 <a href="#create_federation">Creating a new federation</a><br/>    12.7 <a href="#creating_backup">Creating a backup</a><br/>        12.7.1 <a href="#d1e11988">Online ("hot") backups</a><br/>        12.7.2 <a href="#incremental_backups">Incremental backups</a><br/>        12.7.3 <a href="#xhbackup">The XHBackup tool</a><br/>        12.7.4 <a href="#d1e12183">Performance considerations</a><br/>        12.7.5 <a href="#restoring_database">Restoring backups</a><br/>        12.7.6 <a href="#xhrestore">The XHRestore tool</a><br/>        12.7.7 <a href="#d1e12279">Offline ("cold") backups</a><br/>        12.7.8 <a href="#suspend_disk_writes">Snapshot backups</a><br/>        12.7.9 <a href="#d1e12408">Storing individual libraries and documents</a><br/>    12.8 <a href="#using_ssl">Using Secure Socket Layer (SSL)</a><br/>        12.8.1 <a href="#d1e12525">Server side setup</a><br/>        12.8.2 <a href="#d1e12555">Client side setup</a><br/>    12.9 <a href="#readonly_federation">Readonly federations (CDROM usage)</a><br/>    12.10 <a href="#federation_sets">Federation sets</a><br/>        12.10.1 <a href="#d1e12642">Creating federation sets</a><br/>        12.10.2 <a href="#d1e12681">Using federation sets</a><br/>13 <a href="#replication">Replication</a><br/>    13.1 <a href="#replication_intro">Introduction</a><br/>    13.2 <a href="#replica_creation">Creating a replica</a><br/>    13.3 <a href="#running_replicator">Running a replicator</a><br/>        13.3.1 <a href="#replicator_dedicated">Dedicated server</a><br/>        13.3.2 <a href="#d1e12838">Internal server</a><br/>    13.4 <a href="#readonly_replicator_usage">Readonly usage of replicators</a><br/>        13.4.1 <a href="#replicator_temporary_data">Temporary data</a><br/>    13.5 <a href="#replica_removal">Removing a replica</a><br/>    13.6 <a href="#federation_metadata">Federation metadata</a><br/>        13.6.1 <a href="#replicated_metadata">Replicated metadata</a><br/>        13.6.2 <a href="#unreplicated_metadata">Metadata not replicated</a><br/>    13.7 <a href="#moving_master">Moving the master copy</a><br/>        13.7.1 <a href="#master_failure">Failure of the master server</a><br/>        13.7.2 <a href="#scheduled_moving">Scheduled moving of the master copy</a><br/></p><h3>Appendix</h3><p class="toc"/></div><div class="body">


	
<div class="div1">
	<h2><a name="introduction"/>1 Introduction</h2>
	<div class="div2">
		<h3><a name="what_is_this"/>1.1 What is this?</h3>
		<p>This manual is designed to provide a technical introduction to the <nobr>X-Hive/DB</nobr> product. This
manual describes all aspects of installing, configuring, programming with,
administering, and using <nobr>X-Hive/DB</nobr>.</p>
    <p>
      This manual contains the basic information on <nobr>X-Hive/DB</nobr>. There is also more detailed
      information on specific aspects of <nobr>X-Hive/DB</nobr>, and information on using <nobr>X-Hive/DB</nobr> combined
      with other tools. These 'Advanced Topics' can be found in the
      <a href="http://www.x-hive.com/documentation" target="_new">Documentation Extras</a>
      section on our
      <a href="http://support.x-hive.com" target="_new">support site</a>.
    </p>
	</div>
	<div class="div2">
		<h3><a name="who_is_this_manual_for"/>1.2 Who is this manual for?</h3>
		<p>This manual is for all users of <nobr>X-Hive/DB</nobr>, and assumes that you have knowledge of:</p>
		<ul>
			<li>
				<p>Java.</p>
			</li>
			<li>
				<p>XML.</p>
			</li>
			<li>
				<p>The operating system that you are using.</p>
			</li>
			<li>
				<p>Basic database principles such as transactions, locking, and access rights.</p>
			</li>
		</ul>
		<p>Furthermore, some knowledge of the following subjects is recommended, but not necessary:</p>
		<ul>
			<li>
				<p>DOM.</p>
			</li>
			<li>
				<p>XQuery</p>
			</li>
			<li>
				<p>XSLT.</p>
			</li>
		</ul>
	</div>
	<div class="div2">
		<h3><a name="manual_structure"/>1.3 How is this manual structured?</h3>
		<p>This manual is structured in a way that provides basic and essential information first, and then moves on to more advanced topics. This enables you to get started quickly with <nobr>X-Hive/DB</nobr>.</p>
		<p>
			<a href="#quickstart" target="">Quickstart</a> gives you an overview of the essential steps you need to perform to install and set up <nobr>X-Hive/DB</nobr> on your system. It gives you enough information to reach a point where you have installed <nobr>X-Hive/DB</nobr>, created your first database, and learned how to use the sample files provided with the product. These sample files illustrate the key concepts of <nobr>X-Hive/DB</nobr> functionality.</p>
		<p>
			<a href="#general_info" target="">General information</a>  describes the architecture of <nobr>X-Hive/DB</nobr>, and provides information on the concepts that you need to understand when using the product. These concepts cover both XML in general and specific issues that relate to <nobr>X-Hive/DB</nobr>.</p>
		<p>
			<a href="#installing" target="">Installing <nobr>X-Hive/DB</nobr></a> gives instructions on how to prepare your system for installing the product, and describes the actions you need to perform when running the installation program.</p>
		<p>
			<a href="#creating" target="">Creating applications</a> gives you instructions on how to develop <nobr>X-Hive/DB</nobr> applications, moving from basic tasks such as programming a transaction to advanced techniques such as using versioning, XLink and content models.</p>
		<p>
			<a href="#sessions" target="">Using Sessions (and Locking)</a> explains in detail the features and issues of the <nobr>X-Hive/DB</nobr> transaction model.</p>
		<p>
			<a href="#xquery" target="">Using XQuery</a> explains in detail how to use XQuery within <nobr>X-Hive/DB</nobr>.</p>
		<p>
			<a href="#indexes" target="">Using Indexes</a> describes how you can use one of <nobr>X-Hive/DB</nobr>'s indexing methods to enhance the performance of your <nobr>X-Hive/DB</nobr> application.</p>
		<p>
			<a href="#catalog" target="">Using the Catalog and DTDs</a> describes how <nobr>X-Hive/DB</nobr> deals with DTDs.</p>
		<p>
			<a href="#internal_structure" target="">Internal Structure of <nobr>X-Hive/DB</nobr></a> gives advanced information on the physical data-structure of <nobr>X-Hive/DB</nobr>.</p>
		<p>
			<a href="#administering" target="">Administering <nobr>X-Hive/DB</nobr></a> describes the tasks you need to perform as a database administrator in <nobr>X-Hive/DB</nobr>. The information provided includes basic tasks such as creating users, and also deals with more advanced topics such as backing up a database.</p>
	</div>
	<div class="div2">
		<h3><a name="how_to_use_this_manual"/>1.4 How to use this manual?</h3>
		<p>It is recommended that you read this manual chapter by chapter, as this provides you with a logical progression through the concepts and tasks involved in using <nobr>X-Hive/DB</nobr>. This approach is especially important if you are using <nobr>X-Hive/DB</nobr> for the first time. However, if you are a first-time user, you may want to leave the later chapters (covering issues such as maintenance and optimization) until you have gained experience in the basic features of the product.</p>
		<p>If you are an experienced user of XML and <nobr>X-Hive/DB</nobr>, you may not need to read the <a href="#general_info" target="">General information</a> chapter in detail. However, it is recommended that you browse through the chapter before starting to use the product, because there are some changes in architecture as well as new functionality in this release of <nobr>X-Hive/DB</nobr>.</p>
		<p>If you are an administrator, the <a href="#administering" target="">Administering <nobr>X-Hive/DB</nobr></a> chapter should be of particular interest. However, all users may find essential information in this chapter.</p>
	</div>
	<div class="div2">
		<h3><a name="conventions"/>1.5 Conventions</h3>
		<p>To ensure clarity and consistency, this manual uses various conventions in the areas of terminology and text usage.</p>
		<div class="div3">
			<h4><a name="terminology"/>1.5.1 Terminology</h4>
			<p>Unless otherwise stated, the product and the application refer to the <nobr>X-Hive/DB</nobr> application.</p>
			<p>The adminclient is a front-end component of   <nobr>X-Hive/DB</nobr> that gives easy access to administration features, such as user management. The administrator is the database administrator who uses the adminclient.</p>
			<p>In general, the <nobr>X-Hive/DB</nobr> API conforms to the coding standards supplied by <a href="http://www.sun.com" target="_new">Sun Microsystems</a>.</p>
		</div>
		<div class="div3">
			<h4><a name="text_usage"/>1.5.2 Text usage</h4>
			<p>Strings of literal code and command-line entries  appear in <code>courier font</code>. When
requested to enter such a string, enter the string exactly as it appears in the manual.</p>
			<p>Variable information appears in <var>italicized</var> text. Sometimes variables are located in the middle of
a literal string, in which case you must replace the italicized part with a suitable
value in that context.</p>
			<p>Sample code appears in a text box, like this:</p>
			<p>
				<div class="eg"><pre>
Here is where you
find sample code.
</pre></div>
			</p>
			<p>Sample code is provided to illustrate various programming concepts and techniques in <nobr>X-Hive/DB</nobr>. In most cases, the sample code included in the manual is available in sample files that are supplied with the product. If this is the case, the sample code in the manual is followed by a reference to the appropriate sample file.</p>
		</div>
	</div>
	<div class="div2">
		<h3><a name="support_and_feedback"/>1.6 Support and feedback</h3>
		<p><nobr>X-Hive</nobr> Corporation provides both telephone and e-mail technical support.</p>
		<p>We appreciate your feedback on this manual, and on any aspect  of the <nobr>X-Hive/DB</nobr> product. You can send your feedback by e-mail to <a href="mailto:product_strategy@x-hive.com" target="">product-dev@x-hive.com</a>.</p>
		<p>You can also access product information, browse FAQs, and submit questions through our Web site at <a href="http://www.x-hive.com" target="_new">www.x-hive.com</a>. Up-to-date technical information, including newer versions of and updates to this manual, can be found at <a href="http://support.x-hive.com/" target="_new">support.x-hive.com</a>.</p>
	</div>
</div>

	
<div class="div1">
	<h2><a name="quickstart"/>2 Quickstart</h2>
	<p>This section aims to get you started quickly with <nobr>X-Hive/DB</nobr>. It covers all the steps necessary to get <nobr>X-Hive/DB</nobr> running, from installation to creating a database to running your first sample. For more detailed information, consult the chapter <a href="#installing" target="">Installing <nobr>X-Hive/DB</nobr></a>.</p>
	<div class="div2">
		<h3><a name="pre_installation"/>2.1 Pre-installation</h3>
		<p>Before installing <nobr>X-Hive/DB</nobr>, be aware that:</p>
		<ul>
			<li>
        <p><nobr>X-Hive/DB</nobr> should run on any system that has a Java 1.4 installation.</p>
			</li>
			<li>
				<p>When installing on Windows 2000, you must be logged on as an administrator or a user with similar access.</p>
			</li>
			<li>
        <p><nobr>X-Hive/DB</nobr> requires a Sun JDK 1.4, or fully compatible Java Virtual Machine. You need to
          install the JDK before installing <nobr>X-Hive/DB</nobr>.</p>
			</li>
		</ul>
	</div>
	<div class="div2">
		<h3><a name="installing_xhivedb"/>2.2 Installing <nobr>X-Hive/DB</nobr></h3>
		<p>On Windows, simply run the <code>setup.exe</code> file and follow the instructions on screen. Besides installing the files in the proper directories, your <code>PATH</code> environment variable is augmented, and a page server service is started. If you have previous versions of <nobr>X-Hive/DB</nobr> running, ensure you uninstall them in the proper way or choose other directories and port-numbers. For more information, see the <a href="#uninstalling" target="">Uninstalling <nobr>X-Hive/DB</nobr></a> section. </p>
		<p>On  UNIX, start the distribution from the distribution directory, with the command 
			<code>sh setup.sh /</code><var>InstallationPath</var><code>/xhive</code>.</p>
		<p> The UNIX installation requires some post-installation steps, which are described in the <code>readme.txt</code> file of the distribution. You can install the <nobr>X-Hive/DB</nobr> program under any account.</p>	
	</div>
	<div class="div2">
		<h3><a name="creating_a_database"/>2.3 Creating a database</h3>
		<p>The first step after installing <nobr>X-Hive/DB</nobr> is creating a database.</p>
		<p>The easiest way to do this is through the <code>AdminClient</code>, as follows:</p>
				<ol>
			<li>
				<p>Start the <code>AdminClient</code> by running <code>XHAdmin</code>, which is located in the <code>bin</code> subdirectory of the <nobr>X-Hive/DB</nobr> target directory, and in the Start menu group of <nobr>X-Hive/DB</nobr> on Windows.</p>
			</li>
			<li>
				<p>Create a database by selecting the menu option Databases-&gt;Create database.</p>
			</li>
			<li>
				<p>Create a database named <code>united_nations</code> with the super user password as entered during installation of <nobr>X-Hive/DB</nobr> and
administrator password <code>northsea</code>. This database will be used by default in all samples described in this manual.</p>
			</li>
			<li>
				<p>After creating the database, you can close the administrator client. Note that you can also use the administrator client to view the data after you have run the samples, and to perform other actions.</p>
			</li>
		</ol>

		<p>Alternatively the command line tool <code>XHCreateDB</code> can be used to create databases.</p>
	</div>
	<div class="div2">
		<h3><a name="running_a_sample"/>2.4 Running a sample</h3>
		<p><nobr>X-Hive/DB</nobr> samples are run using the <code>ant</code> build system. A command line tool called <code>xhive-ant</code> is provided which sets the proper <code>CLASSPATH</code> and other parameters. The samples are run as follows:</p>
		                   <ol>
			<li>
				<p>Open a command prompt and go (<code>cd</code>) to the <var>XhiveDir</var><code>\bin</code> directory.</p>
			</li>
			<li>
				<p>To run a sample which inserts two documents into the database, enter the command:</p>
<div class="eg"><pre>
xhive-ant run-sample -Dname=manual.StoreDocuments
</pre></div>
				<p>On successful completion of the sample, a message appears stating the number of documents stored in the database.</p> 
			</li>
		</ol>

		<p>The sources of all the samples can be found in <var>XhiveDir</var><code>\src\samples\manual</code>. You should check the values of the properties in <code>SampleProperties.java</code>, so that they match your setttings, before running the samples.</p>
	</div>
</div>

	

<div class="div1">
	<h2><a name="general_info"/>3 General information</h2>
	<div class="div2">
		<h3><a name="gen_info_what_is_xhive_db"/>3.1 What is <nobr>X-Hive/DB</nobr>?</h3>
		<p><nobr>X-Hive/DB</nobr> is a database that enables high-speed storage and manipulation of very
large numbers of XML documents. Using <nobr>X-Hive/DB</nobr>, programmers can build custom XML
content management solutions that are fully tailored to the exact requirements of any
given application. <nobr>X-Hive/DB</nobr> stores XML documents in an
integrated, highly scalable, high-performance, object-oriented database. <nobr>X-Hive/DB</nobr>
exposes the database and its contents to the user via an application programming
interface (API). The API is written in Java.</p>
		<p><nobr>X-Hive/DB</nobr> implements (and extends) the following recommendations of the World-Wide
Web Consortium (W3C) for querying, retrieving, manipulating, and writing XML
documents:</p>
		<ul>
			<li>
				<p>
					<a href="http://www.w3.org/DOM/" target="_new">Document Object Model</a> (DOM) Level 1</p>
			</li>
			<li>
				<p>
					<a href="http://www.w3.org/DOM/" target="_new">DOM</a> Level 2 (Core and Traversal)</p>
			</li>
			<li>
        <p><a href="http://www.w3.org/DOM/" target="_new">DOM</a> Level 3 (implementation
          of Load/Save and Validation)</p>
			</li>
			<li>
				<p>
					<a href="http://www.w3.org/Style/XSL/" target="_new">The eXtensible Stylesheet Language - Transformation</a> (XSLT)</p>
			</li>
			<li>
				<p>
					<a href="http://www.w3.org/TR/XQuery" target="_new">XQuery</a>
				</p>
			</li>
			<li>
				<p>
					<a href="http://www.w3.org/TR/xpath" target="_new">XPath</a>
				</p>
			</li>
			<li>
				<p>
					<a href="http://www.w3.org/TR/xlink/" target="_new">XLink</a>
				</p>
			</li>
			<li>
				<p>
					<a href="http://www.w3.org/TR/xptr" target="_new">XPointer</a>
				</p>
			</li>
		</ul>
	</div>
	<div class="div2">
		<h3><a name="gen_info_tech_behind_xhive"/>3.2 The technology behind <nobr>X-Hive/DB</nobr></h3>
		<p>This section introduces the following technical aspects of <nobr>X-Hive/DB</nobr>:</p>
		<ul>
			<li>
				<p>
					<a href="#dom_support_data_manip" target="">DOM support and data manipulation</a>
				</p>
			</li>
			<li>
				<p>
					<a href="#searching_indexing" target="">Searching, linking and indexing</a>
				</p>
			</li>
			<li>
				<p>
					<a href="#transaction_control" target="">Session and transaction control</a>
				</p>
			</li>
			<li>
				<p>
					<a href="#admin_features" target="">Administration features</a>
				</p>
			</li>
			<li>
				<p>
					<a href="#import_from_dbs_and_file_sys" target="">Import from non-XML resources and storage of BLOBs</a>
				</p>
			</li>
			<li>
				<p>
					<a href="#transform_xml_using_xslt" target="">Transform XML into various outputs</a>
				</p>
			</li>
			<li>
				<p>
					<a href="#versioning" target="">Versioning</a>
				</p>
			</li>
		</ul>
		<div class="div3">
			<h4><a name="dom_support_data_manip"/>3.2.1 DOM support and data manipulation</h4>
			<p><nobr>X-Hive/DB</nobr> implements an extended DOM level 2 interface for manipulating the content,
structure, and style of documents. <nobr>X-Hive/DB</nobr> supports all DOM Level 2 functionality,
including functions for retrieval, modification and navigation within XML documents. DOM
level 2 does not support XML collections for handling more than one document, so
extended API functions in <nobr>X-Hive/DB</nobr> provide support for processing multiple documents
simultaneously.</p>
			<p>
				<nobr>X-Hive/DB</nobr> supports nested libraries. You can store libraries within other libraries in the same way that  you store documents within libraries. All operations on documents (incl. XQuery queries) can also be performed on libraries as they are implemented as DOM nodes.</p>
		</div>
		<div class="div3">
			<h4><a name="searching_indexing"/>3.2.2 Searching, linking and indexing</h4>
			<p>XML Query Language (XQuery) is a string syntax that you can use to address any piece of information in an XML document, make selections based on conditions, and even construct new structures based on queried information. This makes XQuery an extremely useful tool for searching in XML databases. <nobr>X-Hive/DB</nobr> includes an XQuery query engine implementation. For information on using XQuery, see <a href="#xquery" target="">Using XQuery</a>.</p>
			<p>Besides XQuery, we also have support for XPath and XPointer queries. For information on using XPath and XPointer, see <a href="#use_xpath_xpointer" target="">Use XPath and XPointer</a>.
			</p>
			<p>XLink is a W3C recommendation that enables links between XML documents. You can use XLink to create simple links equivalent to <code>&lt;a href&gt;</code> links in HTML, and to create more complex links, known as extended links. You can use extended links to, for example, create one-to-many links, and to add some semantic meaning to your links. For a complete and up-to-date description of XLink, refer to the <a href="http://www.w3.org/TR/xlink/" target="_new">XML Linking Language (XLink) Version 1.0
documentation</a> at the W3C website.</p>
			<p>Indexing enables faster access to parts of a library or document and increases the performance and scalability of <nobr>X-Hive/DB</nobr> applications. <nobr>X-Hive/DB</nobr> supports several different indexing methods: <a href="#indexes_context_conditioned_indexes" target="">Context Conditioned Indexing</a>, <a href="#indexes_library_indexes" target="">library id and library name indexing</a>, <a href="#indexes_id_attribute_indexes" target="">id attribute indexing</a>, <a href="#indexes_element_name" target="">element name indexing</a>, <a href="#indexes_value_indexes" target="">value indexing</a> and <a href="#indexes_full_text_indexes" target="">full text indexing</a>.</p>
		</div>
		<div class="div3">
			<h4><a name="transaction_control"/>3.2.3 Session and transaction control</h4>
			<p><nobr>X-Hive/DB</nobr> includes a transaction mechanism to ensure that changes and updates to the
database (the 'transactions') are completed harmoniously across the system. All transactions take place within a session that can be committed or rolled back if the transaction conflicts with other transactions.</p>
			<p>For instructions on how to use sessions and transactions in <nobr>X-Hive/DB</nobr>, see <a href="#using_sessions_and_transactions" target="">Using sessions &amp; transactions</a>.</p>
		</div>
		<div class="div3">
			<h4><a name="admin_features"/>3.2.4 Administration features</h4>
			<p>The administration features of <nobr>X-Hive/DB</nobr> enable the <nobr>X-Hive/DB</nobr> administrator to manage
user and user group permissions for access to documents and queries. An <a href="#administering" target="">administration
tool</a> (a.k.a. 'the adminclient') provides access to the administration features and also includes a data browser that displays the contents of the <nobr>X-Hive/DB</nobr> database using a tree-view. The administration features are also accessible through the API.</p>
		</div>
		<div class="div3">
			<h4><a name="import_from_dbs_and_file_sys"/>3.2.5 Import from non-XML resources and storage of BLOBs</h4>
			<p><nobr>X-Hive/DB</nobr> contains an SQL Loader that uses JDBC to import data stored in relational
databases. All JDBC-compliant RDBMSs are supported. Data in sequential files can also
be loaded into <nobr>X-Hive/DB</nobr> using the SQL Loader interface.</p>
			<p><nobr>X-Hive/DB</nobr> also contains an integrated version of the Xerces parser for importing XML
documents from files on the file system.</p>
			<p>More information on the import facilities of <nobr>X-Hive/DB</nobr> can be found in the <a href="#import_nonxml_data_from_external_sources" target="">Import non-XML data</a> section.</p>
			<p>Next to XML documents it is also possible to <a href="#store_blobs" target="">store Binary Large OBjects (BLOBs)</a> in <nobr>X-Hive/DB</nobr>.</p>
		</div>
		<div class="div3">
			<h4><a name="transform_xml_using_xslt"/>3.2.6 Transform XML into various outputs</h4>
			<p><nobr>X-Hive/DB</nobr> contains a transformation engine that uses XSLT. XSLT provides a declarative
means for transforming an XML source tree into any required result tree. This makes it
possible to transform XML into such formats as HTML or WML. Powerful publishing of XML
content on the Web (or for any device) invariably requires extensive use of XSLT.</p>
			<p>
				<nobr>X-Hive/DB</nobr> includes a special interface, <code>com.xhive.util.interfaces.XhiveFormatterIf</code>, 
			for producing formatted documents that are converted to PDF. You can either format an FO  document as a PDF string, or can transform an XML file into a FO document and then format it as a PDF string. For a detailed specification of the <code>formatAsPDF</code> method, refer to the <a href="#publish_xml_documents" target="">Publish XML documents</a> section.</p>
		</div>
		<div class="div3">
			<h4><a name="versioning"/>3.2.7 Versioning</h4>
			<p><nobr>X-Hive/DB</nobr> provides linear <a href="#use_versioning" target="">versioning</a> with branches. This feature enables the storage of multiple (older) versions of a document within the context of the document. Storing multiple versions of a document makes it easier to keep track of the changes in a document and to restore older versions when needed.</p>
		</div>
	</div>
	<div class="div2">
		<h3><a name="xhive_db_architecture"/>3.3 <nobr>X-Hive/DB</nobr> logical architecture</h3>
		<p>This section describes the logical architecture of <nobr>X-Hive/DB</nobr>. For an overview of the internal architecture of <nobr>X-Hive/DB</nobr>, go to the <a href="#internal_architecture" target="">Internal <nobr>X-Hive/DB</nobr> architecture</a> section.</p>
		<p>The following diagram provides an overview of the logical architecture of <nobr>X-Hive/DB</nobr>:</p>
		<div class="image"><img src="images/x-hive_architecture.png" alt="<nobr>X-Hive/DB</nobr>'s logical architecture"/><div class="caption">Figure 1. <nobr>X-Hive/DB</nobr>'s logical architecture</div></div>
		<div class="div3">
			<h4><a name="federated_database"/>3.3.1 Federated database</h4>
			<p>A single <nobr>X-Hive/DB</nobr> application contains one or more databases. These databases are grouped within a  single federated database (the <nobr>X-Hive</nobr> Federation).</p>
			<p>A federated database contains the following objects:</p>
			<ul>
				<li>
					<p>
						<a href="#super_user" target="">Super user</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#databases" target="">Databases</a>
					</p>
				</li>
			</ul>
      <p>You can obtain an iterator for all the database names using the <code>getDatabases()</code>
        method of <code>XhiveFederationIf</code>.</p>
		</div>
		<div class="div3">
			<h4><a name="databases"/>3.3.2 Databases</h4>
			<p>An <nobr>X-Hive/DB</nobr> application can contain one or more databases. These databases are contained in the federated database, and are created by the super user. A database can contain:</p>
			<ul>
				<li>
					<p>
						<a href="#users_user_list" target="">Users and user lists</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#groups_group_lists" target="">Groups and group lists</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#indexes_index_lists" target="">Indexes and index lists</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#libraries" target="">Libraries</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#documents" target="">Documents</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#catalogs_dtds" target="">Catalogs and Schemas</a>
					</p>
				</li>
        <li>
          <p>Blobs (binary large objects)</p>
        </li>
			</ul>
		</div>
		<div class="div3">
			<h4><a name="users_user_list"/>3.3.3 Users and user lists</h4>
			<p>Every user of an <nobr>X-Hive/DB</nobr> application has a user account stored in the database. This user account is identified by a unique user name, and has a password for access control. Each user has his own specific set of access rights to the database. For example, one user could be allowed to update documents in the database, while another user has read-only access to documents.</p>
			<p>In addition to regular users, a super user account  exists. This account is created automatically during installation, and enables initial database configuration. All other users have their accounts created by the database administrator (a regular user with extra privileges).</p>
			<p><nobr>X-Hive/DB</nobr> maintains a user list for each database which contains all the users of that database.</p>
		</div>
		<div class="div3">
			<h4><a name="groups_group_lists"/>3.3.4 Groups and group lists</h4>
			<p>A group is an object in the database with which you can associate one or more users. The main purpose of a group is to enable you to assign the same access rights and privileges to a subset of users. By assigning rights to groups, you then only need to add and remove users from a group to change their privileges.</p>
			<p><nobr>X-Hive/DB</nobr> maintains a group list for each database which contains all groups of that database.</p>
		</div>
		<div class="div3">
			<h4><a name="indexes_index_lists"/>3.3.5 Indexes and index lists</h4>
			<p>An index list provides a list of all the indexes of a library or document.</p>
		</div>
		<div class="div3">
			<h4><a name="libraries"/>3.3.6 Libraries</h4>
			<p>A library is a logical means of storing documents or other libraries. You can create as many libraries as you need to produce a hierarchy or storage architecture for your documents.

</p>
			<p>The nested structure of libraries within <nobr>X-Hive/DB</nobr> is very similar to the nested structure of directories or folders within your file system: any library can contain other libraries and there is exactly one root library. The root library is automatically created when the database is created but otherwise behaves like an ordinary library.</p>
		</div>
		<div class="div3">
			<h4><a name="catalogs_dtds"/>3.3.7 Catalogs and DTDs and XML Schemas</h4>
			<p>The catalog is the part of the database that stores Document Type Definitions (DTDs) and XML Schemas. For information, see the <a href="#catalog" target="">Catalog</a> section.</p>
		</div>
		<div class="div3">
			<h4><a name="documents"/>3.3.8 Documents</h4>
			<p>A document is the means of storage for XML data in an <nobr>X-Hive/DB</nobr> database. <nobr>X-Hive/DB</nobr> can handle both valid (that is, conforming to a structure defined in a DTD or XML Schema) and well-formed XML documents.</p>
		</div>
		<div class="div3">
			<h4><a name="super_user"/>3.3.9 Super user</h4>

      <p>A federated database has one super user. The super user has the right to create and delete
        databases, and to perform administration operations like setting the license key and backing
        up the database. The super user cannot access regular data like libraries and documents.</p>

      <p>The super user is not represented by an object in the <nobr>X-Hive/DB</nobr> API. The super user is
        created during <nobr>X-Hive/DB</nobr> installation.</p>
		</div>
	</div>
</div>

	

<div class="div1">
	<h2><a name="installing"/>4 Installing <nobr>X-Hive/DB</nobr></h2>
	<div class="div2">
		<h3><a name="installation_requirements"/>4.1 Installation requirements</h3>
		<p>Before running the installation program, you need to perform both checks and tasks to ensure that the installation is successful.</p>
		<div class="div3">
			<h4><a name="things_to_check_before_installation"/>4.1.1 Things to check before installation</h4>
			<p>You need to check the following issues before installation:</p>
			<ul>
				<li>
					<p>
						<a href="#supported_platforms" target="">Supported platforms</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#system_requirements" target="">System requirements</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#java_settings" target="">Java settings</a>
					</p>
				</li>
			</ul>
			<div class="div4">
				<h5><a name="supported_platforms"/>4.1.1.1 Supported platforms</h5>
				<p><nobr>X-Hive/DB</nobr> is a Java application. Therefore you can install it on any platform provided you have already installed Sun Java Development Kit 1.4.
				Installers are available for Windows 2000/XP and Unix (installer tested on Linux, Solaris, HP-UX and Mac OS X).</p>
			</div>
			<div class="div4">
				<h5><a name="system_requirements"/>4.1.1.2 System requirements</h5>
				<p>The following table shows the system requirements for each supported platform.</p>
				<table id="table_sys_reqs_for_xhive_db">
					<caption>System requirements for <nobr>X-Hive/DB</nobr></caption>
					<tbody>
						<tr>
							<td rowspan="1" colspan="1">RAM</td>
							<td rowspan="1" colspan="1">256MB</td>
						</tr>
						<tr>
							<td rowspan="1" colspan="1">Hard drive space for <nobr>X-Hive</nobr> software</td>
							<td rowspan="1" colspan="1">30MB</td>
						</tr>
						<tr>
							<td rowspan="1" colspan="1">Hard drive space per database</td>
							<td rowspan="1" colspan="1">1MB (minimum, real size depending on data loaded)</td>
						</tr>
						<tr>
							<td rowspan="1" colspan="1">Java</td>
							<td rowspan="1" colspan="1">Sun JDK 1.4</td>
						</tr>
						<tr>
							<td rowspan="1" colspan="1">Network</td>
							<td rowspan="1" colspan="1">TCP/IP</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="div4">
				<h5><a name="java_settings"/>4.1.1.3 Java settings</h5>
				<p>To install <nobr>X-Hive/DB</nobr>, you must already have installed a Sun Java Development Kit (JDK 1.4), or a fully compatible Java Virtual Machine. For platform-specific information, see System Requirements. Also note the base directory of the JDK installation. The installation program requires this information.</p>
        <p>If you are using a machine with more than one CPU and the Sun JVM, you will need to use
          at least version 1.4.2 due to Sun JVM bug 
          <a href="http://developer.java.sun.com/developer/bugParade/bugs/4768402.html" target="_new">4768402</a>.  If you are using MS Windows and the
          Sun JVM, to avoid a (very unlikely) case of data corruption after a machine crash (e.g.,
          on a power failure), we recommend using at least version 1.4.2 because of bug 
          <a href="http://developer.java.sun.com/developer/bugParade/bugs/4711787.html" target="_new">4711787</a>.</p>
			</div>
		</div>
		<div class="div3">
			<h4><a name="things_to_do_before_installation"/>4.1.2 Things to do before installation</h4>
			<p>You need to perform the following tasks before installation:</p>
			<ul>
				<li>
					<p>
						<a href="#read_readme_file" target="">Read the readme.txt file.</a>
					</p>
				</li>
				<li>
					<p>
						<a href="#log_in_as_administrator" target="">On Windows, log in as an administrator, or as a user with similar access.</a>
					</p>
				</li>
			</ul>
			<div class="div4">
				<h5><a name="log_in_as_administrator"/>4.1.2.1 Log in as an administrator</h5>
				<p>Ensure you are logged on as an Administrator. On Microsoft Windows machines you must be logged on as an Administrator to be able to install <nobr>X-Hive/DB</nobr>.</p>
			</div>
		</div>
	</div>
	<div class="div2">
		<h3><a name="installation_procedure"/>4.2 Installation - Windows</h3>
		<p>When you have satisfied the installation requirements, you can run the installation program. Follow all the prompts in the installation program, then create a database. This completes the installation procedure - <nobr>X-Hive/DB</nobr> is then ready for use.</p>
		<div class="div3">
			<h4><a name="run_the_installation_program"/>4.2.1 Run the installation program</h4>
			<p>On Windows, the installation program you need to run is called <code>setup.exe</code>, located in the root directory of the <nobr>X-Hive/DB</nobr> CD or distribution file. Besides installing the files in the proper directories, your <code>PATH</code> environment variable is augmented. If you have previous versions of <nobr>X-Hive/DB</nobr> running, ensure you uninstall them in the proper way. For information on uninstalling <nobr>X-Hive/DB</nobr>, see the <a href="#uninstalling" target="">Uninstalling <nobr>X-Hive/DB</nobr></a> section.</p>
			<p>When you run <code>setup.exe</code>, the installation process begins.</p>
			<div class="image"><img src="images/installing/install1.png"/><div class="caption">Figure 2. </div></div>
			<p>You simply need to follow the instructions on screen to complete the installation. The installation program requires your input for the following steps:</p>
			<ol>
				<li>
					<p>Accept the software license agreement. If you do not accept the license agreement, the installation is terminated.</p>
					<div class="image"><img src="images/installing/install2.png"/><div class="caption">Figure 3. </div></div>
				</li>
				<li>
					<p>Specify the target installation directory. The default on Microsoft Windows is <code>C:\Program Files\Xhive</code>.</p>
					<div class="image"><img src="images/installing/install4.png"/><div class="caption">Figure 4. </div></div>
				</li>
				<li>
					<p>Browse for the base directory of the applicable Java Development Kit. For example, <code>C:\jdk1.4</code>.</p>
					<div class="image"><img src="images/installing/install5.png"/><div class="caption">Figure 5. </div></div>
				</li>
				<li>
					<p>Enter the license key you received for the product. Note that there is a time limit on the validity of <nobr>X-Hive</nobr> software licenses. If in doubt about your license, contact <nobr>X-Hive</nobr> customer support.</p>
					<div class="image"><img src="images/installing/install6.png"/><div class="caption">Figure 6. </div></div>
				</li>
				<li>
					<p>Specify the password of the super user. This password is later needed to create databases with <nobr>X-Hive/DB</nobr> and perform other
					super user tasks.</p>
					<div class="image"><img src="images/installing/install7.png"/><div class="caption">Figure 7. </div></div>
				</li>
				<li>
					<p>Choose whether to proceed with a standard installation (recommended), or to perform some additional advanced installation steps.</p>
					<div class="image"><img src="images/installing/install8.png"/><div class="caption">Figure 8. </div></div>
					<p>If you proceed with a standard installation, the program files for <nobr>X-Hive/DB</nobr> are now installed on your host machine. If you proceed with an advanced installation, your input is needed for the following two additional steps.</p>
				</li>
				<li>
          <p>
            Specify the database directories. The installation program provides defaults for all
            database directories, based on the installation directory.  You should never put
            database files on remote file servers, like NFS servers or MS Windows shares.
            For performance, it's best to place the log files on another disk then the database files
            (in <nobr>X-Hive/DB</nobr> 5, that makes a bigger difference then in previous <nobr>X-Hive/DB</nobr> versions).
          </p>
          <p>
            It is also possible to change the default page size. Ideally, the page size should match
            the page size of the filesystem where the database shall reside. You should not pick larger
            sizes than the file system one. See the section on <a href="#database_page_size" target="">page sizes</a> 
            for more information.
          </p>
					<div class="image"><img src="images/installing/install8-adv-A.png"/><div class="caption">Figure 9. </div></div>
				</li>
				<li>
					<p>During installation, a service is installed and started that acts as a page-server. There are some settings
					to specify for this service:</p>
					<ul>
					  <li>The server can run on any port. A check is made whether the port is available. The port-number does determine
					  what 'url' you have to use later to access the database.</li>
					  <li>The cache size determines the amount of pages cached by the server to speed up performance. You generally do not
					  want to make this amount smaller, but if memory permits you can make it larger to improve performance.</li>
					  <li>By default, only processes running on the same machine can access the server for security reasons. If you want
					  to have processes on multiple machines access the database, you can choose here to allow it here.</li>
					</ul>
					<div class="image"><img src="images/installing/install8-adv-B.png"/><div class="caption">Figure 10. </div></div>
				</li>
				<li>
					<p>Finally, you can set some JVM properties, that only relate to with what JVM options client applications like the samples through ant and the Adminclient are run.</p>
					<div class="image"><img src="images/installing/install8-adv-C.png"/><div class="caption">Figure 11. </div></div>
				</li>
			</ol>
			<p>After successful installation of <nobr>X-Hive/DB</nobr>, the installation program displays a message confirming that the installation completed without errors.</p>
			<p>To have all settings take effect you will need to do log off and log in (a reboot is not necessary, only the PATH variable change needs to be registered).</p>
		</div>
	</div>
	<div class="div2">
		<h3><a name="unix_installation"/>4.3 Installation - UNIX</h3>
		<p>On UNIX platforms you can install <nobr>X-Hive/DB</nobr> as any user. Installation consists of three steps:
		<ol>
				<li>
					<p>Starting the installation.</p>
				</li>
				<li>
					<p>Entering installation parameters.</p>
				</li>
				<li>
					<p>Performing post-installation steps.</p>
				</li>
			</ol>
		</p>
		<div class="div3">
			<h4><a name="unix_installation_step1"/>4.3.1 Starting the installation</h4>
			<p>You must start the installation from the directory that contains the distribution files. Furthermore, a valid JVM must be available in the <code>PATH</code> variable before you run the installation. Both of these conditions are checked at the start of installation. <nobr>X-Hive/DB</nobr> can be installed under any account.</p>
			<p>To install <nobr>X-Hive/DB</nobr>, execute the command:
			<div class="eg"><pre>
sh setup.sh <var>InstallationPath</var>/xhive
</pre></div>
			For instance, running the command 
			<div class="eg"><pre>sh setup.sh /opt/xhive</pre></div>
			Creates the directory structure:
			<div class="eg"><pre>
/opt/xhive/bin
          /lib
          /doc</pre></div>
			</p>
			<p>Of course, to install X-Hive, you must have write access to the installation directory. When you start setup, the <nobr>X-Hive/DB</nobr> files are placed in the designated directory, after which you have to enter certain parameters needed by the installation. 
</p>
		</div>
		<div class="div3">
			<h4><a name="unix_installation_step2"/>4.3.2 Entering installation parameters</h4>
			<p>After the installation files have been copied, you need to enter a number of parameters needed during installation. The format for these questions is:
				<div class="eg"><pre>
Question [default] :
</pre></div>
			</p>
			<p>For most questions a default answer is provided. If that default is okay, press the Enter-key, otherwise type a new value (and press Enter) to override that default. If information you enter is incorrect, a message is displayed, and the question is asked again.</p>
			<p>The basic questions are:
				<ul>
					<li>
						<p>A base directory to JDK 1.4 - the installation program attempts to identify  where the JDK resides based on the <code>JAVA_HOME</code> and <code>PATH </code> environment variables, but it is wise to check whether that directory really contains the full JDK. 
</p>
					</li>
					<li>
						<p>Your valid <nobr>X-Hive/DB</nobr> license key.</p>
					</li>
					<li>
						<p>You need a super-user password to administer <nobr>X-Hive/DB</nobr> databases. Note that this password needs to be typed twice and is displayed in clear text.</p>
					</li>
				</ul>
			</p>
			<p>After this you are asked whether you want to alter advanced settings. If you select <code>no</code> (the default) the installation is completed using default values for the advanced settings. If you select <code>yes</code> you can set the following parameters: 
				<ul>
					<li>
						<p>The database directory, where your data will reside.</p>
					</li>
					<li>
						<p>The directory for journal files, for performance reasons you could place the journal files on a different harddisk from your database files. </p>
					</li>
					<li>
						<p>The page size in bytes, ideally this should be equal to the blocksize of the filesystem where the databases will be located (and never larger than that size). See the section on <a href="#database_page_size" target="">page sizes</a> for more information.</p>
					</li>
					<li>
						<p>The portnumber where the <nobr>X-Hive/DB</nobr> page server will accept connections on</p>
					</li>
					<li>
						<p>The amount of pages the page server will cache. More means more memory usage but better performance.</p>
					</li>
					<li>
						<p>Whether or not applications on other machines may access the pageserver on this machine.</p>
					</li>
					<li>
						<p>The minimum and maximum amount of memory passed to the JVM (<code>-Xms</code> and <code>-Xmx</code>). These values are only used in scripts to start up client applications like the Adminclient and <code>xhive-ant</code>.</p>
					</li>
					<li>
						<p>Other Java command line options (we try to default to some useful options here for certain platforms, usually you do not need to change them). </p>
					</li>
				</ul>
			</p>
		</div>
		<div class="div3">
			<h4><a name="unix_installation_step3"/>4.3.3 Performing post-installation steps</h4><p>After you have installed <nobr>X-Hive/DB</nobr> on Unix, you have to perform the following post-installation steps:</p><ul>
					<li>
						<p>Add the <var>XhiveDir</var><code>/bin</code> directory to your path, for example:
	<div class="eg"><pre>
bash$ export PATH=${PATH}:<var>XhiveDir</var>/bin
</pre></div>
	or if you use a (t)csh:
		<div class="eg"><pre>
tcsh&gt; setenv PATH ${PATH}:<var>XhiveDir</var>/bin
</pre></div>
						</p>
					</li>
					<li>
						<p>Start the page server with the command <code>XHStartServer</code>. This will start a background process for the page server that
						can then be accessed from e.g. the Administrator client.
            </p>
					</li>
				</ul>
			
			<div class="image"><img src="images/installing/unix_install.png"/><div class="caption">Figure 12. </div></div>
    </div>
	</div>
	<div class="div2">
		<h3><a name="verify_the_installation"/>4.4 Verify the installation</h3>
    <p>
      The following are the most important commands that are available after installation.  Note
      that everything that can be done with these commands can also be done programatically in your
      application through the <nobr>X-Hive/DB</nobr> API.  More information on each command can be found by running
      them without any parameters. Additional commands are described in the <a href="#creating_backup" target="">administration sections</a>.
    </p>
		<table id="table_important_xhive_commands">
			<caption>Important <nobr>X-Hive/DB</nobr> commands</caption>
			<tbody>
        <tr>
          <td rowspan="1" colspan="1"><a href="#starting_admin" target="">XHAdmin</a></td>
          <td rowspan="1" colspan="1">
            Graphical administration client, for maintaining databases, users and content.
          </td>
        </tr>
				<tr>
					<td rowspan="1" colspan="1"><a href="#execute_sample" target="">xhive-ant</a></td>
					<td rowspan="1" colspan="1">Compile and run the samples, as well as other programs.</td>
				</tr>
				<tr>
					<td rowspan="1" colspan="1">XHCreateDB</td>
					<td rowspan="1" colspan="1">Create a new database.</td>
				</tr>
				<tr>
					<td rowspan="1" colspan="1">XHDeleteDB</td>
					<td rowspan="1" colspan="1">Remove an existing database.</td>
				</tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#create_federation" target="">XHCreateFD</a></td>
          <td rowspan="1" colspan="1">Create a new empty federation</td>
        </tr>
				<tr>
					<td rowspan="1" colspan="1">XHInstallFD</td>
					<td rowspan="1" colspan="1">Set the superuser password and/ or license key on a federation.</td>
				</tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#xhbackup" target="">XHBackup</a></td>
          <td rowspan="1" colspan="1">Backup a federation to a backup file</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#xhrestore" target="">XHRestore</a></td>
          <td rowspan="1" colspan="1">Restore a federation from a backup file</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#XHSessionInfo_tool" target="">XHSessionInfo</a></td>
          <td rowspan="1" colspan="1">Shows debug information on currently open transactions and their locks</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1">XHServer</td>
          <td rowspan="1" colspan="1">Start or Shutdown a server process for a specific federation</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#command_xhstartserver" target="">XHStartServer</a></td>
          <td rowspan="1" colspan="1">Start the dedicated background server process for the default federation</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#command_xhstopserver" target="">XHStopServer</a></td>
          <td rowspan="1" colspan="1">Stop the dedicated background server process for the default federation</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#replica_creation" target="">XHCreateReplica</a></td>
          <td rowspan="1" colspan="1">Create a full replica (optionally including registering a replica id for it) of a federation at a given location.</td>
        </tr>
        <tr>
          <td rowspan="1" colspan="1"><a href="#suspend_disk_writes" target="">XHSuspendDiskWrites</a></td>
          <td rowspan="1" colspan="1">Ensure the federation files are flushed to disk and suspend (or resume) writing to them</td>
        </tr>
			</tbody>
		</table>
	</div>
	<div class="div2">
		<h3><a name="running_the_sample"/>4.5 Running the samples</h3>
		<p>After you have installed <nobr>X-Hive/DB</nobr> you can <a href="#create_a_database" target="">create databases</a> and <a href="#execute_sample" target="">run the samples</a> that are provided with <nobr>X-Hive/DB</nobr>.</p>
		<div class="div3">
			<h4><a name="create_a_database"/>4.5.1 Create a database</h4>
			<p>To create a database:</p>
					<ol>
			<li>
				<p>Start the <code>AdminClient</code> by running <code>XHAdmin</code>, which is located in the <code>bin</code> subdirectory of the <nobr>X-Hive/DB</nobr> target directory, and in the Start menu group of <nobr>X-Hive/DB</nobr> on Windows.</p>
			</li>
			<li>
				<p>Create a database by selecting the menu option Databases-&gt;Create database.</p>
			</li>
			<li>
				<p>Create a database named <code>united_nations</code> with the super user password as entered during installation of <nobr>X-Hive/DB</nobr> and
administrator password <code>northsea</code>. This database will be used by default in all samples described in this manual.</p>
			</li>
			<li>
				<p>After creating the database, you can close the administrator client. Note that you can also use the administrator client to view the data after you have run the samples, and to perform other actions.</p>
			</li>
		</ol>

			<p>You can also  create databases using the command line tool <code>XHCreateDB</code>. For more details on creating databases, see the section <a href="#creating_create_a_database" target="">Create a database</a> in the <a href="#creating" target="">Creating applications</a> chapter.</p>
		</div>
		<div class="div3">
			<h4><a name="execute_sample"/>4.5.2 Execute the samples</h4>
			<p><nobr>X-Hive/DB</nobr> samples can be run using the <code>ant</code> tool:</p>
			                   <ol>
			<li>
				<p>Open a command prompt and go (<code>cd</code>) to the <var>XhiveDir</var><code>\bin</code> directory.</p>
			</li>
			<li>
				<p>To run a sample which inserts two documents into the database, enter the command:</p>
<div class="eg"><pre>
xhive-ant run-sample -Dname=manual.StoreDocuments
</pre></div>
				<p>On successful completion of the sample, a message appears stating the number of documents stored in the database.</p> 
			</li>
		</ol>

			<p>The sources of all the samples can be found in <var>XhiveDir</var><code>\src\samples\manual</code>.</p>
		</div>
	</div>
	<div class="div2">
		<h3><a name="uninstalling"/>4.6 Uninstalling <nobr>X-Hive/DB</nobr></h3>
		<p>In the (hypothetical) event that you would like to uninstall <nobr>X-Hive/DB</nobr>, follow the instructions in the <code>uninstalling.txt</code> file.</p>
    <p>
      Uninstalling <nobr>X-Hive/DB</nobr> on Windows can be done by using the Add/ Remove Programs 
      item in the Control Panel. The data directories and other remaining files can be removed
      'by hand' afterwards.
    </p>
    <p>
      On Unix, you should first stop the page server if running, with the command <code>XHStopServer</code>. Then, you can remove the installation and data directories.
    </p>
	</div>
  <div class="div2">
    <h3><a name="configuring_xhive_bootstrap_property"/>4.7 Configuring the xhive.bootstrap property</h3>
    <p>
      A property called <code>xhive.bootstrap</code> specifies the location of the <nobr>X-Hive/DB</nobr>
      federation.  The property can be used in two different ways:
      <ul>
        <li>
          <p>
            If the property is a URL of the form
            <code>xhive://</code><var>host</var><code>:</code><var>port</var>, the <nobr>X-Hive/DB</nobr> code
            will attempt to connect to an <nobr>X-Hive/DB</nobr> server running behind the specified TCP/IP port.
          </p>
        </li>
        <li>
          <p>
            If the property is the complete (or relative) path to an XhiveDatabase.bootstrap file, an <nobr>X-Hive/DB</nobr> server
            will be started in the current JVM.  Depending on the application, this can be much
            faster than using a remote server because the communication overhead is avoided.
            However, only one JVM can run an <nobr>X-Hive/DB</nobr> server for a specific federation at the same
            time.
          </p>
        </li>
      </ul>
    </p>
    <p>
      If you are using <code>xhive-ant</code> to run <nobr>X-Hive/DB</nobr> applications, the
      <code>xhive.bootstrap</code> property automatically points to the location of the <nobr>X-Hive/DB</nobr>
      server.
    </p>
    <p>
      The syntax of the <code>xhive.bootstrap</code> property as used with <code>xhive-ant</code>
      is:
    </p>
    <p>
      <code>java
      -Dxhive.bootstrap=</code><code>xhive://</code><var>host</var><code>:</code><var>port</var>
    </p>
    <p>
      or
    </p>
    <p>
      <code>java
      -Dxhive.bootstrap=</code><var>PathName</var><code>/XhiveDatabase.bootstrap</code>
    </p>
    <p>
      Where <var>PathName</var> is the complete path to the XhiveDatabase.bootstrap file.
    </p>
    <p>
      It is also possible to specify the path to <code>XhiveDatabase.bootstrap</code> or the URL to
      connect to in your Java application, as an argument to <code>getDriver()</code> on
      <code>XhiveDriverFactory</code>.
    </p>
  </div>
  <div class="div2">
    <h3><a name="using_java_command_line"/>4.8 Using the Java command line instead of xhive-ant</h3>
    <p>If you use the Java command line, you first need to configure the <code>CLASSPATH</code> variable to include the following JAR files:</p>

				<ul>
					<li>
						<p>
							<code>antlr.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>fop.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>icu4j.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>jsr173_api.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>lucene.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>mx4j.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>retroweaver-rt.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>serializer.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>w3c.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>xalan.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>xbean.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>xercesImpl.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>xml-apis.jar</code>
						</p>
					</li>
					<li>
						<p>
							<code>xhive.jar</code>
						</p>
					</li>
				</ul>



    <p>For example, the following commands  run the application <code>myapp</code> (assuming the <nobr>X-Hive/DB</nobr> installation directory is <code>C:\xhive</code>):</p>
    <p><div class="eg"><pre>
C:\xhive\bin&gt;java -classpath C:\xhive\lib\antlr.jar; 
                             C:\xhive\lib\fop.jar;
                             C:\xhive\lib\icu4j.jar;
                             C:\xhive\lib\jsr173_api.jar;
                             C:\xhive\lib\lucene.jar;
                             C:\xhive\lib\mx4j.jar;
                             C:\xhive\lib\retroweaver-rt.jar;
                             C:\xhive\lib\w3c.jar;
                             C:\xhive\lib\xalan.jar;
                             C:\xhive\lib\xbean.jar;
                             C:\xhive\lib\xercesImpl.jar;
                             C:\xhive\lib\xml-apis.jar;
                             C:\xhive\lib\xhive.jar;
                  -Dxhive.bootstrap=C:\xhive\data\XhiveDatabase.bootstrap
                  test.myapp
    </pre></div>
    </p>
    <p>Note, only with a JDK 1.4 compatible <code>xhive.jar</code> you need <code>retroweaver-rt.jar</code>.
    </p>
  </div>
  <div class="div2">
    <h3><a name="dedicated_server"/>4.9 The <nobr>X-Hive/DB</nobr> dedicated server process</h3>
    <p>
      When you have installed <nobr>X-Hive/DB</nobr>, the system is configured to run with a dedicated page server that runs
      as a background process and to which other applications that want to access the database can connect.
    </p>
    <p>
      It is important to realize that this process is not a required part for the <nobr>X-Hive/DB</nobr> architecture. Java
      applications could also access the database directly through the bootstrap file without making any network
      connection. However, when accessing database files directly, no other processes (including the dedicated server
      described here) may be accessing the database at the same time (but that does not need to be a problem, as long
      as the 'main application' starts a listener thread for other applications to connect to, see below). 
    </p>
    <p>
      What is also important to realize is that the server program is a <em>very</em> small Java program, accessing
      the <nobr>X-Hive/DB</nobr> API like any <nobr>X-Hive/DB</nobr> application you would write yourself. There are some different configuration
      possibilities, but apart from those options and the processing of the passed parameters the whole server process
      is essentially these five lines:
    </p>
      <div class="eg"><pre>
XhiveDriverIf driver = XhiveDriverFactory.getDriver(bootstrapPath); // Get a driver for a bootstrap-location
driver.init(cachePages); // Initialize the cache of the driver
ServerSocket socket = new ServerSocket(port); // Create a listen socket
driver.startListenerThread(socket); // Start accepting remote connections
wait(); // Wait forever in this main thread
</pre></div>
    <p>
      Only the lines related to <code>startListenerThread</code> are specific to accepting remote connections, adding
      these lines to your own application will make it accept connections from other applications.
    </p>
    <p>
      As mentioned in the <a href="#internal_server" target="">performance</a> section, running <nobr>X-Hive/DB</nobr> with a separate 
      dedicated server such as configured after installation is not actually the best configuration for performance.
      The reason that it is configured by default with a separate server is because we feel that is is the more convenient way to
      get started, but for production applications where performance is essential it is a very poor choice.
    </p>
    <div class="div3">
      <h4><a name="dedicated_server_configuring"/>4.9.1 Configuration of the server</h4>
      <p>
        The default configuration of a server is determined during the installation. The settings are the port-number to
        accept connections on (default is '1235'), the size of the page-cache to use in the server (default is '1024'),
        and from what address(es) to accept connections (<code>'localhost'</code> means only connections from the same
        machine are accepted, <code>'*'</code> means that connections from every machine are accepted).
      </p>
      <p>
        You can change these configuration parameters after installation, by changing the parameters in the 
        'configuration' files. For the windows service, this file is <code>wrapper.conf</code>, for Unix the parameters
        need to be changed in the <code>XHStartServer</code> script directly. The files are located in <var>XhiveDir</var><code>/bin</code>.
        You will have to stop and start the server
        process after any changes (see below). Please note that when enlarging the cache size, you will also have to
        allocate more memory to the process, configured through the -Xmx parameter in the same configuration file
        (in the installer, the calculation of the -Xmx parameter is based on 16MB+(pageSize*cachePages)), your selected
        page size can be found in the XhiveDatabase.bootstrap file).
      </p>
      <p>
        The dedicated process is not configured for SSL connections by default. However, examination of the configuration 
        files should show that that the server process is essentially the Java class <code>com.xhive.tools.XhiveServer</code>,
        which matches the <code>XHServer</code> command. So examining the options of the <code>XHServer</code> command and reading
        the <a href="#using_ssl" target="">SSL section</a> should get you started on how to change the configuration file.
      </p>
      <p>
        As explained, it is not required to use a server process at all. If you want to configure <nobr>X-Hive/DB</nobr> for use without
        a server, you have to:
          <ul>
            <li>
              Use <code>FullPath/XhiveDatabase.bootstrap</code> instead of <code>xhive://hostname:portname</code> as
              the bootstrap path in your application.
            </li>
            <li>
              <a href="#command_xhstopserver" target="">Stop</a> the server (since only one process is allowed access to the 
              federation). On Unix, the server is simply not started if you don't run it. On Windows you may want to 
              uninstall the service alltogether by running the commands
<div class="eg"><pre>net stop xhive-server
instsrv xhive-server remove</pre></div>
              (Should you ever want to reinstall the service, you can run the commands
<div class="eg"><pre>wrapper -i wrapper.conf        (run from XhiveDir\bin)
net start xhive-server</pre></div>)
            </li>
          </ul>
      </p>
    </div>
    <div class="div3">
      <h4><a name="command_xhstartserver"/>4.9.2 XHStartServer</h4>
      <p>
        <code>XHStartServer</code> starts a background server process for the default federation, to which
        other processes can connect. The log output of any errors is redirected to a file named <code>server.log</code>
        which by is placed in the same directory where the <code>XhiveDatabase.bootstrap</code> file resides. 
      </p>
      <p>
        On Windows, this background server is implemented as a service, so this command consists only of starting
        the service named 'xhive-server', which in turn runs the Java program <code>com.xhive.tools.XhiveServer</code>.
        The service starts automatically when the machine boots. Note that since this is a service, the <code>SYSTEM</code>
        account must have access to all involved resources (jars and database files).
      </p>
      <p>
        On Unix, the background server is implemented as simply a Java process running in the background, so the command
        consists of a script that starts a background Java process for the class <code>com.xhive.tools.XhiveServer</code>. 
        If you would want to run a server at startup, you
        should add this command to your system startup configuration (be aware of the user under which the command is started in
        that case, that user must have full access to all involved resources).
      </p>
    </div>
    <div class="div3">
      <h4><a name="command_xhstopserver"/>4.9.3 XHStopServer</h4>
      <p>
        <code>XHStopServer</code> stops the background server process for the default federation.
      </p>
      <p>
        On Windows, this means simply stopping the 'xhive-server' service.
      </p>
      <p>
        On Unix, this involves killing the background process whose pid was registered in the file <code>server.pid</code>
        placed in the same directory as where the <code>XhiveDatabase.bootstrap</code> file resides, by <code>XHStartServer</code>.
        If there are any unexpected terminations of the process, you will have to remove this pid-file manually.
      </p>
    </div>
    
  </div>
</div>

	

<div class="div1">
	<h2><a name="creating"/>5 Creating applications</h2>
	<div class="div2">
		<h3><a name="creating_introduction"/>5.1 Introduction</h3>
		<p>This chapter describes how to create <nobr>X-Hive/DB</nobr> applications of varying complexities. The sections appear in logical order, beginning with basic steps such as creating a database, and moving to advanced topics such as using XPointer, XQuery, XLink and Abstract Schema.</p>
		<p>When developing an <nobr>X-Hive/DB</nobr> application, you may need to:</p>
		<ul><li><p><a href="#creating_create_a_database">Create a database</a></p></li><li><p><a href="#connect_to_the_database">Connect to the database</a></p></li><li><p><a href="#using_sessions_and_transactions">Use sessions and transactions</a></p></li><li><p><a href="#create_library">Create libraries</a></p></li><li><p><a href="#parse_xml_documents">Parse XML documents</a></p></li><li><p><a href="#validate_xml_documents">Validate XML documents</a></p></li><li><p><a href="#store_xml_documents">Store XML documents</a></p></li><li><p><a href="#dom_configuration">DOM configuration settings</a></p></li><li><p><a href="#load_save_parse_with_context">Parse documents with context</a></p></li><li><p><a href="#store_blobs">Store BLOBs</a></p></li><li><p><a href="#import_nonxml_data_from_external_sources">Import non-XML data</a></p></li><li><p><a href="#create_document">Create documents</a></p></li><li><p><a href="#retrieve_xml_documents">Retrieve XML documents and document parts</a></p></li><li><p><a href="#use_xquery">Use XQuery</a></p></li><li><p><a href="#use_xpath_xpointer">Use XPath and XPointer</a></p></li><li><p><a href="#indexing">Use indexes</a></p></li><li><p><a href="#traverse_xml_documents">Traverse XML documents</a></p></li><li><p><a href="#export_xml_documents">Export XML documents</a></p></li><li><p><a href="#publish_xml_documents">Publish XML documents</a></p></li><li><p><a href="#use_xlink">Use XLink</a></p></li><li><p><a href="#use_as_models">Use abstract schemas</a></p></li><li><p><a href="#Revalidation_document_schema">Revalidate documents with XML schema</a></p></li><li><p><a href="#use_psvi_interfaces">Access PSVI information</a></p></li><li><p><a href="#manage_users_and_groups">Manage users and groups</a></p></li><li><p><a href="#use_versioning">Use versioning</a></p></li><li><p><a href="#use_metadata">Using metadata on library children</a></p></li><li><p><a href="#use_jaas">Using JAAS to connect to the database</a></p></li></ul>
		<p>
		  We provide samples for most of the important functions. One of the ways to run a sample is through the <code>xhive-ant</code> tool. For example, you can use
		  <div class="eg"><pre>xhive-ant run-sample -Dname=manual.StoreDocuments</pre></div>
		  to compile and run the <code>StoreDocuments</code> sample.
		  Before you run the samples, it is wise to adjust the values in <code>src/samples/manual.SampleProperties.java</code> to match your system.
		</p>
	</div>
	<div class="div2">
		<h3><a name="creating_create_a_database"/>5.2 Create a database</h3>
		<p>When you install <nobr>X-Hive/DB</nobr> on a system, one database, called a federated database, is created by default. This federated database acts as a holder for one or more "regular" <nobr>X-Hive/DB</nobr> databases. The federated database also contains super user information. For more information on <nobr>X-Hive/DB</nobr> architecture, see the <a href="#xhive_db_architecture" target=""><nobr>X-Hive/DB</nobr> architecture</a> section.</p>
		<p>As an <nobr>X-Hive/DB</nobr> user, you can choose to create as many "regular" databases as you need.  You can create   a database in <nobr>X-Hive/DB</nobr> using  any of the following means:</p>
		<ul>
			<li>
				<p>The command-line utility <code>XHCreateDB</code>.</p>
			</li>
			<li>
				<p>The adminclient.</p>
			</li>
			<li>
				<p>The Application Programming Interface (API) functions.</p>
			</li>
		</ul>
		<div class="div3">
			<h4><a name="d1e2456"/>5.2.1 Creating a database using <code>XHCreateDB</code>
			</h4>
			<p>The command line utility <code>XHCreateDB</code> is located in the
				<var>XhiveDir</var>
				<code>/bin</code> directory. When creating a new database using <code>XHCreateDB</code>, you must give the name of the new database, the super user password, and the administrator password, as follows:</p>
			<p>
				<code>XHCreateDB</code>
				<var>SuperUserPassword AdminPassword DatabaseName</var>
			</p>
			<div class="note"><p class="prefix"><b>Note:</b></p>
				<p><nobr>X-Hive/DB</nobr> is case-sensitive for database names, user names, and passwords. For example, <code>Xhive</code> and <code>XHIVE</code> are regarded as different database names. Passwords must be between three and eight characters long, and must be alphanumeric.</p>
				<p>The default administrator password used in all samples is <code>northsea</code>. Make the appropriate changes to <code>SampleProperties.java</code> if a different password is used.</p>
			</div>
		</div>
		<div class="div3">
			<h4><a name="d1e2510"/>5.2.2 Creating a database using the adminclient</h4>
			<p>To create a database using the adminclient:</p>
			<ol>
				<li>
					<p>Start the adminclient.</p>
				</li>
				<li>
					<p>Select Databases-&gt;Create database. The Create database window is displayed.
			<div class="image"><img src="images/administering/Create_database.png" alt="Create database"/><div class="caption">Figure 13. Create database</div></div>
					</p>
				</li>
				<li>
					<p>Enter the database name, super user password, and administrator password.</p>
				</li>
			</ol>
		</div>
		<div class="div3">
			<h4><a name="d1e2542"/>5.2.3 Creating a database using API functions</h4>
			<p>If you are a super user, you can create a database using the API.</p>
			<p>The method for creating a database is called <code>createDatabase()</code>, and is located in the <code>com.xhive.core.interfaces.XhiveFederationIf</code> interface.</p>
			<p>To create a new database using the API:</p>
			<ol>
				<li>
					<p>Start a session and open a connection to the database as super user. The  <code>databaseName</code> parameter of the <code>connect()</code> call should be <code>null</code>:</p>
					<div class="eg"><pre>
XhiveDriverIf driver = XhiveDriverFactory.getDriver();
if (!driver.isInitialized()) {
  driver.init(1024);
}
XhiveSessionIf session = driver.createSession();
session.connect(superUserName, superUserPassword, null);
</pre></div>
					<div class="note"><p class="prefix"><b>Note:</b></p>
						<p>By default, sample <code>CreateDatabase.java</code> uses <code>northsea</code> as the super user password. If you entered a different super user password during <nobr>X-Hive/DB</nobr> installation, change the source code of the sample accordingly.</p>
					</div>
				</li>
				<li>
					<p>Get a handle to the database federation:</p>
					<div class="eg"><pre>
XhiveFederationIf federation = session.getFederation();
</pre></div>
				</li>
				<li>
					<p>
					Call <code>createDatabase()</code> with the name of the new database and the administrator password. You can specify a configuration
					file or use a default configuration (<code>null</code>):</p>
					<div class="eg"><pre>
federation.createDatabase(newDbName, administratorPassword, null, System.out);</pre></div>
				</li>
			</ol>
      <p>
        More information on the physical (file) structure of a database can be found in a <a href="#internal_structure" target="">separate section</a>.
      </p>
			<div class="note"><p class="prefix"><b>Note:</b></p>
				<p>A super user can only create (and delete) a database. Therefore, after creating a database using the <code>createDatabase()</code> method, you need to disconnect and reconnect as an administrator to perform actions on the new database.</p>
			</div>
			<p class="prefix"><b>See also:</b></p>
				<div class="refheader"><b>samples:</b></div><div class="ref2samples">
					<a href="../../src/samples/manual/CreateDatabase.java">&lt;XhiveDir&gt;\src\samples\manual\CreateDatabase.java</a><br/>
				</div><br/>
				<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
					<a href="../apidocs/com/xhive/core/interfaces/XhiveFederationIf.html">com.xhive.core.interfaces.XhiveFederationIf</a><br/>
				</div><br/>
			
		</div>
	</div>
	<div class="div2">
		<h3><a name="connect_to_the_database"/>5.3 Connect to the database</h3>
		<p>To connect to an <nobr>X-Hive/DB</nobr> database:</p>
		<ol>
			<li>
				<p>Obtain an <nobr>X-Hive/DB</nobr> driver:</p>
				<div class="eg"><pre>XhiveDriverIf xhiveDriver = XhiveDriverFactory.getDriver();</pre></div>
				<p>If you do not specify the bootstrap location
				in the environment of the JVM, you can also pass it as an argument to
				getDriver:</p>
				<div class="eg"><pre>XhiveDriverIf xhiveDriver = XhiveDriverFactory.getDriver("xhive://localhost:1235");</pre></div>
				(if you connect to the database without a server you should use a path to the file <code>XhiveDatabase.bootstrap</code>)
			</li>
			<li>
				<p>Initialize the local page cache shared by the sessions for this driver:</p>
				<div class="eg"><pre>xhiveDriver.init(1024);</pre></div>
				<p>(You should only initialize a specific driver once in your application, you can check with <code>isInitialized()</code>).</p>
			</li>
			<li>
				<p>Create a new <code>XhiveSessionIf</code>:</p>
				<div class="eg"><pre>XhiveSessionIf session = xhiveDriver.createSession();</pre></div>
			</li>
			<li>
				<p>Connect to the database, supplying a user name, password, and database name:</p>
				<div class="eg"><pre>session.connect(<var>UserName</var>, <var>UserPassword</var>, <var>DatabaseName</var>);</pre></div>
			</li>
		</ol>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/ConnectDatabase.java">&lt;XhiveDir&gt;\src\samples\manual\ConnectDatabase.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/XhiveDriverFactory.html">com.xhive.XhiveDriverFactory</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveDriverIf.html">com.xhive.core.interfaces.XhiveDriverIf</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveSessionIf.html">com.xhive.core.interfaces.XhiveSessionIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="using_sessions_and_transactions"/>5.4 Use sessions and transactions</h3>
		<p>There is also a seperate chapter with background information on <a href="#sessions" target="">sessions</a>.</p>
		<p>In <nobr>X-Hive/DB</nobr> all operations to databases take place within a session. The developer can determine the scope of a session.</p>
		<p>To create a session in <nobr>X-Hive/DB</nobr>:</p>
		<ol>
			<li>
				<p>Establish a connection to the database, as described in the <a href="#connect_to_the_database" target="">Connect to the database</a> section.</p>
			</li>
			<li>
				<p>Create a session using the <code>createSession()</code> method, which you can find in the <code>com.xhive.core.interfaces.XhiveSessionIf</code> interface. </p>
				<div class="eg"><pre>
XhiveDriverIf driver = XhiveDriverFactory.getDriver();
if (!driver.isInitialized()) {
  driver.init(1024);
}
XhiveSessionIf session = driver.createSession();
session.connect( userName, userPassword, databaseName );
</pre></div>
			</li>
		</ol>
		<p>Within a session one or more transactions can occur.
		A transaction is a group of operations that accesses and updates one or more XML documents
		or parts of XML documents in a database. Uniting a group of operations in a transaction enables
		you to make that group of operations 'atomic', that is, either all the instructions are executed
		to (successful) completion, or none are performed. This ensures that a database is never left in
		an inconsistent state.</p>
		<p>To use transactions within <nobr>X-Hive/DB</nobr> do the following:</p>
		<ol>
			<li>
				<p>Start the transaction with the <code>begin()</code> method of <code>com.xhive.core.interfaces.XhiveSessionIf</code>.</p>
			</li>
			<li>
				<p>Enter the instructions you want executed during the transaction.</p>
			</li>
			<li>
            <p>
              End the transaction using either the <code>commit()</code> or <code>rollback()</code>
              method. Use the <code>commit()</code> method when you actually want to execute your
              transaction. Use the <code>rollback()</code>method when, because of some kind of
              failure during the transaction, you want to reverse all the instructions within the
              transaction.  You should take care to always roll back the transaction if you get an
              unexpected exception.  If for instance the disk becomes full while loading a document,
              modifications may have been done only partially.  Committing such partial
              modifications can result in an inconsistent data structure in the database.
            </p>
			</li>
		</ol>
		<p>Within the scope of the transaction, an application could, for example, parse external XML documents and append them to a library. If an error occurs during parsing or appending, the complete transaction is rolled back and none of the files are appended:</p>
		<div class="eg"><pre>
session.begin();
try {
  LSParser parser = rootLibrary.createLSParser();
  for ( int i=1; i&lt;=numFiles; i++ ) {
    Document newDocument = parser.parseURI( new File(baseFileName + i + ".xml").toURL().toString());
    rootLibrary.appendChild(newDocument);
  }
  session.commit();
} catch (Exception e) {
  // in case of an error: do a rollback
  session.rollback();
  e.printStackTrace();
}

// remove the session
session.disconnect();
session.terminate();
</pre></div>
		<p>In addition to <code>commit()</code>, <nobr>X-Hive/DB</nobr> offers an alternative method, called <code>checkpoint()</code>, which you can use to commit all persistent operations executed since the last <code>begin()</code> or <code>checkpoint()</code>. One advantage of using <code>checkpoint()</code> instead of <code>commit()</code> is that the transaction remains active after the <code>checkpoint()</code> call, another is that references to database variables remain usable.</p>
		<p>
		  After a <code>commit</code> has been performed and you <code>begin</code> a new transaction on the same session, you must re-get all database variables on the session. This means that for instance the code
		  <div class="eg"><pre>session.begin();
XhiveLibraryIf library = session.getDatabase().getRoot();
session.commit();
session.begin();
System.out.println(library.getName());
session.commit();</pre></div>

          will not execute. You will get a <code>XhiveException</code> with error code
          <code>XhiveException.OBJECT_DEAD</code> when you access the library after the second
          <code>begin</code>. The reason is that another concurrent session may have removed the
          database objects that you have references to. You have to get a new reference to the
          library after the second <code>begin</code>, e.g.:

		  <div class="eg"><pre>session.begin();
XhiveLibraryIf library = session.getDatabase().getRoot();
session.commit();
session.begin();
library = session.getDatabase().getRoot();
System.out.println(library.getName());
session.commit();</pre></div>
		</p>
		<p>
			The following sections discuss some of the possible persistent operations, including <a href="#create_library" target="">creating a library</a> and <a href="#store_xml_documents" target="">storing a document</a>.</p>
		<div class="note"><p class="prefix"><b>Note:</b></p>
          <p>Although <code>disconnect()</code> marks the end of the scope of a session, it does not
            free all the resources allocated by  the session. To improve performance, you should use
            the  <code>terminate()</code> method  to terminate  a session  when you  no  longer need
            it. If this is a remote session, this will terminate the TCP connection to the <nobr>X-Hive/DB</nobr>
            server.  If you do not call terminate(), the TCP connection will be closed when the
            session is finalized after it has been garbage collected.</p>
		</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/UseSessions.java">&lt;XhiveDir&gt;\src\samples\manual\UseSessions.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/core/interfaces/XhiveSessionIf.html">com.xhive.core.interfaces.XhiveSessionIf</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveDriverIf.html">com.xhive.core.interfaces.XhiveDriverIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="create_library"/>5.5 Create libraries</h3>
		<p>In <nobr>X-Hive/DB</nobr>, a library is a means of storing documents or other libraries. You can create as many libraries as you need to produce a hierarchy or storage architecture for your documents.</p>
		<p>The nested structure of libraries within <nobr>X-Hive/DB</nobr> is very similar to the nested structure of directories or folders within your file system: any library can contain other libraries and there is exactly one root library. The root library is automatically created when the database is created but otherwise behaves like an ordinary library.</p>
		<p>To create a library, perform the following steps:</p>
		<ol>
			<li>
				<p>Obtain a handle to the parent library. If the root library is the parent library, use the <code>getRoot()</code> method to get a handle. Otherwise, use a previously instantiated variable.</p>
			</li>
			<li>
				<p>Create the library using the <code>createLibrary()</code> method.</p>
			</li>
			<li>
				<p>Give the new library a unique name using the <code>setName()</code> method (optional).</p>
			</li>
			<li>
				<p>Append the new library to its parent using the <code>appendChild()</code>
				method.</p>
			</li>
		</ol>
		<p>The following code creates a library structure in the sample database with one top-level library called <code>Publications</code>. This top-level library has  one sub-library called <code>General Info</code>.</p>
		<div class="eg"><pre>
// get a handle to the root library
XhiveLibraryIf rootLibrary = united_nations_db.getRoot();

// create a library
XhiveLibraryIf newLibA = rootLibrary.createLibrary();

// give the new library a name
newLibA.setName("Publications");

// append the new libary to its parent
rootLibrary.appendChild(newLibA);

// create a library which is a sublibrary of newLibA
XhiveLibraryIf newLibA1 = newLibA.createLibrary();

// give the new library a name
newLibA1.setName("General Info");

// append the new libary to its parent
newLibA.appendChild(newLibA1);
</pre></div>
		<p>The created library hierarchy looks like this:</p>
		<div class="image"><img src="images/library_hierarchy.png" alt="Sample library hierarchy"/><div class="caption">Figure 14. Sample library hierarchy</div></div>

		<div class="note"><p class="prefix"><b>Note:</b></p>Although naming a library is optional, it is strongly recommended as several access and indexing methods only work with named libraries.</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/CreateLibrary.java">&lt;XhiveDir&gt;\src\samples\manual\CreateLibrary.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/core/interfaces/XhiveDatabaseIf.html">com.xhive.core.interfaces.XhiveDatabaseIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryChildIf.html">com.xhive.dom.interfaces.XhiveLibraryChildIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="parse_xml_documents"/>5.6 Parse XML documents</h3>
		<p>To import an XML document from an external source, the XML document needs to be parsed. You can parse documents using the <code>parseURI</code> method of the DOM Load/ Save <code>LSParser</code> interface.</p>
        <p>The <code>XhiveLibraryIf</code> interface extends <code>DOMImplementationLS</code>, which can be used to create <code>LSParser</code> and <code>LSSerializer</code> objects. You must create LSParsers on the library where you want to store the document.</p>
		<p>When parsing succeeds, a DOM <code>Document</code> is returned.</p>
		<div class="eg"><pre>
LSParser builder = rootLibrary.createLSParser();
Document firstDocument = builder.parseURI( new File(fileName).toURL().toString());
</pre></div>

		<p>To store a parsed document in the database, you also need to perform an explicit <code>appendChild</code>. Otherwise, the document is only parsed and not stored. See the  <a href="#store_xml_documents" target="">Store XML documents</a> section for more information on storing documents.</p>
    	<p>The parse documents sample uses the default <code>LSParser</code> configuration settings. Section <a href="#dom_configuration" target="">Using DOM configuration</a> provides more information on builder configuration options and how to change them.</p>
		<p><nobr>X-Hive/DB</nobr> supports the DOM Load/ Save specification, which provides standard ways for parsing and serializing DOMs.</p>
        <p>For more documentation, see the <a href="http://www.w3.org/TR/2004/REC-DOM-Level-3-LS-20040407" target="_new">Load/ Save specification</a>.</p>

		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/ParseDocuments.java">&lt;XhiveDir&gt;\src\samples\manual\ParseDocuments.java</a><br/>
				<a href="../../src/samples/manual/DOMLoadSave.java">&lt;XhiveDir&gt;\src\samples\manual\DOMLoadSave.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/as/package-summary.html">org.w3c.dom.as</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
				<a href="../apidocs/org/w3c/dom/ls/LSParser.html">org.w3c.dom.ls.LSParser</a><br/>
				<a href="../apidocs/org/w3c/dom/ls/LSSerializer.html">org.w3c.dom.ls.LSSerializer</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="validate_xml_documents"/>5.7 Validate XML documents</h3>
		<p>Validation consists of two main steps:</p>
		<ol>
			<li>
				<p>The document is validated.</p>
			</li>
			<li>
				<p>The DTD/ XML Schema information is stored in the catalog as an abstract schema.</p>
			</li>
		</ol>
		<p>As described in the  <a href="#catalog_validated_parsing_dtd" target="">catalog</a> section, each time a document is validated, the application checks whether a abstract schema with the PUBLIC id of that document for DTDs, or the XML Schema with the namespace and file id, is already in the catalog. If so, the validation process uses this abstract schema instead of the external DTD. However, setting <code>LSParser</code> configuration parameter <code>'xhive-ignore-catalog'</code> to <code>true</code> during parsing overrides catalog checking and always creates a new abstract schema for each document being validated. This is an important note, if there is only a system ID referring to a DTD, and you parse with validation, then a DTD is stored for every document you parse (this does not happen for XML Schemas)! By setting configuration parameter <code>'xhive-store-schema'</code> to <code>false</code> it is possible to parse with validation without storing the schema</p>
		<p>The <code>'validate'</code> configuration parameter default value is false. Therefore, to parse a file with validation, you need to set this parameter:</p>
		<div class="eg"><pre>
LSParser parser = charterLib.createLSParser();
parser.getDomConfig().setParameter("validate", Boolean.TRUE);
Document firstDocument = parser.parseURI( new File(fileName).toURL().toString());
</pre></div>
		<p>The parsed document contains a reference to a DTD. This DTD is stored as an <code><a href="#use_as_models" target="">ASModel</a></code> within the catalog of the library on which the document is parsed.</p>
		<p>The <code>XhiveCatalogIf</code> interface (in the  <code>com.xhive.dom.interfaces</code> package) contains several methods for  updating and querying the abstract schema models stored:</p>
		<div class="eg"><pre>
// retrieve the catalog of the "UN Charter" library
XhiveCatalogIf unCharterCatalog = charterLib.getCatalog();

// get the abstract schema models that exist in the root library catalog
Iterator iter = unCharterCatalog.getASModels();
ASModel asModel;
while ( iter.hasNext() ) {
  asModel = (ASModel)iter.next();
  System.out.println(" asModel = " + asModel.getLocation());
}
</pre></div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/ParseDocumentsWithValidation.java">&lt;XhiveDir&gt;\src\samples\manual\ParseDocumentsWithValidation.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
				<a href="../apidocs/org/w3c/dom/ls/LSParser.html">org.w3c.dom.ls.LSParser</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="store_xml_documents"/>5.8 Store XML documents</h3>
		<p>To store XML documents in an <nobr>X-Hive/DB</nobr> database, use the <code>appendChild()</code> method. Before you can use the <code>appendChild()</code> method, you  need to get a handle to the library where the document should be stored. Every database has a root library by default. To store a document in the root library of the sample database, you could use the following code:</p>
		<div class="eg"><pre>
XhiveLibraryIf rootLibrary = united_nations_db.getRoot();
rootLibrary.appendChild(firstDocument);</pre></div>
		<p>
		Alternatively, you can store a document using the <code>insertBefore()</code> method, which is also a standard DOM method. The second parameter to specify with <code>insertBefore()</code> is the document in front of which you want to insert the new document:</p>
		<div class="eg"><pre>
rootLibrary.insertBefore(secondDocument, firstDocument);
</pre></div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/StoreDocuments.java">&lt;XhiveDir&gt;\src\samples\manual\StoreDocuments.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/Node.html">org.w3c.dom.Node</a><br/>
			</div><br/>
		
	</div>

	<div class="div2">
		<h3><a name="dom_configuration"/>5.9 DOM configuration settings</h3>
        <p>
          The DOM level 3 <code>DOMConfiguration</code> interface is used to set configuration
          settings. <code>XhiveDocumentIf</code>, <code>LSParser</code> and <code>LSSerializer</code> objects each
          have their own configuration object.
        </p>

        <div class="note"><p class="prefix"><b>Note:</b></p>
          In <nobr>X-Hive/DB</nobr>, DOM level 3 functionality of the <code>Document</code> interface is provided by the
         <code>XhiveDocumentIf</code> interface. Furthermore, new DOM level 3 core interfaces like
          <code>DOMConfiguration</code> and <code>TypeInfo</code> are located in the <code>org.w3c.dom.xhivecore</code>
          package to prevent clashing with interfaces provided by other programs.
        </div>

        <p>
          <code>DOMConfiguration</code> can be used to set boolean parameters like <code>"validate"</code>,
          <code>"namespaces"</code> and <code>"cdata-sections"</code>. Furthermore, the configuration can be used to set
          string parameters like <code>"schema-location"</code> and user object parameters like
          <code>error-handler</code>.
          The boolean configuration settings and string parameters of a document are stored in the database.
          These settings are used by <code>XhiveDocumentIf</code> function <code>normalizeDocument</code>.
          The complete list of options can be found in the JavaDOC documentation of <code>DOMConfiguration</code>,
          and <code>getDomConfig()</code> of <code>LSParser</code> and <code>LSSerializer</code> (all linked below).
        </p>
        <p> the following piece of code shows how to set a boolean parameter and user object parameter on the document
          configuration:
<div class="eg"><pre>
XhiveDocumentIf document = (XhiveDocumentIf) builder.parseURI(new File(fileName).toURL().toString());
DOMConfiguration config = document.getDomConfig();
config.setParameter("validate", Boolean.TRUE);
config.setParameter("error-handler", new SimpleDOMErrorPrinter());
</pre></div>

       </p>
        <p>
          In <nobr>X-Hive/DB</nobr>, the default configuration settings conform to the default settings as defined by the
          <a href="http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407#DOMConfiguration" target="_new">DOM level 3 Core</a>
          Specification and the
          <a href="http://www.w3.org/TR/2004/REC-DOM-Level-3-LS-20040407" target="_new">Load/ Save</a>
          Specification. A parameter is supported if it can be set to another value.
          The following piece of code shows how to test if a boolean parameter value is supported by a configuration:
<div class="eg"><pre>
config.canSetParameter("validate", Boolean.TRUE);
</pre></div>

          The following section shows deviations to the default values and additional <nobr>X-Hive/DB</nobr> specific settings.
        </p>


        <div class="div3">
          <h4><a name="dom_configuration_deviations"/>5.9.1 Deviations from specification</h4>
          <p>
            According to the specification, <code>LSParser</code> default value of boolean parameter
            <code>"element-content-whitespace"</code> is <code>"Boolean.TRUE"</code>. Documents parsed with this setting and
            stored in <nobr>X-Hive/DB</nobr> may have a large number of text nodes containing only spaces.
            These additional nodes need more space on disk and may have a negative impact on query and validation
            performance.
            For this reason, in <nobr>X-Hive/DB</nobr> the <code>LSParser</code> default value of this setting is set to
            <code>"Boolean.FALSE"</code>
          </p>
        </div>
        <div class="div3">
          <h4><a name="dom_configuration_additions"/>5.9.2 Aditional parameters</h4>
          <p>
            <nobr>X-Hive/DB</nobr> has added a number of parameters that can used by the <code>LSParser</code> and/or
            <code>Document</code>.
            <p>

            <table id="table_config_DOMBuilder" width="100%" border="1">
				<caption/>
				<tbody>
					<tr>
						<th align="left" rowspan="1" colspan="1">Parameter name</th>
						<th align="left" rowspan="1" colspan="1">Purpose</th>
                        <th align="left" rowspan="1" colspan="1">Value type</th>
						<th align="left" rowspan="1" colspan="1">Supported by interface</th>
					</tr>
					<tr>
						<td rowspan="1" colspan="1"><code>"xhive-ignore-catalog"</code></td>
						<td rowspan="1" colspan="1">During validated parsing, the corresponding DTD's and XML schemas in
                        the catalog are ignored.</td>
                        <td rowspan="1" colspan="1">XhiveDocumentIf, LSParser</td>
                        <td rowspan="1" colspan="1">Boolean.FALSE</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1"><code>"xhive-store-schema"</code></td>
						<td rowspan="1" colspan="1">During validated parsing, the corresponding DTD's or XML schemas are not
                        stored in the catalog.</td>
                        <td rowspan="1" colspan="1">XhiveDocumentIf, LSParser</td>
                        <td rowspan="1" colspan="1">is equal to the value of parameter <code>"validate"</code> but this value can but can be overridden
                        after setting parameter <code>"validate"</code>.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1"><code>"xhive-psvi"</code></td>
						<td rowspan="1" colspan="1">Store psvi information on elements and attributes. Documents parsed with this feature
                        turned on, give access to <a href="#use_psvi_interfaces" target="">psvi</a> information and enable
                        support of data types by XQuery queries.</td>
                        <td rowspan="1" colspan="1">LSParser</td>
                        <td rowspan="1" colspan="1">Boolean.FALSE</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1"><code>"xhive-store-schema-only-internal-subset"</code></td>
						<td rowspan="1" colspan="1">Store only the internal subset of the document (not any external subset).
                        Modifier for <code>xhive-store-schema</code> (only has a function when that parameter is set to true,
                        and when DTDs are involved).
                        Use this option if you only want to
                        store the internal subset of the document (not the external subset).</td>
                        <td rowspan="1" colspan="1">LSParser</td>
                        <td rowspan="1" colspan="1">Boolean.FALSE</td>
					</tr>
     <tr>
       <td rowspan="1" colspan="1"><code>"xhive-sync-features"</code></td>
       <td rowspan="1" colspan="1">Convenience setting. With this setting turned on, parameter settings of <code>XhiveDocumentIf</code> are
         synchronized with the parameter settings of <code>LSParser</code>. Note that parameter settings
         <code>"xhive-psvi"</code> and <code>"schema-location"</code> are always synchronized.
       </td>
       <td rowspan="1" colspan="1">LSParser</td>
       <td rowspan="1" colspan="1">Boolean.FALSE</td>
     </tr>
     <tr>
        <td rowspan="1" colspan="1"><code>"xhive-schema-ids"</code></td>
        <td rowspan="1" colspan="1">Identification of XML schema <a href="#catalog_model_identification" target="">id</a>s used by the document.</td>
                          <td rowspan="1" colspan="1">readonly parameter of <code>XhiveDocumentIf</code>. It is not supported.</td>
                          <td rowspan="1" colspan="1">null</td>
      </tr>


                 </tbody>
            </table>
          </p>
        </p>
      </div>

		   <p class="prefix"><b>See also:</b></p>
			    <div class="refheader"><b>samples:</b></div><div class="ref2samples">
				     <a href="../../src/samples/manual/DOMLoadSave.java">&lt;XhiveDir&gt;\src\samples\manual\DOMLoadSave.java</a><br/>
			    </div><br/>
			    <div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
         <a href="../apidocs/org/w3c/dom/xhivecore/DOMConfiguration.html">org.w3c.dom.xhivecore.DOMConfiguration</a><br/>
				     <a href="../apidocs/org/w3c/dom/ls/LSParser.html">org.w3c.dom.ls.LSParser</a><br/>
				     <a href="../apidocs/org/w3c/dom/ls/LSSerializer.html">org.w3c.dom.ls.LSSerializer</a><br/>
				     <a href="../apidocs/com/xhive/dom/interfaces/XhiveDocumentIf.html">com.xhive.dom.interfaces.XhiveDocumentIf</a><br/>
			    </div><br/>
		   
  </div>

    <div class="div2">
      <h3><a name="load_save_parse_with_context"/>5.10 Parse documents with context</h3>
      <p>
        You can use function <code>parseWithContext</code> on <code>LSParser</code> to parse complete documents.
		<div class="eg"><pre>
LSParser parser = charterLib.createLSParser();
// Using null, null, null as arguments here means the document will be completely empty
Document document = charterLib.createDocument(null, null, null);
// Other actions on document...
LSInput source = charterLib.createLSInput();
source.setSystemId("file:///c:/docs/document.xml");
parser.parseWithContext(source, document, LSParser.ACTION_REPLACE);</pre></div>
      </p>
      <p>
        This involves more code than a simple parse, but has the advantage that you
        can first create the documents, then set the indexes on them (at the 'other actions
        on document' line), and then parse the data on it. Especially for large documents,
        there may be some performance gained if you index the document during parsing.
      </p>
      <p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/DOMLoadSave.java">&lt;XhiveDir&gt;\src\samples\manual\DOMLoadSave.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/ls/LSParser.html">org.w3c.dom.ls.LSParser</a><br/>
				<a href="../apidocs/org/w3c/dom/ls/LSSerializer.html">org.w3c.dom.ls.LSSerializer</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
			</div><br/>
	  
	</div>
	<div class="div2">
		<h3><a name="store_blobs"/>5.11 Store BLOBs</h3>
		<p><nobr>X-Hive/DB</nobr> enables the storage of Binary Large OBjects (BLOBs) within a database. Examples of BLOBs are: image files (GIF, JPEG, PNG, BMP etc.), sound files (MP3, WAV etc.) and Microsoft Office files (DOC, XLS, PPT etc.). The advantage of storing BLOBs next to XML documents within <nobr>X-Hive/DB</nobr> is the fact that this allows the management of all resources for a specific project or product in one uniform way.</p>
		<p>BLOBs are stored in <nobr>X-Hive/DB</nobr> as a special type of node, the BLOB node. The method <code>createBlob()</code> creates a BLOB node. After creating a BLOB node, the content of the node must be filled through the <code>setContents()</code> method. To actually add the BLOB node, the normal methods for adding nodes can be used: <code>appendChild()</code> or <code>insertBefore()</code>:</p>
		<div class="eg"><pre>
String imgFileName = "un_flags.gif";
String imgName = "Flags of UN members";
FileInputStream imgFile = new FileInputStream(SampleProperties.baseDir + imgFileName)

// create BLOB node
XhiveBlobNodeIf img = charterLib.createBlob();

// set the contents and name of the BLOB node
img.setContents(imgFile);
img.setName(imgName);

// append the BLOB node to the library
charterLib.appendChild(img);
</pre></div>
		<p>BLOBs stored in <nobr>X-Hive/DB</nobr> can be retrieved using the <code>getContents()</code>
method in <code>XhiveBlobNodeIf</code>. This method returns an <code>InputStream</code>.
The <code>getSize()</code> method returns the size of the BLOB in bytes:</p>
		<div class="eg"><pre>
// retrieve the contents of the BLOB node
InputStream in = img.getContents();

// retrieve the size of the BLOB node
int imgSize = (int)img.getSize();
</pre></div>
		<p>A <code>FileOutputStream</code> can be used to output the contents of the BLOB node to a file:</p>
		<div class="eg"><pre>
// output the image to a new file
FileOutputStream out = new FileOutputStream(SampleProperties.baseDir + "copy_of_" + imgFileName);
byte[] buffer = new byte[imgSize];
int length;
while((length = in.read(buffer)) != -1) {
  out.write(buffer, 0, length);
}
in.close();
</pre></div>
		<p>When iterating over the child nodes of a library, BLOB nodes can be distinguished from other
nodes by their node type which is <code>XhiveNodeIf.BLOB_NODE</code>:</p>
		<div class="eg"><pre>
Node n = charterLib.getFirstChild();
while (n != null) {
  if (n instanceof XhiveBlobNodeIf) {
    System.out.println( "BLOB node found: " + ((XhiveLibraryChildIf)n).getName());
  }
  n = n.getNextSibling();
}
</pre></div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/StoreBLOBs.java">&lt;XhiveDir&gt;\src\samples\manual\StoreBLOBs.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveBlobNodeIf.html">com.xhive.dom.interfaces.XhiveBlobNodeIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="import_nonxml_data_from_external_sources"/>5.12 Import non-XML data</h3>
		<p><nobr>X-Hive/DB</nobr> can import data from non-XML files, provided you supply  information on how the data fields are separated and arranged in the source file. The <code>com.xhive.util.interfaces.XhiveSqlLoaderIf</code> interface contains the methods used for importing non-XML data. For a detailed specification of these methods, refer to the <code>XhiveSqlLoaderIf</code> Javadoc.</p>
		<p>In this example, data is imported in CSV format into <nobr>X-Hive/DB</nobr>, and stored as an XML document.</p>
		<p>The data to import looks like this:</p>
		<p>
			<div class="eg"><pre>
"Member", "Date of Admission", "Additional Notes"
"Iceland",  19 Nov. 1946, ""
"India",  30 Oct. 1945, ""
"Indonesia",  28 Sep. 1950, "By letter of 20 January ..."
"Iran (Islamic Republic of)",  24 Oct. 1945, ""
</pre></div>
		</p>
		<p>You can import the data with an <code>XhiveSqlLoaderIf</code> object, using the <code>loadSqlData()</code> method:</p>
		<p>
			<div class="eg"><pre>
Document un_members_doc = loader.loadSqlData(Impl,
                            FileName,
                            ',',
                            '\\',
                            '"',
                            true,
                            "UN_members",
                            XhiveSqlLoaderIf.IGNORE_HEADER,
                            "member",
                            new String[] {"name","admission_date","additional_note"},
                            new boolean[] {false, false, false});
</pre></div>
		</p>
		<p>This command specifies the following information:</p>
		<ul>
			<li>
				<p>The DOM implementation used: <code>Impl</code>.</p>
			</li>
			<li>
				<p>File name: variable <code>FileName</code>.</p>
			</li>
			<li>
				<p>Separator: <code>,</code>
				</p>
			</li>
			<li>
				<p>Escape character: <code>\</code>
				</p>
			</li>
			<li>
				<p>Encloser: <code>"</code>. The encloser is the character that specifies the start and end of a string.</p>
			</li>
			<li>
				<p>Column names: <code>true</code>. This specifies that the first row in the data file gives column names
and not data.</p>
			</li>
			<li>
				<p>Document element name: <code>UN_members</code>. This specifies the name of the root element.</p>
			</li>
			<li>
				<p>Mode: <code>IGNORE_HEADER</code>. This specifies that column headers are not used as element names.</p>
			</li>
			<li>
				<p>Row element name: <code>member</code>. This is the name of the element used to enclose each row.</p>
			</li>
			<li>
				<p>Column element names: <code>new String[] {"name", "admission_date", "additional_note"}</code>. This specifies the names to use for each of the elements.</p>
			</li>
			<li>
				<p>Column element ignore: <code>new boolean[] {false, false, false});</code>. This specifies whether to ignore (that is, not import) columns.						</p>
			</li>
		</ul>
		<p>This command produces the  following XML:</p>
		<p>
			<div class="eg"><pre>
&lt;UN_members&gt;
  &lt;member&gt;
    &lt;name&gt;Iceland&lt;/name&gt;
    &lt;admission_date&gt;19 Nov. 1946&lt;/admission_date&gt;
    &lt;additional_note&gt;&lt;/additional_note&gt;
  &lt;/member&gt;
  &lt;member&gt;
    &lt;name&gt;India&lt;/name&gt;
    &lt;admission_date&gt;30 Oct. 1945&lt;/admission_date&gt;
    &lt;additional_note&gt;&lt;/additional_note&gt;
  &lt;/member&gt;
  &lt;member&gt;
    &lt;name&gt;Indonesia&lt;/name&gt;
    &lt;admission_date&gt;28 Sep. 1950&lt;/admission_date&gt;
    &lt;additional_note&gt;By letter of 20 January 1965...&lt;/additional_note&gt;
  &lt;/member&gt;
  &lt;member&gt;
    &lt;name&gt;Iran (Islamic Republic of)&lt;/name&gt;
    &lt;admission_date&gt;24 Oct. 1945&lt;/admission_date&gt;
    &lt;additional_note&gt;&lt;/additional_note&gt;
  &lt;/member&gt;
&lt;/UN_members&gt;
</pre></div>
		</p>
		<p>In a similar way, you can use the <code>loadSqlData()</code> method to import data from a JDBC-compliant relational database. See the API documentation for more details.</p>
		<p>The <code>loadSqlData()</code> method has several variations. See the API documentation for all the possible parameters.</p>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/StoreRelationalData.java">&lt;XhiveDir&gt;\src\samples\manual\StoreRelationalData.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/util/interfaces/XhiveSqlLoaderIf.html">com.xhive.util.interfaces.XhiveSqlLoaderIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="create_document"/>5.13 Create documents</h3>
		<p>XML data is stored in <nobr>X-Hive/DB</nobr> databases as documents. A document is represented in the <nobr>X-Hive/DB</nobr> API by the <code>org.w3c.dom.Document</code> interface. This interface contains a number of methods for creating a new XML document, updating (parts of) XML documents, and accessing parts (elements, comments, attributes, and so on) of the document. See the <a href="#retrieve_xml_documents" target="">Retrieve XML documents and document parts</a> section for more information.</p>
		<p>To create a new document:</p>
		<ol>
			<li>
				<p>Obtain a handle to a DOM implementation (through <code>rootLibrary</code> as <code>XhiveLibraryIf</code> extends <code>DOMImplementation</code>):
					<div class="eg"><pre>
DOMImplementation impl = rootLibrary;
</pre></div>
				</p>
			</li>
			<li>
				<p>Create a <code>DocumentType</code> and a Document using the <code>createDocument()</code> method in <code>org.w3c.dom.DOMImplementation</code>:</p>
				<div class="eg"><pre>
DocumentType docType = impl.createDocumentType("typeName", "publicId", "systemId");
Document eventsDocument= impl.createDocument(null, "events", docType);
</pre></div>
				<p>Because no <code>namespaceURI</code> is used, the first parameter can be left empty. The second parameter of <code>createDocument()</code>, <code>events</code>, is the (tag) name of the root element. The third parameter sets the <code>docType</code> of the new document.</p>
			</li>
			<li>
				<p>Obtain a handle to the root element of the newly created document:</p>
				<div class="eg"><pre>
Element rootElement = eventsDocument.getDocumentElement();
</pre></div>
			</li>
			<li>
				<p>You can now add document parts using standard DOM methods. These methods are located in the <code>org.w3c.dom.Document</code> interface. The most commonly used methods are:</p>
				<ul>
					<li>
						<p>
							<code>createAttribute()</code>
						</p>
					</li>
					<li>
						<p>
							<code>createComment()</code>
						</p>
					</li>
					<li>
						<p>
							<code>createElement()</code>
						</p>
					</li>
					<li>
						<p>
							<code>createTextNode()</code>
						</p>
					</li>
				</ul>
			</li>
		</ol>
		<p>The following code adds a comment, an element named <code>event</code> with attribute <code>occurrence</code>, and a (text) value "UNICEF, Executive Board, annual session" to the new document:</p>
		<div class="eg"><pre>
// add a comment to the document before the root element
Comment comment = eventsDocument.createComment("this document contains UN events");
eventsDocument.insertBefore(comment, rootElement);

// add a new element to root element
Element eventElement = eventsDocument.createElement("event");
rootElement.appendChild( eventElement );

// add text value to the element
Text eventText = eventsDocument.createTextNode("UNICEF, Executive Board, annual session");
eventElement.appendChild(eventText);

// add an attribute to the element
eventElement.setAttribute("occurrence", "year");
</pre></div>
		<p>To add an element <code>date</code> with value "4-8 June, 2001" to element <code>event</code>, use the following code:</p>
		<div class="eg"><pre>
// add a new element to event
Element dateElement = eventsDocument.createElement("date");
eventElement.appendChild( dateElement );

// add text value to the date element
Text dateText = eventsDocument.createTextNode("4-8 June, 2001");
dateElement.appendChild(dateText);
</pre></div>
		<p>Here is the resulting XML document:</p>
		<div class="eg"><pre>
&lt;!DOCTYPE typeName PUBLIC "publicId" "systemId"&gt;
&lt;!--this document contains UN events--&gt;
&lt;events&gt;
  &lt;event occurrence="year"&gt;
     UNICEF, Executive Board, annual session
     &lt;date&gt;4-8 June, 2001&lt;/date&gt;
  &lt;/event&gt;
&lt;/events&gt;
</pre></div>
		<p>As usual, to actually store the document in the database you need to use the <code>appendChild()</code> or <code>insertBefore()</code> method:</p>
		<div class="eg"><pre>
rootLibrary.appendChild(eventsDocument);
</pre></div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/CreateDocument.java">&lt;XhiveDir&gt;\src\samples\manual\CreateDocument.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/Document.html">org.w3c.dom.Document</a><br/>
				<a href="../apidocs/org/w3c/dom/DOMImplementation.html">org.w3c.dom.DOMImplementation</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="retrieve_xml_documents"/>5.14 Retrieve XML documents and document parts</h3>
		<p><nobr>X-Hive/DB</nobr> offers several ways to retrieve documents and document parts from the database:</p>
		<ol>
			<li>
				<p>
					<a href="#retrieve_xml_documents_dom_operations" target="">Through DOM operations</a>.</p>
			</li>
			<li>
				<p>
					<a href="#retrieve_xml_documents_document_id" target="">By document ID</a>.</p>
			</li>
			<li>
				<p>
					<a href="#retrieve_xml_documents_document_name" target="">By document name</a>.</p>
			</li>
			<li>
				<p>
					<a href="#retrieve_xml_documents_executeFullPathXPointerQuery" target="">Using the <code>executeFullPathXPointerQuery()</code> method</a>.</p>
			</li>
			<li>
				<p>
					<a href="#retrieve_xml_documents_xpath" target="">Using XQuery or XPath</a>.</p>
			</li>
			<li>
				<p>
					<a href="#retrieve_xml_documents_index" target="">Using an index</a>.</p>
			</li>
		</ol>
		<div class="div3">
			<h4><a name="retrieve_xml_documents_dom_operations"/>5.14.1 Through DOM operations</h4>
			<p>The DOM specifications include a number of methods for retrieving documents or document parts. These methods are located in the <code>org.w3c.dom.Node</code> interface, and use the fact that elements within  the DOM are linked as parent/child or siblings.</p>
			<p>The following code checks whether a library has any children (either documents or libraries). If so, it counts the number of children:</p>
			<div class="eg"><pre>
int nrChildren = 0;
Node n = charterLib.getFirstChild();
while(n != null) {
  nrChildren++;
  n = n.getNextSibling();
}
</pre></div>
			<p>The <code>org.w3c.dom.Node</code> interface also includes the <code>getLastChild()</code> and <code>getPreviousSibling()</code> methods, which enable you to retrieve the children in reverse order.</p>
			<p>In addition to retrieving documents, DOM operations can also be used to retrieve specific parts of XML documents. The methods available include <code>getFirstChild()</code>, <code>getNextSibling()</code>, and <code>hasChildNodes()</code> (all in <code>org.w3c.dom.Node</code>).</p>
			<p>The following code uses DOM operations to display all elements within an XML document:</p>
			<div class="eg"><pre>
public static void showChildren (Node theNode, int level) {

  // some output formatting
  String indentation = "";
  for (int i=0; i&lt;level; i++) {
  	 indentation += "\t";
  }

  Node n = theNode.getFirstChild();

  int j = 1;

  // as long as there are children...
  while(n != null) {

    // and child is of type 'element'...
    if ( n.getNodeType() == org.w3c.dom.Node.ELEMENT_NODE ) {
      // show the element...
      System.out.println(indentation + "child " + j++ + " is a " + n.getNodeName());

      // and get the children of this element (recursively)
      showChildren(n, level+1);
    }

    // get next child
    n = n.getNextSibling();
  }
}
</pre></div>
			<p>The <code>org.w3c.dom.Element</code> interface contains several methods for retrieving element attributes, including <code>getAttribute()</code> and <code>getAttributeNode()</code>.</p>
			<p> The  <code>com.xhive.dom.interfaces.XhiveNodeIf</code> interface contains several "convenience" methods that extend the functionality of <code>org.w3c.dom.Node</code> . These methods include <code> getFirstChildByType()</code>, <code>getFirstChildElementByName()</code>, and <code>getDescendantByKey()</code>.</p>
			<p>The DOM specification also includes several methods for traversing documents. For more information on retrieving parts of XML documents by traversal, see the <a href="#traverse_xml_documents" target="">Traverse XML documents</a> section.</p>
			<div class="note"><p class="prefix"><b>Note:</b></p>The performance of the <code>getChildNodes()</code> method (in interface <code>org.w3c.dom.Node</code>) which returns all the children of a node in a <code>NodeList</code>, can be slow. The use of the <code>getNextSibling()</code> method to iterate across child nodes is recommended.</div>
		</div>
		<div class="div3">
			<h4><a name="retrieve_xml_documents_document_id"/>5.14.2 By document ID</h4>
			<p>When  a document is created, <nobr>X-Hive/DB</nobr> automatically assigns an identifier (of type <code>long</code>)  to the new document. This identifier is unique within the context of the library in which the document is stored.</p>
			<p>You can use the <code>get()</code> method (in <code>com.xhive.dom.interfaces.XhiveLibraryIf</code>) to retrieve documents by their document identifier:</p>
			<div class="eg"><pre>
int anId = 10;
Node child = charterLib.get(anId);
System.out.println("document with ID = " + anId + " in \"UN Charter\" has name: " +
                   ((XhiveLibraryChildIf)child).getName());
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="retrieve_xml_documents_document_name"/>5.14.3 By document name</h4>
			<p>Although every document has an identifier, it is often more convenient to retrieve documents by their name. Document names are optional, and, when set, a document name has to be unique within the context of the library in which the document is stored. You can retrieve documents by name by using the <code>get()</code> method in <code>com.xhive.dom.interfaces.XhiveLibraryIf</code>:</p>
			<div class="eg"><pre>
String documentName = "UN Charter - Chapter 2";
Document docRetrievedByName = (Document)charterLib.get( documentName );
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="retrieve_xml_documents_executeFullPathXPointerQuery"/>5.14.4 Using the <code>executeFullPathXPointerQuery()</code> method</h4>
			<p>The <code>com.xhive.dom.interfaces.XhiveLibraryChildIf</code> interface includes the
<code>executeFullPathXPointerQuery()</code> method which can be used to retrieve a
document by its library path and document name. Adding an XPointer expression to the library path and document name allows
retrieval of document parts.</p>
			<p>The syntax of the input query is:</p>
			<div class="eg"><pre>/libname[/libname...][/docname|/id:docid[##versionId]][#xpointer_query]</pre></div>
			<p>where square brackets (<code>[]</code>) enclose optional parts.</p>
			<p>The following code retrieves document <code>UN Charter - Chapter 2</code> from library <code>UN Charter</code> and outputs its content:</p>
			<div class="eg"><pre>
Iterator docsFound = rootLibrary.executeFullPathXPointerQuery("/UN Charter/UN Charter - Chapter 2");
Document docRetrievedByFPXPQ = (Document)docsFound.next();
System.out.println(docRetrievedByFPXPQ.toString());
</pre></div>
			<p>It is also possible to specify a relative path:</p>
			<div class="eg"><pre>
// newLib is a sub library of "UN Charter"

// execute the FullPathXPointerQuery relative to the new sub library
docsFound = newLib.executeFullPathXPointerQuery("../UN Charter - Chapter 3");
docRetrievedByFPXPQ= (Document)docsFound.next();
System.out.println(docRetrievedByFPXPQ.toString());
</pre></div>
			<p>When the document name is not specified, the <code>executeFullPathXPointerQuery()</code> method returns a library:</p>
			<div class="eg"><pre>
Iterator librariesFound = rootLibrary.executeFullPathXPointerQuery("/UN Charter";
XhiveLibraryIf charterLib = (XhiveLibraryIf)librariesFound.next();
</pre></div>
			<p>By adding an XPointer expression to the query string the <code>executeFullPathXPointerQuery()</code> method can be used to retrieve XML document parts. Here is an example that retrieves all <code>title</code> elements within the sample document <code>Un Charter - Chapter 5</code> in library <code>UN Charter</code>:</p>
			<div class="eg"><pre>
String sampleLibName = "/UN Charter";
String sampleDocName = "UN Charter - Chapter 5";
String sampleDocPath = sampleLibName + "/" + sampleDocName;
String queryXPointer = "#xpointer(/descendant::title)";

Iterator resultNodes = rootLibrary.executeFullPathXPointerQuery(sampleDocPath + queryXPointer);
while ( resultNodes.hasNext() ) {
  Node resultNode = (Node)resultNodes.next();
  System.out.println( resultNode.getFirstChild().getNodeValue() );
}
</pre></div>
			<p> Because the document name is an optional part of the input string, you could use the following code to retrieve the first paragraph of UN article #68 without specifying which document contains this article:</p>
			<div class="eg"><pre>
queryXPointer = "#xpointer(/descendant::article[@number='68']/para[1])";

// note that we only specify the library path and not the document name:
resultNodes = rootLibrary.executeFullPathXPointerQuery(sampleLibName + queryXPointer);
while ( resultNodes.hasNext() ) {
  Node resultNode = (Node)resultNodes.next();
  System.out.println( resultNode.getFirstChild().getNodeValue() );
}
</pre></div>
			<p>You can also get a specific version of a document. By adding <code>##</code> followed by a version id
			or label after the document name of the query-string, the method will fetch a copy of the specified version. You can add an XPointer expression to a query string that gets a specific version of a document to retrieve an XML document part.</p>
			<p>You can only get a version of a document, not a library. It is also an error to try to retrieve a non-existing version. The version identifier in the query string is first evaluated as a label, if no version with that label can be found the version identifier is treated as a version id</p>
			<p>Here is an example that retrieves all <code>title</code> elements within version 1.3 of the sample document <code>Un Charter - Chapter 5</code> in library <code>UN Charter</code>:</p>
			<div class="eg"><pre>
String sampleLibName = "/UN Charter";
String sampleDocName = "UN Charter - Chapter 5";
String sampleDocPath = sampleLibName + "/" + sampleDocName;
String versionIdentifier = "##1.3";
String queryXPointer = "#xpointer(/descendant::title)";

Iterator resultNodes = rootLibrary.executeFullPathXPointerQuery(sampleDocPath + versionIdentifier + queryXPointer);
while ( resultNodes.hasNext() ) {
  Node resultNode = (Node)resultNodes.next();
  System.out.println( resultNode.getFirstChild().getNodeValue() );
}
</pre></div>
			<p>For more information on specifying XPointer queries, see the <a href="#use_xpath_xpointer" target="">Use XPath and XPointer</a> section.</p>
		</div>
		<div class="div3">
			<h4><a name="retrieve_xml_documents_xpath"/>5.14.5 Using XQuery, XPath and XPointer</h4>
			<p>See the <a href="#use_xquery" target="">Use XQuery</a> and <a href="#use_xpath_xpointer" target="">Use XPath and XPointer</a> section for details.</p>
		</div>
		<div class="div3">
			<h4><a name="retrieve_xml_documents_index"/>5.14.6 Using a Context Conditioned Index</h4>
			<p>See the <a href="#indexing_context_conditioned_indexes" target="">Use Context Conditioned Indexes</a> section for  details.</p>
		</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/RetrieveDocuments.java">&lt;XhiveDir&gt;\src\samples\manual\RetrieveDocuments.java</a><br/>
				<a href="../../src/samples/manual/RetrieveDocumentParts.java">&lt;XhiveDir&gt;\src\samples\manual\RetrieveDocumentParts.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/Node.html">org.w3c.dom.Node</a><br/>
				<a href="../apidocs/org/w3c/dom/Element.html">org.w3c.dom.Element</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryChildIf.html">com.xhive.dom.interfaces.XhiveLibraryChildIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
    <h3><a name="use_xquery"/>5.15 Use XQuery</h3>
    <p>
      Most of the details of using XQuery with <nobr>X-Hive/DB</nobr> are contained in
      a <a href="#xquery" target="">seperate chapter</a>.
    </p>
    <p>
      You can execute an XQuery query using the <code>executeXQuery(String query)</code> method
      on the <code>XhiveLibraryChildIf</code> interface (meaning it can be executed on libraries and
      documents).  It returns a <code>java.util.Iterator</code> that represents the
      result sequence.  Each element of the result is an instance of
      <code>XhiveXQueryValueIf</code>.
    </p>
    <p>
      For example, you could use the following code to execute a query that retrieves all the titles of UN Charter chapters:
    </p>
		<div class="eg"><pre>
Iterator result = charterLib.executeXQuery("//chapter/title");
while (result.hasNext()) {
  XhiveXQueryValueIf value = (XhiveXQueryValueIf) result.next();
  // We know this query will only return nodes.
  Node node = value.asNode();
  // Do something with the node ...
}
</pre></div>
    <p>
      For more details on the different <code>executeXQuery</code> variants, details of the XQuery engine specifics for <nobr>X-Hive/DB</nobr>, extension functions we have added etc., see the <a href="#xquery" target="">separate section</a> on XQuery.
    </p>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/XQuery.java">&lt;XhiveDir&gt;\src\samples\manual\XQuery.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryChildIf.html">com.xhive.dom.interfaces.XhiveLibraryChildIf</a><br/>
				<a href="../apidocs/com/xhive/query/interfaces/package-summary.html">com.xhive.query.interfaces</a><br/>
			</div><br/>
		
  </div>

	<div class="div2">
		<h3><a name="use_xpath_xpointer"/>5.16 Use XPath and XPointer</h3>
		<div class="note"><p class="prefix"><b>Note:</b></p><p>The information in this section is mostly for backward compatibility. Please use <a href="#xquery" target="">XQuery</a> whenever possible.
		</p></div>

		<div class="div3">
			<h4><a name="xpath"/>5.16.1 XPath</h4>
			<p>XPath queries can be executed using the <code>executeXPathQuery(...)</code> methods on the <code>XhiveNodeIf</code> interface. Optionally a query context that contains namespace declarations, variable and function bindings, and an absolute root can be supplied when executing an XPath query. The results of an XPath query are presented through the <code>XhiveQueryResultIf</code> interface.</p>
			<p>For example, you could use the following code to execute a query that retrieves all the titles of UN Charter chapters:</p>
			<div class="eg"><pre>

XhiveQueryResultIf result = charterLib.executeXPathQuery("descendant::chapter/title");

</pre></div>
			<p>The <code>XhiveQueryResultIf</code> interface includes methods
for extracting different types of information from the result of a query. A result can be a string, a boolean, a number, or a location set. The latter is a collection of nodes, points, and ranges.</p>
			<p>You can convert a query result to any of the other types by using
the following methods:
		<ul>
					<li>
						<p>To retrieve the string value of the result, use <code>getStringResult()</code>.</p>
					</li>
					<li>
						<p>To retrieve the  boolean value of the result, use <code>getBooleanResult()</code>.</p>
					</li>
					<li>
						<p>To retrieve the  numeric value of the result, use <code>getNumberResult()</code>.</p>
					</li>
					<li>
						<p>To retrieve the  location set value of the result, use <code>getLocationSetValue()</code>.</p>
					</li>
				</ul>
			</p>
			<p>The conversion rules that apply to these methods are listed in the XPath specs.</p>
			<div class="note"><p class="prefix"><b>Note:</b></p>
				<p>An <code>XhiveException</code> occurs if you  call <code>getLocationSetValue()</code> on a result that is not a location set.</p>
			</div>
			<p>To process the results in the example (returned as a location set), you could use the following code:</p>
			<div class="eg"><pre>
if (result != null){
  if ( resultType == XhiveQueryResultIf.LOCATIONSET ){
    XhiveLocationIteratorIf resultNodeSet = result.getLocationSetValue();
    XhiveLocationIf resultNode;

    while ( resultNodeSet.hasNext() ) {
      resultNode = resultNodeSet.next();
      if ( resultNode.getLocationType() == Node.ELEMENT_NODE ) {
        System.out.println(" " + ((Node)resultNode).getFirstChild().getNodeValue());
      }
    }
  }
}
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="xpointer"/>5.16.2 XPointer</h4>
			<p>XML Pointer Language (XPointer), which is based on XML Path Language (XPath), supports addressing into the internal structures of XML documents. This enables you to traverse a hierarchical document structure and select parts of the hierarchy based on various properties. For a complete and up-to-date description of XPointer, refer to the <a href="http://www.w3.org/TR/WD-xptr" target="_new">XML Pointer Language (XPointer) Version 1.0 documentation</a> at the W3C website.</p>
			<p>XPointer queries can be executed in a similar fashion as <a href="#use_xpath_xpointer" target="">XPath</a> queries:</p>
			<div class="eg"><pre>

XhiveQueryResultIf result = charterLib.executeXPointerQuery("xpointer(/chapter/article/para/list/item[1]/para)");

</pre></div>
			<p>Contrary to XPath queries, the result of an XPointer query has to be a non-empty location set. Any other outcome generates an exception. The location set is processed in the same way as described before.</p>
		</div>
		
		<div class="div3">
			<h4><a name="xpath_xpointer_namespaces"/>5.16.3 Working with namespaces</h4>
			<p>Before a namespace can be used in an XPath query, its namespace must be declared in a <code>XhiveXpathContextIf</code> that should be supplied when executing the query. This can be done using the <code>addNamespaceBinding(...)</code> method:</p>
			<div class="eg"><pre>

XhiveXPathContextIf xpathContext = nsDocument.createXPathContext();

// Add a namespace declaration for the xsl-namespace
// Note that the prefix does not have to match
xpathContext.addNamespaceBinding("ns", "http://www.w3.org/1999/XSL/Transform");

// Execute the query
XhiveQueryResultIf result = nsDocument.executeXPathQuery("descendant::ns:template/@match", xpathContext);
</pre></div>
			<div class="note"><p class="prefix"><b>Note:</b></p>
				<p><code>XhiveXPathContextIf</code> objects become invalid after an end of a transaction (commit, checkpoint, rollback), this to prevent that the context operates on invalid data (because the view of the database changes after the beginning of a new transaction). If a context is used after a transaction end an <code>XhiveException.INVALID_CONTEXT</code> is thrown.</p>
			</div>

			<p>In XPointer, the namespace declaration is included in the query. The format of the declaration is defined in the <a href="http://www.w3.org/TR/WD-xptr#ns-context" target="_new">XPointer specifications</a>:</p>
			<div class="eg"><pre>
theQuery = "xmlns(ns=http://www.w3.org/1999/XSL/Transform) xpointer(descendant::ns:template/@match)";
</pre></div>
		</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/XPath.java">&lt;XhiveDir&gt;\src\samples\manual\XPath.java</a><br/>
				<a href="../../src/samples/manual/XPathXPointerNamespaces.java">&lt;XhiveDir&gt;\src\samples\manual\XPathXPointerNamespaces.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/query/interfaces/package-summary.html">com.xhive.query.interfaces</a><br/>
				<a href="../apidocs/com/xhive/xpath/interfaces/XhiveXPathContextIf.html">com.xhive.xpath.interfaces.XhiveXPathContextIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="indexing"/>5.17 Use indexes</h3>
		<p>Using indexes can dramatically improve the performance of your queries. Detailed information about indexes can be found in a <a href="#indexes" target="">dedicated chapter</a>. This section only contains some pieces of sample code.</p>
		<div class="div3">
			<h4><a name="indexing_library_indexes"/>5.17.1 Library id indexes</h4>
  		<p>The following sample shows how to add a <a href="#indexes_library_indexes_id" target="">library id index</a>:</p>
				<div class="eg"><pre>
//get the index list of the library
XhiveIndexListIf indexList = library.getIndexList();

//add a library id index to the library
String idIndexName = "Library ID Index";
XhiveIndexIf idIndex = indexList.addLibraryIdIndex(idIndexName);
</pre></div>
          <p>Note that the root library has a library id index by default when a database is created.</p>
	  </div>
		<div class="div3">
			<h4><a name="indexing_library_indexes_name"/>5.17.2 Library name indexes</h4>
			<p>The following sample shows how to add a <a href="#indexes_library_indexes_id" target="">library name index</a>:</p>
				<div class="eg"><pre>
//add a library name index to the library
String nameIndexName = "Library Name Index";
XhiveIndexIf nameIndex = indexList.addLibraryNameIndex(nameIndexName);
</pre></div>
          <p>Note that library name indexes are added by default when a library is created.</p>
		</div>
		<div class="div3">
			<h4><a name="indexing_id_attribute_indexes"/>5.17.3 Id attribute indexes</h4>
			<p>The code below shows how to add an <a href="#indexes_id_attribute_indexes" target="">id attribute index </a>to a document</p>
			<div class="eg"><pre>
//Get the indexlist
XhiveIndexListIf indexList = document.getIndexList();

//add the id attribute index to the indexlist of the document if the index is not found
String indexName = "ID Attribute Index";
XhiveIndexIf index = indexList.getIndex(indexName);
if (index == null){
   index = indexList.addIdAttributeIndex(indexName);
}
</pre></div>
			<p>Id attribute indexes are used by XQuery/XPath/XPointer queries and the <code>getElementsById(String elementId)</code> method. This type of indexes will most likely not be accessed directly by users. However, the following code shows how to view the keys of the index:</p>
			<div class="eg"><pre>
//Print the element of key = "p3"
String key = "p3";

XhiveNodeIteratorIf nodeIter = index.getNodesByKey(key);
if (nodeIter.hasNext()){
  System.out.println("  Element = " + nodeIter.next());
}
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="indexing_element_name_indexes"/>5.17.4 Element name indexes</h4>
			<p>The following code shows how to create a <a href="#indexes_element_name_indexes" target="">selected element name index</a>:</p>
			<div class="eg"><pre>
//Add a selected element name index
String[] names = {"NAME", "BORN", "WIFE"};
XhiveIndexIf selectedElementNameIndex = indexList.getIndex(selectedElementIndexName);
if (selectedElementNameIndex == null){
  indexList.addElementNameIndex(selectedElementIndexName, names);
}

</pre></div>
      <p>In case of namespaces, the selected element names could be defined as follows: </p>
			<div class="eg"><pre>
//Define the names of an element name index with namespaces
String[] names = {"http://www.x-hive.com chapter", "http://www.x-hive.com owner"};

</pre></div>
	  </div>

		<div class="div3">
			<h4><a name="indexing_value_indexes"/>5.17.5 Value indexes</h4>
			<p>To create a <a href="#indexes_value_indexes" target="">value index</a>, use the <code>addValueIndex()</code> method.
			   The exact type of value index is determined by the parameters that are
                           supplied to the <code>addValueIndex()</code> method:</p>
			<div class="eg"><pre>
// create a value index that stores elements by element value
XhiveIndexIf nameIndex = indexList.addValueIndex(nameIndexName, null, "NAME", null, null);

// create a value index that stores elements by attribute value
XhiveIndexIf idIndex = indexList.addValueIndex(idIndexName, null, null, null, "ID");

// create a value index that stores named elements by attribute value
XhiveIndexIf personByFatherIndex = indexList.addValueIndex(personByFatherIndexName,
                                                           null, "PERSON", null, "FATHER");
</pre></div>

		</div>

		<div class="div3">
			<h4><a name="indexing_full_text_indexes"/>5.17.6 Full text indexes</h4>
			<p>To create a <a href="#indexes_full-text_indexes" target="">full text index</a>, use the <code>addFullTextIndex()</code> method.
			   The exact type of value index is determined by the parameters that are
                           supplied to the <code>addFullTextIndex()</code> method:</p>
			<div class="eg"><pre>
// create a full text index on the text-contents of the name elements
XhiveIndexIf nameIndex = indexList.addFullTextIndex(nameIndexName, null, "NAME", null,
      null, null, XhiveIndexIf.FTI_SUPPORT_PHRASES | XhiveIndexIf.FTI_GET_ALL_TEXT);
</pre></div>
		</div>

		<div class="div3">
			<h4><a name="indexing_context_conditioned_indexes"/>5.17.7 Context conditioned indexes</h4>
			<p>A <a href="#indexes_context_conditioned_indexes" target="">context conditioned index</a> stores <code>Node</code> objects by a user-defined key.</p>
			<p>The three basic steps involved in creating a context conditioned index are:</p>
			<ol>
				<li><p>Get a handle to the index list.</p></li>
				<li><p>Create an <code>XhiveCCIndexIf</code> object.</p></li>
				<li><p>Create an <a href="#indexing_creating_index_node_filter" target="">index node filter</a> (using <code>XhiveIndexNodeFilterIf</code>) to define which nodes to include and not include in the index.</p></li>
			</ol>
			<p>
				<div class="eg"><pre>
// get the index list that belongs to this database
XhiveIndexListIf indexList = charterLib.getIndexList();

// create an XhiveIndexIf object
String indexName = "Index of even numbered chapters";
XhiveCCIndexIf index = (XhiveCCIndexIf)indexList.getIndex(indexName);

if ( index != null ) {
  // remove existing index first
  indexList.removeIndex(index);
}

index = (XhiveCCIndexIf)indexList.addNodeFilterIndex("samples.manual.SampleIndexFilter",indexName );
</pre></div>
			</p>
			<p>Once the context conditioned index has been created the <code>indexDocument()</code> method of <code>XhiveCCIndexIf</code> can be used to add context conditioned index entries for a document:</p>
			<div class="eg"><pre>
index.indexDocument(newDocument);
</pre></div>
			<p>The following sample shows how to use the created index to retrieve all the titles of the even number chapters:</p>
			<div class="eg"><pre>
Iterator keyIter = index.getKeys();
while (keyIter.hasNext()) {
  String key = (String) keyIter.next();
  System.out.println(key);
}
</pre></div>
			<p>The <code>getNodesByKey()</code> method is used to retrieve nodes from the index based on a given key:</p>
			<div class="eg"><pre>
XhiveNodeIteratorIf nodesFound = index.getNodesByKey("AMENDMENTS");
while (nodesFound.hasNext()) {
  XhiveNodeIf docFound = (XhiveNodeIf)nodesFound.next();
  System.out.println(docFound.toXml());
}
</pre></div>
			<div class="div4">
				<h5><a name="indexing_creating_index_node_filter"/>5.17.7.1 Creating index node filters</h5>
				<p>An index node filter determines which nodes to include in a context conditioned index. An index node filter is a Java class which implements the <code>XhiveIndexNodeFilterIf</code> interface.</p>
<p>The <code>XhiveIndexNodeFilterIf</code> extends <code>org.w3c.dom.traversal.NodeFilter</code> interface and classes implementing <code>XhiveIndexNodeFilterIf</code> must define the following functions:</p>
				<ul>
					<li>
						<p>
							<code>acceptNode(Node n);</code>
						</p>
					</li>
					<li>
						<p>
							<code>getKeys(Node n);</code>
						</p>
					</li>
				</ul>

				<p>The following code creates the index node filter used in the sample above:</p>
				<div class="eg"><pre>
package samples.manual;

import com.xhive.index.interfaces.*;
import java.util.Vector;
import org.w3c.dom.*;

public class SampleIndexFilter implements XhiveIndexNodeFilterIf {

  Vector v = new Vector();

  public SampleIndexFilter() {
    super();
  }

  public short acceptNode(Node n) {
    // add chapters to the index which have an even number
    if ( n.getNodeName().equals("chapter") &amp;&amp;
         (Integer.parseInt(((Element)n).getAttribute("number")) % 2 == 0) ) {
      return FILTER_ACCEPT;
    }

    return FILTER_SKIP;
  }

  public Vector getKeys(Node n) {
    // use the titles of the chapters as key for this index
    v.removeAllElements();
    v.addElement( n.getFirstChild().getFirstChild().getNodeValue() );
    return( v );
  }
}
</pre></div>

				<p>The speed of indexing depends on the implementation of the filter. By using the return
value <code>NodeFilter.FILTER_REJECT</code> for subtrees that are of no interest to the index, you can enhance the indexing performance.</p>
			</div>
		</div>

		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/LibraryIndexes.java">&lt;XhiveDir&gt;\src\samples\manual\LibraryIndexes.java</a><br/>
				<a href="../../src/samples/manual/IdAttributeIndex.java">&lt;XhiveDir&gt;\src\samples\manual\IdAttributeIndex.java</a><br/>
				<a href="../../src/samples/manual/ValueIndexIndex.java">&lt;XhiveDir&gt;\src\samples\manual\ValueIndexIndex.java</a><br/>
				<a href="../../src/samples/manual/ElementNameIndex.java">&lt;XhiveDir&gt;\src\samples\manual\ElementNameIndex.java</a><br/>
				<a href="../../src/samples/manual/CCIndex.java">&lt;XhiveDir&gt;\src\samples\manual\CCIndex.java</a><br/>
				<a href="../../src/samples/manual/SampleIndexFilter.java">&lt;XhiveDir&gt;\src\samples\manual\SampleIndexFilter.java</a><br/>
				<a href="../../src/samples/manual/FTI.java">&lt;XhiveDir&gt;\src\samples\manual\FTI.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/index/interfaces/XhiveIndexIf.html">com.xhive.index.interfaces.XhiveIndexIf</a><br/>
				<a href="../apidocs/com/xhive/index/interfaces/XhiveIndexListIf.html">com.xhive.index.interfaces.XhiveIndexListIf</a><br/>
				<a href="../apidocs/com/xhive/index/interfaces/package-summary.html">com.xhive.index.interfaces</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="traverse_xml_documents"/>5.18 Traverse XML documents</h3>
		<p>When you need to perform an action (for example, applying a change) on a number of nodes, you can use traversal. Traversal moves through a tree processing every node it encounters.</p>
		<p>In <nobr>X-Hive/DB</nobr>, you can  traverse XML documents using:</p>
		<ul>
			<li>
				<p><a href="#traversal_dom_operation" target="">DOM operations</a></p>
			</li>
			<li>
				<p><a href="#traversal_dom_traversal" target="">DOM Traversal</a></p>
			</li>
			<li>
				<p><a href="#traversal_function_objects" target="">Function objects</a></p>
			</li>
		</ul>
		<div class="div3">
			<h4><a name="traversal_dom_operation"/>5.18.1 Using DOM operations</h4>
			<p>For  information on using DOM operations, see the section on retrieving XML document parts <a href="#retrieve_xml_documents_dom_operations" target="">through DOM operations</a>.</p>
		</div>
		<div class="div3">
			<h4><a name="traversal_dom_traversal"/>5.18.2 Through DOM Traversal</h4>
			<p>The DOM Level 2 Traversal specification specifies operations for traversing XML documents. These are defined in the <code>org.w3c.dom.traversal</code> package. The package defines two different means of traversal:</p>
			<ul>
				<li>
					<p>
						<code>NodeIterator</code>
					</p>
				</li>
				<li>
					<p>
						<code>TreeWalker</code>
					</p>
				</li>
			</ul>
			<p>The difference between the two means of traversal is that a <code>NodeIterator</code> 'works' on a flat representation of an XML document (or set of XML documents), while a <code>TreeWalker</code> uses the tree representation of an XML document.</p>
			<p>For example, the following simple XML document:
			<div class="eg"><pre>
&lt;A&gt;
	&lt;B&gt;some text&lt;/B&gt;
	&lt;C&gt;
		&lt;D&gt;1st child of C&lt;/D&gt;
		&lt;E&gt;2nd child of C&lt;/E&gt;
	&lt;/C&gt;
	&lt;F&gt;some more text&lt;/F&gt;
&lt;/A&gt;
</pre></div>
			has the following flat representation:
			<div class="eg"><pre>
A  B  C  D  E  F
</pre></div>
		and the following tree representation: <div class="image"><img src="images/tree_representation.png"/><div class="caption">Figure 15. </div></div>
			</p>
			<p>The most important methods defined by both the <code>NodeIterator</code> and <code>TreeWalker</code> interface are <code>nextNode()</code> and <code>previousNode()</code>. These methods retrieve the next and previous node in a traversal. In addition, the <code>TreeWalker</code> defines a number of additional methods:</p>
			<ul>
				<li>
					<p>
						<code>parentNode()</code>
					</p>
				</li>
				<li>
					<p>
						<code>firstChild()</code>
					</p>
				</li>
				<li>
					<p>
						<code>lastChild()</code>
					</p>
				</li>
				<li>
					<p>
						<code>previousSibling()</code>
					</p>
				</li>
				<li>
					<p>
						<code>nextSibling()</code>
					</p>
				</li>
			</ul>
			<p>The <code>org.w3c.dom.traversal</code> package also defines the <code>NodeFilter</code> interface, which is used by both <code>NodeIterators</code> and <code>TreeWalkers</code> to determine what nodes should be included in the traversal.</p>
			<p>The <code>NodeFilter</code> interface contains one method, <code>acceptNode()</code>, that determines whether a node should be accepted or rejected.  <code>acceptNode()</code> returns one of the following values:</p>
			<ul>
				<li>
					<p>
						<code>FILTER_ACCEPT</code>, The current node is included.</p>
				</li>
				<li>
					<p>
						<code>FILTER_SKIP</code>, the current node is not accepted, but the children of the current node are considered for acceptance.</p>
				</li>
				<li>
					<p>
						<code>FILTER_REJECT</code>, the current node is not accepted, and, for <code>TreeWalkers</code>, the children of the current node are not considered for inclusion.</p>
				</li>
			</ul>
			<p>The following example shows a <code>NodeFilter</code> implementation, <code>sampleFilter()</code>, that skips all <code>title</code> elements and rejects all <code>list</code> elements:
				<div class="eg"><pre>
public class SampleFilter implements NodeFilter {

  public short acceptNode (Node n) {
    if (n.getNodeType() == Node.ELEMENT_NODE) {
      Element elem = (Element) n;

      if ( elem.getNodeName().equals("title")) {
        return FILTER_SKIP;
      }

      if ( elem.getNodeName().equals("list")) {
        return FILTER_REJECT;
      }
    }

    return FILTER_ACCEPT;
  }

}
</pre></div>
			</p>
			<p>To create a <code>NodeIterator</code> that uses the above filter, you need to get a handle to the <code>DocumentTraversal</code> implementation:</p>
			<div class="eg"><pre>
DocumentTraversal docTraversal = XhiveDriverFactory.getDriver().getDocumentTraversal();
</pre></div>
			<p>The <code>createNodeIterator()</code> method is used to create a <code>NodeIterator</code> and takes the following parameters:</p>
			<ul>
				<li>
					<p>
						<code>root</code>, the node at which to start the traversal.</p>
				</li>
				<li>
					<p>
						<code>whatToShow</code>, flag specifying which node types to include.</p>
				</li>
				<li>
					<p>
						<code>filter</code>, the filter to use, <code>null</code> if you do not want to use a  filter.</p>
				</li>
				<li>
					<p>
						<code>entityReferenceExpansion</code>, a flag specifying whether to expand entity reference nodes.</p>
				</li>
			</ul>
			<p>To traverse the first chapter of the UN Charter using a <code>NodeIterator</code> and without a <code>NodeFilter</code>, you could use  the following code:</p>
			<div class="eg"><pre>
System.out.println("\n#NodeIterator without a NodeFilter:");
NodeIterator iter = docTraversal.createNodeIterator(resultGetDocument,
                                                    NodeFilter.SHOW_ALL,
                                                    null,
                                                    false);
Node node;

while ((node = iter.nextNode()) != null){
  System.out.println("   Node Name = " + node.getNodeName());
}
</pre></div>
			<p>To restrict the traversal and not include <code>title</code> or <code>list</code> elements, change the second line of the above example to:</p>
			<div class="eg"><pre>
NodeIterator iter = docTraversal.createNodeIterator(resultGetDocument,
                                                    NodeFilter.SHOW_ALL,
                                                    sampleFilter,
                                                    false);
</pre></div>
			<p>Also, <code>sampleFilter</code> has to be instantiated:</p>
			<div class="eg"><pre>
NodeFilter sampleFilter = new SampleFilter();
</pre></div>
			<p>If you use a <code>TreeWalker</code> (together with <code>sampleFilter</code>) instead of a <code>NodeIterator</code> to traverse the sample document, the child nodes of the <code>list</code> element are also skipped:</p>
			<div class="eg"><pre>
TreeWalker walker = docTraversal.createTreeWalker(resultGetDocument,
                                                  NodeFilter.SHOW_ALL,
                                                  sampleFilter,
                                                  false);

while ((node = walker.nextNode()) != null){
  System.out.println("   Node Name = " + node.getNodeName());
}
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="traversal_function_objects"/>5.18.3 Using function objects</h4>
			<p>Function objects are an elegant way to traverse documents because they enable separation and re-use of traversal and function methods. A function object is a class that implements the	 <code>com.xhive.dom.interfaces.XhiveFunctionIf</code> interface. You need to define the following methods  in a function object class:<ul>
					<li>
						<p>
							<code>isDone()</code>, which indicates whether the traversal can be terminated.</p>
					</li>
					<li>
						<p>
							<code>process()</code>,which contains the code for the actual processing of the node.</p>
					</li>
					<li>
						<p>
							<code>test()</code>, which indicates whether the node has to be processed with <code>process()</code>.</p>
					</li>
				</ul>
			</p>
			<p>To create a function object that only processes <code>Element</code> nodes with an attribute <code>number</code>, you can declare the <code>test()</code> method as follows:</p>
			<div class="eg"><pre>
public boolean test (Node node){
  return node.getNodeType() == Node.ELEMENT_NODE &amp;&amp; ((Element)node).hasAttribute("number");
}
</pre></div>
			<p>The <code>test()</code> method is called for every node and determines whether to process the node.</p>
			<p>The <code>process()</code> method of the function object class defines what has to happen with the nodes that pass the test as defined in <code>test()</code>:</p>
			<div class="eg"><pre>
public void process (Node node){
  String indentation = "";
  String elementName = ((Element)node).getTagName();
  if ( elementName.equals("article") ) {
    indentation = "  ";
  }

  System.out.println( indentation + elementName + " " + ((Element)node).getAttribute("number") );
}
</pre></div>
			<p>The <code>isDone()</code> method, which the traversal method calls automatically, checks if the traversal has to continue or can terminate. In the example, all nodes have to be processed, so <code>isDone()</code> always returns <code>false</code>:</p>
			<div class="eg"><pre>
public boolean isDone (Node node){
    return false;
}
</pre></div>
			<p>You could, for example, use the <code>isDone()</code> method  to limit the number of processed nodes to a specified number:</p>
			<div class="eg"><pre>
public boolean isDone (Node node){
    return nrResults == maxNrResult;

	 // nrResults is incremented in process()
}
</pre></div>
			<p>The <code>com.xhive.dom.interfaces.XhiveNodeIf</code> interface contains the traversal methods for function objects. The following traversal methods are available:
				<ul>
					<li>
						<p>
							<code>traverseAllNodesDocumentOrder()</code> traverses the current node and all descending nodes, including attributes in document order.</p>
					</li>
					<li>
						<p>
							<code>traverseAncestors()</code> traverses the ancestors of the current node.</p>
					</li>
					<li>
						<p>
							<code>traverseAttributesDocumentOrder()</code> traverses the attributes of the current node and its descending nodes in document order.</p>
					</li>
					<li>
						<p>
							<code>traverseBreadthFirst()</code> traverses the current node and all its descendants in breadth-first order.</p>
					</li>
					<li>
						<p>
							<code>traverseChildren()</code> traverses the children of the current node.
						</p>
					</li>
					<li>
						<p>
							<code>traverseDocumentOrder()</code> traverses the current node and all its descendants in document order.</p>
					</li>
					<li>
						<p>
							<code>traverseReverseDocumentOrder()</code> traverses the current node and all of its descendants in reverse document order.</p>
					</li>
				</ul>
			</p>
			<p>The following example uses the function <code>MyNumberFinder</code> to traverse all nodes within a library in document order and breadth-first:</p>
			<div class="eg"><pre>
MyNumberFinder numberFinder = new MyNumberFinder();

System.out.println("# traverse the charter library with traverseDocumentOrder:");
charterLib.traverseDocumentOrder(numberFinder);

System.out.println("# traverse the charter library with traverseBreadthFirst:");
charterLib.traverseBreadthFirst(numberFinder);
</pre></div>
			<p>You could also use the same function object  to traverse a single document in various ways:</p>
			<div class="eg"><pre>
Document chapter5Document = (Document)charterLib.get("UN Charter - Chapter 5");

System.out.println("# traverse \"UN Charter - Chapter 5\" with traverseDocumentOrder:");
((XhiveDocumentIf)chapter5Document).traverseDocumentOrder(numberFinder);

System.out.println("# traverse \"UN Charter - Chapter 5\" with traverseReverseDocumentOrder:");
((XhiveDocumentIf)chapter5Document).traverseReverseDocumentOrder(numberFinder);
</pre></div>
		</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/DomTraversal.java">&lt;XhiveDir&gt;\src\samples\manual\DomTraversal.java</a><br/>
				<a href="../../src/samples/manual/MyNumberFinder.java">&lt;XhiveDir&gt;\src\samples\manual\MyNumberFinder.java</a><br/>
				<a href="../../src/samples/manual/FunctionObjects.java">&lt;XhiveDir&gt;\src\samples\manual\FunctionObjects.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/traversal/package-summary.html">org.w3c.dom.traversal</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveFunctionIf.html">com.xhive.dom.interfaces.XhiveFunctionIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="export_xml_documents"/>5.19 Export XML documents</h3>
    <p>For serialization of a DOM (to e.g. a String or an output stream), you can use our <code>toXml(...)</code> method on <code>XhiveNodeIf</code>, or use a DOM Load/ Save <code>LSSerializer</code>, e.g.:</p>
		<div class="eg"><pre>
LSSerializer writer = charterLib.createLSSerializer();
writer.getDomConfig().setParameter("format-pretty-print", Boolean.TRUE);
String output = writer.writeToString(firstDocument);</pre></div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/DOMLoadSave.java">&lt;XhiveDir&gt;\src\samples\manual\DOMLoadSave.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
				<a href="../apidocs/org/w3c/dom/ls/LSSerializer.html">org.w3c.dom.ls.LSSerializer</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="publish_xml_documents"/>5.20 Publish XML documents</h3>
		<p>When publishing XML documents from <nobr>X-Hive/DB</nobr>, you can:</p>
		<ul>
			<li>
				<p>Publish using XSLT, through the interface <code>XhiveTransformerIf</code>.</p>
			</li>
			<li>
				<p>Publish to PDF, through the interface <code>XhiveFormatterIf</code>.</p>
			</li>
		</ul>
		<div class="div3">
			<h4><a name="publish_using_xslt"/>5.20.1 Publish using XSLT</h4>
			<p><nobr>X-Hive/DB</nobr> contains an  XSL Transformation (XSLT) engine. XSLT provides a declarative means for transforming an XML source tree into any required result tree.  This  enables publishing of XML content in (X)HTML, WAP/WML, PDF, or any other format. For more information on XSLT, refer to the <a href="http://www.w3.org/TR/xslt" target="_new">W3C website</a>.</p>
			<p>To publish from <nobr>X-Hive/DB</nobr> using XSLT, you specify an XML and XSL document within a Java application. Both the XML and XSL documents are stored in the database. The XSL document, which is actually an XML file, specifies the transformations that need to take place to produce the desired output.</p>
			<p>After specifying which XML and XSL document to use, you need to use either the <code>transformToString()</code>, <code>transformToStream()</code> or <code>transformToDocument()</code> method to produce the output. The output can be another XML document, or a document of any other format.</p>
			<p>The following example takes a document from the databases, parses an XSL file and then uses the <code>transformToString()</code> method to transform it and output it as a string.</p>
			<div class="eg"><pre>
// parse the XSL source file
LSParser parser = charterLib.createLSParser();
Document xslDocument = parser.parseURI(new File(baseDirectory + "/publish2HTML.xsl").toURL().toString());

// get a handle to the Transformer implementation
XhiveTransformerIf transformer = XhiveDriverFactory.getDriver().getTransformer();

// retrieve the document to publish
Document firstDocument = (Document) charterLib.get("UN Charter - Chapter 1");

// transform the XML document using the XSL document
String result = transformer.transformToString( firstDocument, xslDocument);
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="publish_to_pdf"/>5.20.2 Publish to PDF</h4>
			<p>The steps required for producing output in PDF format are similar to those required for producing other formats. However, a different interface, <code>com.xhive.util.interfaces.XhiveFormatterIf</code> exists for converting output to PDF. This interface contains the <code>formatAsPDF()</code> method.</p>
			<p>The <code>formatAsPDF()</code> method can either format an XSL-FO document or an XML document as a PDF string. In the latter case, you need to supply an XSL document.</p>
			<p>The following example retrieves an XML document and applies the <code>formatAsPDF()</code> method   to the XML document and a parsed XSL document to produce a PDF string. This string is written to a file:</p>
			<div class="eg"><pre>
// parse the XSL source file
LSParser parser = charterLib.createLSParser();
Document xslDocument = builder.parseURI(new File(baseDirectory + "/publish2PDF.xsl").toURL().toString());

XhiveFormatterIf formatter = XhiveDriverFactory.getDriver().getFormatter();

// format the XML document as PDF using the parsed XSL document
String result = formatter.formatAsPDF(rootLibrary, firstDocument, xslDocument);

// output the PDF-file
File pdfFile = new File(baseDirectory + "/output.pdf");
FileWriter fw = new FileWriter(pdfFile);
PrintWriter pw = new PrintWriter(fw);
pw.println(result);
fw.close();
</pre></div>
		</div>
		<div class="note"><p class="prefix"><b>Note:</b></p>When parsing XSL documents, the <code>XhiveLibraryIf.PARSER_NAMESPACES_ENABLED</code> option must be <code>TRUE</code>. Otherwise an exception is thrown during transformation of the XML document.</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/publish2HTML.java">&lt;XhiveDir&gt;\src\samples\manual\publish2HTML.java</a><br/>
				<a href="../../src/samples/manual/publish2PDF.java">&lt;XhiveDir&gt;\src\samples\manual\publish2PDF.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/util/interfaces/XhiveTransformerIf.html">com.xhive.util.interfaces.XhiveTransformerIf</a><br/>
				<a href="../apidocs/com/xhive/util/interfaces/XhiveFormatterIf.html">com.xhive.util.interfaces.XhiveFormatterIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="use_xlink"/>5.21 Use XLink</h3>
		<p>XLink is a W3C recommendation that enables links between XML documents. You can use XLink to create simple links equivalent to <code>&lt;a&gt;</code> links in HTML, and to create more complex links. For a complete and up-to-date description of XLink, refer to the <a href="http://www.w3.org/TR/xlink/" target="_new">XML Linking Language (XLink) Version 1.0 documentation</a> at the W3C website.</p>
		<p>
			All information about an XLink is stored as an attribute. For example, the attribute <code>xlink:show</code> describes how the content should be displayed,  while <code>xlink:type</code> describes the type of the XLink. The <code>xlink:href</code> attribute defines the target of the link and can be defined using URI's and XPointer. For example:
			<div class="eg"><pre>
xlink:href="/UN Charter/UN Charter - Chapter 4#xpointer(/chapter[1]/title[1])"
</pre></div>
			defines the (first) title of the first chapter of document "UN Charter - Chapter 4" in library "UN Charter" as the target for this link. For more information on syntax of such links, check the section on <a href="#retrieve_xml_documents_executeFullPathXPointerQuery" target="">executeFullPathXPointerQuery</a>.
		</p>
		<p>The XLink information is accessible through the DOM API because it is stored as attributes. However, it is much easier  to use the convenience methods for XLink as provided by <nobr>X-Hive/DB</nobr> through the interfaces within package <code>com.xhive.dom.xlink.interfaces</code>.</p>
		<p>The convenience methods available include methods for:</p>
		<ul>
			<li>
				<p>Retrieving specific attributes, for example <code>getTitle()</code>, <code>getHRef()</code>, and <code>getRole()</code>.</p>
			</li>
			<li>
				<p>Retrieving all available links, for example <code>getLinks()</code>, <code>getLinksByTitle()</code> and <code>getLinksByRole()</code>.</p>
			</li>
			<li>
				<p>Retrieving all nodes linking to a specific resource, for example <code>getNodesLinkingTo()</code>.</p>
			</li>
			<li>
				<p>Retrieving the information from arcs, for example <code>getArcs()</code>, <code>getFrom()</code>, <code>getTo()</code>, <code>getStartingResources()</code> and <code>getEndingResources()</code>.</p>
			</li>
			<li>
				<p>Retrieving the information from locators, for example <code>getLocators()</code>, <code>getRole()</code> and <code>getLabel()</code>.</p>
			</li>
			<li>
				<p>Retrieving (the content of) the targeted resources, for example <code>expandDocument()</code> and <code>getResourcesLinkedBy()</code>.</p>
			</li>
		</ul>
		<p>Sample <code>DomLinkBase.java</code> demonstrates several of the XLink methods available in <nobr>X-Hive/DB</nobr>:</p>
		<div class="eg"><pre>
//Gets an Iterator with all extended links
for (Iterator i = linkBase.getLinksBy("type", "extended"); i.hasNext();) {
  XhiveExtendedLinkIf link = (XhiveExtendedLinkIf) i.next();
  System.out.println("       Title = " + link.getTitle());
  //Gets an Iterator with all arcs
  for (Iterator j = link.getArcs(); j.hasNext();) {
    XhiveArcIf arc = (XhiveArcIf) j.next();
    if (arc.getFrom().equals("Margaret Martin")) {
      for (Iterator m = arc.getEndingResources(); m.hasNext();) {
        XhiveLocatorIf locator = (XhiveLocatorIf) m.next();
        System.out.println("               *Checked out resource = " + locator.getLabel());
      }
    }
  }
}
</pre></div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/XLink.java">&lt;XhiveDir&gt;\src\samples\manual\XLink.java</a><br/>
			</div><br/>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/DomLinkBase.java">&lt;XhiveDir&gt;\src\samples\manual\DomLinkBase.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/dom/xlink/interfaces/package-summary.html">com.xhive.dom.xlink.interfaces</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="use_as_models"/>5.22 Use abstract schemas</h3>
		<p>The abstract schema support consists of a set of interfaces (formerly a <a href="http://www.w3.org/TR/2002/WD-DOM-Level-3-ASLS-20020114/abstract-schemas.html" target="_new">W3C draft specification</a>) that enables the use of e.g. DTD and XML Schema information with the DOM. Abstract schema contains interfaces for handling schema information itself (for example, the structure of element declarations) plus interfaces for applying schema information to the validation of DOMs. <nobr>X-Hive/DB</nobr> provides access to former W3C specification for use with DTDs and more limited (only the readonly part of the <code>ASModel</code> interface) for XML Schema, with some product-specific alterations. For a detailed description of the interfaces used for abstract schema models, refer to the API documentation.</p>
		<div class="note"><p class="prefix"><b>Note:</b></p>
			Important: At this time, the DOM L3 abstract schema specifications are
			cancelled by W3C. We will continue to support the AS specification for the
			manipulation of the model.
		</div>
		<p>
			In <nobr>X-Hive/DB</nobr>, ASModels representing DTDs or XML Schemas are stored in the <a href="#catalog" target="">catalog</a>. Usually you use the abstract schema of a document that was retrieved during parsing with validation. To use an abstract schema which has already been stored in the catalog, use the <code>setActiveASModel()</code> method:
			<div class="eg"><pre>
Document doc = charterLib.createDocument(null, "chapter", null);
DocumentAS document = (DocumentAS) doc;
document.setActiveASModel(model);
</pre></div>
		</p>
		<p>
			It is also possible to get information about the declarations in the DTD, using the <code>ASModel</code>, <code>ASElementDecl</code>, <code>ASAttributeDecl</code>, <code>ASNotationDecl</code>, and <code>ASEntityDecl</code> interfaces. This is not yet possible for XML Schemas, use the <a href="#use_psvi_interfaces" target="">XML Schema API</a> for that. For example, you can use the following code  to show all required attributes of an <code>element</code>:
<div class="eg"><pre>
ASModel model = ((DocumentAS) document).getActiveASModel();
ASElementDecl eltDeclaration = model.getElementDecl(element.getTagName());
ASNamedObjectMap attributeDeclarations = eltDeclaration.getASAttributeDecls();
System.out.println("The following attributes are all required:");
for (int i = 0; i &lt; attributeDeclarations.getLength(); i++) {
  ASAttributeDecl attDecl = (ASAttributeDecl) attributeDeclarations.item(i);
  // Check whether this attribute is required
  if (attDecl.getDefaultType() == ASAttributeDecl.REQUIRED) {
    String attName = attDecl.getObjectName();
    System.out.println(attName);
  }
}
</pre></div>
		</p>
		<p>
		  As said, one way to get an <code>ASModel</code> into the catalog is to parse a document with validation. You can also parse
		  a DTD or XML Schema directly into the catalog of a library (or the catalog of the first library that is an ancestor of this library and
		  has a catalog), with code like:
<div class="eg"><pre>
ASDOMBuilder builder = (ASDOMBuilder) charterLib.createLSParser();
model = builder.parseASURI(url, ASDOMBuilder.DTD_SCHEMA_TYPE);
unCharterCatalog.setPublicId(publicId, model);</pre></div>
		</p>
		<p>
		  In a similar way, it is possible to serialize a schema model in the catalog:
<div class="eg"><pre>
DOMASWriter writer = (DOMASWriter) charterLib.createLSSerializer();
ByteArrayOutputStream output = new ByteArrayOutputStream();
writer.writeASModel(output, model);
String schemaString = output.toString();
</pre></div>
		</p>

		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/DOMValidation.java">&lt;XhiveDir&gt;\src\samples\manual\DOMValidation.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/org/w3c/dom/as/package-summary.html">org.w3c.dom.as</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveCatalogIf.html">com.xhive.dom.interfaces.XhiveCatalogIf</a><br/>
			</div><br/>
		
	</div>

 <div class="div2">
   <h3><a name="Revalidation_document_schema"/>5.23 Revalidate documents with XML schema</h3>
   <p>
     To revalidate a document with XML schema, the <code>XhiveDocumentIf</code> function <code>normalizeDocument</code>
     should be used.
     <a href="#dom_configuration" target="">Configuration settings</a> of the normalization process can be set on the document
     configuration. To normalize a document with validation, the <code>"validate"</code> parameter must be turned on.
     As function <code>normalizeDocument</code> does not throw any exceptions, users are advised to set an error handler
     during normalization. The following piece of code shows how to set the parameters and normalize the document:
<div class="eg"><pre>
DOMConfiguration config = ((XhiveDocumentIf)document).getDomConfig();
config.setParameter("validate", Boolean.TRUE);
config.setParameter("error-handler", new SimpleDOMErrorPrinter());
document.normalizeDocument();
</pre></div>
   </p>
   <p>
     During validated parsing and validated normalization, <a href="#use_psvi_interfaces" target="">psvi</a> information is
     set if the document was parsed with parameter <code>"xhive-psvi"</code> turned on.
     If a document is parsed without validation, <a href="#use_psvi_interfaces" target="">psvi</a> information can be set at a
     later stage during revalidation.
   </p>
   <p>
     To revalidate against a different schema, parameter <code>"schema-location"</code> can be used.
     Before a schema location can be set, the schema type must also be set.
     The following code shows how to set a schema-location:
<div class="eg"><pre>
config.setParameter("schema-type", "http://www.w3.org/2001/XMLSchema");
config.setParameter("schema-location", "personal.xsd");
</pre></div>
     If the schema-location is set, the validator will first search for a corresponding XML schema in the catalog.
     If no such schema is found, the validator will search for a schema in the file system. During parsing of a document,
     the schema-location is resolved relative to the uri of the document. During validation, this uri is not available.
     Therfore a full path must be set if revalidation is executed against a schema located in the filesystem.
   </p>

   <p class="prefix"><b>See also:</b></p>
   <div class="refheader"><b>samples:</b></div><div class="ref2samples">
     <a href="../../src/samples/manual/ValidateDocumentWithXMLSchema.java">&lt;XhiveDir&gt;\src\samples\manual\ValidateDocumentWithXMLSchema.java</a><br/>
   </div><br/>
   <div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
     <a href="../apidocs/com/xhive/dom/interfaces/XhiveDocumentIf.html">com.xhive.dom.interfaces.XhiveDocumentIf</a><br/>
     <a href="../apidocs/org/w3c/dom/xhivecore/DOMConfiguration.html">org.w3c.dom.xhivecore.DOMConfiguration</a><br/>
   </div><br/>
   
 </div>

 <div class="div2">
    <h3><a name="use_psvi_interfaces"/>5.24 Access PSVI information</h3>
    <p>
      Access to schema and validation information of attributes and elements can be achieved by using the
      Xerces XML Schema API interfaces. To acces the psvi information of an element, the element must be cast to
      an <code>ElementPSVI</code> object.
      The following piece of code shows how retrieve the validity of a node:
<div class="eg"><pre>
Element email = (Element) document.getElementsByTagNameNS(null, "email").item(0);
ElementPSVI elemPsvi = (ElementPSVI) email;
short validity = elemPsvi.getValidity();
</pre></div>
    </p>
    <p>
      Schema information can be traversed by retrieving element declarations, attribute declaration and type definitions.
      The following piece of code shows how to retrieve a the data type name of an element:
<div class="eg"><pre>
XSTypeDefinition elemTypeDef = elemPsvi.getTypeDefinition();
String typeName = elemTypeDef.getName();
</pre></div>
    </p>
   <p>
     Another way to access data type information of a elements and attributes is by using DOM level 3
     <code>TypeInfo</code> which can be accessed by using the <code>XhiveNodeIf</code> interface.
   </p>
   <p>
     The PSVI information can only be accessed to its full extent when <code>LSParser</code> parameter
     <code>"xhive-psvi</code> is turned on during parsing. If a document is created by using
     <code>XhiveLibraryIf</code> (which servers as <code>DOMImplementation</code>), function
     <code>createDocumentPSVI</code> must be used.
   </p>
   <p class="prefix"><b>See also:</b></p>
   <div class="refheader"><b>samples:</b></div><div class="ref2samples">
     <a href="../../src/samples/manual/PSVI.java">&lt;XhiveDir&gt;\src\samples\manual\PSVI.java</a><br/>
   </div><br/>
   <div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
     <a href="../apidocs/org/w3c/dom/xhivecore/TypeInfo.html">org.w3c.dom.xhivecore.TypeInfo</a><br/>
     <a href="../apidocs/com/xhive/dom/interfaces/XhiveNodeIf.html">com.xhive.dom.interfaces.XhiveNodeIf</a><br/>
     <a href="../apidocs/org/apache/xerces/xni/psvi/package-summary.html">org.apache.xerces.xni.psvi</a><br/>
     <a href="../apidocs/org/apache/xerces/impl/xs/psvi/package-summary.html">org.apache.xerces.impl.xs.psvi</a><br/>
   </div><br/>
   


 </div>

	<div class="div2">
		<h3><a name="manage_users_and_groups"/>5.25 Manage users and groups</h3>



    <p>
      <nobr>X-Hive/DB</nobr> provides authorization features to support authorization and security requirements. Authorization in this context means managing the actions of users, and security means managing user access to information.
    </p>
    <p>
      The <nobr>X-Hive/DB</nobr> security model is based on three levels: user, administrator, and super user. These types of user have distinct access rights:
    </p>
    <ul>
      <li>
        <p>The user can access all data for which they have authorization.</p>
      </li>
      <li>
        <p>The administrator can access all the data and user information in one database.</p>
      </li>
      <li>
        <p>The super user can create and delete a database, but cannot access any of the data stored in the databases.</p>
      </li>
    </ul>
    <p>
      You can refine this basic level of security and authorization  using the <nobr>X-Hive/DB</nobr> authority object, represented in the <nobr>X-Hive/DB</nobr> API by the <code>XhiveAuthorityIf</code> interface. These objects are associated with, among others, <code>Document</code> objects, and store the following permission settings: Executable: sets whether the object can be executed. (Note: Currently, there are no objects in <nobr>X-Hive/DB</nobr> to which this setting applies), Readable: sets whether the object can be read, Writable: sets whether the object can be written to or deleted.
    </p>
    <p>
      A document object always has exactly one attached authority object. The authority object divides users into three levels of access for the object:</p>
    <ul>
      <li>
        <p>
          <code>owner</code>: the user who owns this object.
        </p>
      </li>
      <li>
        <p>
          <code>group</code>: the group that has group access rights to the object.
        </p>
      </li>
      <li>
        <p>
          <code>other</code>: access rights for all other users.
        </p>
      </li>
    </ul>
    <p>
      It is logical for the <code>owner</code> to have higher access rights than <code>group</code>, and for <code>group</code> in turn to have higher access rights than <code>other</code>, but <nobr>X-Hive/DB</nobr> gives you complete freedom to assign any access rights to any of these access levels.
    </p>
		<p>The <nobr>X-Hive/DB</nobr> API offers several methods for managing users, user lists, groups and group lists, including:</p>
		<ul>
			<li>
				<p>In interface <code>XhiveUserListIf</code>: <code>addUser()</code>, <code>removeUser()</code>, <code>getUser()</code> and <code>hasUser()</code>.</p>
			</li>
			<li>
				<p>In interface <code>XhiveUserIf</code>: <code>setPassword()</code> and <code>isAdministrator()</code>.</p>
			</li>
			<li>
				<p>In interface <code>XhiveGroupListIf</code>: <code>addGroup()</code>, <code>removeGroup()</code>, <code>getGroup()</code> and <code>hasGroup()</code>.</p>
			</li>
			<li>
				<p>In interface <code>XhiveGroupIf</code>: <code>isMember()</code> and <code>users()</code>.</p>
			</li>
		</ul>
		<div class="eg"><pre>
XhiveUserListIf userList = united_nations_db.getUserList();
XhiveGroupListIf groupList = united_nations_db.getGroupList();

// create a new user (unless it already exists)
if ( !userList.hasUser(userName) ) {
  userList.addUser(userName, userPassword);
}

// create a new group  (unless it already exists)
if ( !groupList.hasGroup(groupName) ) {
  groupList.addGroup(groupName);
}

// add user to group (unless it is already a member)
XhiveUserIf user = userList.getUser(userName);
XhiveGroupIf group = groupList.getGroup(groupName);
if ( !group.isMember(user) ) {
  user.addGroup(group);
}
</pre></div>
		<p>For a complete list of supported methods, refer to the API documentation for the interfaces mentioned.</p>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/ManageUsers.java">&lt;XhiveDir&gt;\src\samples\manual\ManageUsers.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/core/interfaces/XhiveGroupIf.html">com.xhive.core.interfaces.XhiveGroupIf</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveGroupListIf.html">com.xhive.core.interfaces.XhiveGroupListIf</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveUserIf.html">com.xhive.core.interfaces.XhiveUserIf</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveUserListIf.html">com.xhive.core.interfaces.XhiveUserListIf</a><br/>
			</div><br/>
		
	</div>
	<div class="div2">
		<h3><a name="use_versioning"/>5.26 Use versioning</h3>
		<p><nobr>X-Hive/DB</nobr> enables the storage of different versions of a document within the context of that document through the (optional) versioning feature. To enable versioning for a document, use the <code>makeVersionable()</code> method in <code>XhiveDocumentIf</code>:</p>
		<div class="eg"><pre>
XhiveDocumentIf doc = (XhiveDocumentIf)briefingLib.get("briefing.xml");
doc.makeVersionable();
</pre></div>
		<p>The <code>getXhiveVersion()</code> method in <code>XhiveDocumentIf</code> can be used to get the last version of a document:</p>
		<div class="eg"><pre>
// get the last version of doc
XhiveVersionIf lastVersion = ((XhiveDocumentIf)doc).getXhiveVersion();
</pre></div>
		<p>The <code>XhiveVersionIf</code> interface contains several methods through which information about a version can be obtained, including <code>getDate()</code>, <code>getLabel()</code> and <code>getCreator()</code>:</p>
		<div class="eg"><pre>
System.out.println("id           : " + version.getId());
System.out.println("creation date: " + version.getDate().toString());
System.out.println("label        : " + version.getLabel());
System.out.println("created by   : " + version.getCreator().getName());
</pre></div>
		<div class="div3">
			<h4><a name="use_versioning_check_out_in"/>5.26.1 Working with versioned documents</h4>
			<p>Once versioning has been turned on for a document, a document has to be checked out (through the <code>checkOut()</code> method) before it can be updated:</p>
			<div class="eg"><pre>
// do a check out of the last version
Document lastVersionDoc = lastVersion.checkOut();
</pre></div>
			<p>A versioned document which has not been checked out is read-only. An attempt to update a versioned document
without doing a check out generates a <code>VERSION_ACCESS_DENIED</code> exception. Each versioned document can
only be checked out by one user at a time (i.e. a check out lock is set).
An attempt to check out a document which has been checked out by another user
generates a <code>VERSION_CHECKED_OUT</code> exception.</p>
			<p>After updating a versioned document, the document has to be checked in using the <code>checkIn()</code> method:</p>
			<div class="eg"><pre>
// do some updates on "checkedOutDoc"
// ...

// check the document in
lastVersion.checkIn(lastVersionDoc);
</pre></div>
			<p>The <code>checkIn()</code> method creates a new version, and releases the check out lock. An alternative way to release the check out lock is through the <code>abort()</code> method. When <code>abort() </code> is used, all updates on the checked out document are ignored and no new version is created.</p>
			<div class="note"><p class="prefix"><b>Note:</b></p>
				<p>Versioned documents remain accessible through the normal <a href="#retrieve_xml_documents" target="">retrieval methods for documents</a>. The last stored version of a versioned document is used for the retrieval, traversal, query or index.</p>
			</div>
		</div>
		<div class="div3">
			<h4><a name="use_versioning_retrieving_versions"/>5.26.2 Retrieving (older) versions of documents</h4>
			<p>There are several methods to retrieve (older) versions of documents:
				<ul>
					<li>
						<p>
							<code>getXhiveVersion()</code> in <code>XhiveDocumentIf</code> returns the last version of a document.</p>
					</li>
					<li>
						<p>
							<code>getPreviousVersion()</code> in <code>XhiveVersionIf</code> returns the previous version of a document.</p>
					</li>
					<li>
						<p>
							<code>getNextVersions()</code> in <code>XhiveVersionIf</code> returns all next versions of a document.</p>
					</li>
				</ul>
			</p>
			<p>Alternatively, a document's versionspace can be used to get access to the versions of a document. Every versioned document has its own versionspace which is automatically created when versioning is enabled. Method <code>getVersionSpace()</code> in <code>XhiveVersionIf</code> is used to get access to the versionspace:</p>
			<div class="eg"><pre>
XhiveVersionSpaceIf versionSpace = doc.getXhiveVersion().getVersionSpace();
</pre></div>
			<p>To retrieve a version through a versionspace, use either the <code>getVersionById()</code> or the <code>getVersionByLabel()</code> method:</p>
			<div class="eg"><pre>
// example of accessing a version via the getVersionById() and getVersionByLabel() methods
XhiveVersionIf version1_1 = versionSpace.getVersionById("1.1");
Document doc1_1 = version1_1.getAsDocument();
</pre></div>
		</div>
		<div class="div3">
			<h4><a name="use_versioning_branching"/>5.26.3 Branching</h4>
			<p>A version branch is a sequence of versions which has been seperated from the main
sequence of versions.  Branches are normally used when multiple (groups of) users are
working in parallel on the same documents. <nobr>X-Hive/DB</nobr> automatically creates a new version branch if a document is checked in on a version which has one or more successors.</p>
			<p>For example: a team of analysts is working on an article entitled "The European Airline Industry, 2002-2005". The first four sections of the article are introductory and generic. Section 5 deals with
future scenarios for the airlines. Because of the dynamic market situation the team decides to split itself in two smaller groups. One group will write section 5 assuming that the European Union allows government support to airlines while the second group writes the same section assuming that government support will be considered illegal.</p>
			<p>Up until section 5, the document has been checked out and checked in twice, so the
latest version is 1.3. The first group ("Government Intervention") checks out this version
and adds its section 5. After they check in their document, version 1.4 is created.</p>
			<p>The second group ("Free Market") checks out 1.3, adds their story of how the airline market will
evolve and checks the document in. Because the check in occurs on
a version (1.3) which has a successor (1.4), a new branch of version 1.3 is created: 1.3.2.1. The next check in by the "Free Market"
group will create version 1.3.2.2. The first group continues to work on the head branch, their next check in will
create version 1.5.
<div class="image"><img src="images/branching.png" alt="Overview of branches"/><div class="caption">Figure 16. Overview of branches</div></div>
			</p>
			<p><nobr>X-Hive/DB</nobr> automatically numbers versions and branches as follows:</p>
			<ul>
				<li>
					<p>versions: 1.1, 1.2, 1.3 etc.</p>
				</li>
				<li>
					<p>branches (for version 1.x): 1.x.2.1, 1.x.4.1, 1.x.6.1 etc</p>
				</li>
				<li>
					<p>sub-branches (for branch 1.x.y.1): 1.x.y.1.2.1, 1.x.y.1.4.1, 1.x.y.1.6.1 etc.</p>
				</li>
				<li>
					<p>etc.</p>
				</li>
			</ul>
			<p>The <code>getBranches()</code> method in <code>XhiveVersionSpaceIf</code> returns the branches of a document. The <code>XhiveBranchIf</code> interface contains methods to retrieve the versions and documents of a branch: <code>getVersions()</code>, <code>getVersionByDate()</code> and <code>getDocumentLastStored()</code>.</p>
		</div>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/Versioning.java">&lt;XhiveDir&gt;\src\samples\manual\Versioning.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveDocumentIf.html">com.xhive.dom.interfaces.XhiveDocumentIf</a><br/>
				<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
				<a href="../apidocs/com/xhive/versioning/interfaces/XhiveBranchIf.html">com.xhive.versioning.interfaces.XhiveBranchIf</a><br/>
				<a href="../apidocs/com/xhive/versioning/interfaces/XhiveVersionIf.html">com.xhive.versioning.interfaces.XhiveVersionIf</a><br/>
				<a href="../apidocs/com/xhive/versioning/interfaces/XhiveVersionSpaceIf.html">com.xhive.versioning.interfaces.XhiveVersionSpaceIf</a><br/>
			</div><br/>
		
	</div>
      <div class="div2">
        <h3><a name="use_metadata"/>5.27 Using metadata on library children</h3>
        <p>
          All library children (libraries, documents and blobs) can contain metadata.  Metadata
          consists of key-value pairs of strings.  These can be used for any purpose desired,
          e.g. to store information about a document that you do not want to store in the document
          itself, because it does not fit the DTD in use.  The metadata is a
          <code>java.util.Map</code> that can only contain strings.  Example:
          <div class="eg"><pre>
XhiveDocumentIf doc = ...;
doc.getMetadata().put("author", "Jane Doe");
</pre></div>
        </p>
        <p>
          If the document is versioned, the metadata cannot be changed, just like the document
          itself.  When a new version of the document is checked in, the metadata of the document
          that is checked in is also checked in, overriding the previous version of the metadata.
        </p>
        <p>
          For use of metadata in XQuery queries, see the <code>xhive:metadata</code> function in the
          <a href="#xquery_extension_functions" target="">section on XQuery extension functions</a>.
        </p>
      </div>
	<div class="div2">
		<h3><a name="use_jaas"/>5.28 Using JAAS to connect to the database</h3>
		<p><nobr>X-Hive/DB</nobr> has its own users and groups, and authority system. However, in certain cases you will want to authenticate users
		through external authentication systems, like an LDAP database or based on operating system authentication.</p>
		<p><nobr>X-Hive/DB</nobr> allows you to authenticate based on <a href="http://java.sun.com/products/jaas/" target="_new">JAAS</a>.
		JAAS offers a pluggable authentication module framework, with modules offered for different kinds of authentication systems.</p>
		<p>When <nobr>X-Hive/DB</nobr> is used in combination with JAAS, the checking of username and password is handled by JAAS. All other
		user and group related functionality is still handled by <nobr>X-Hive/DB</nobr> however. To enable it to work, once JAAS authentication is
		succesful <nobr>X-Hive/DB</nobr> will automatically create users and groups within <nobr>X-Hive/DB</nobr> that match the authentication information.</p>
		<p>To be able to use JAAS authentication with <nobr>X-Hive/DB</nobr>, you will have to implement certain Java interfaces and configure
		the PAM (Pluggable Authentication Module) used. Specifically, the following has to be done:</p>
		<ul>
		  <li>You must configure your PAM, e.g. server to connect to, in the JAAS
		  configuration file or in your Java code (module specific).</li>
		  <li>Then you must enable JAAS on the <nobr>X-Hive/DB</nobr> driver object, with a call to 
		    <code>driver.getSecurityConfig().enableJavaAuthentication(chosenConfigurationEntryName, XhiveNameHandlerIf)</code>. You
		    can only call this method for drivers that connect directly to the bootstrap file (not to a <code>xhive://...</code> URL,
		    although your application can act as a server for other such drivers). Side note: The standard dedicated
		    server that comes with <nobr>X-Hive/DB</nobr> cannot be configured for JAAS so cannot be used in combination with JAAS.</li>
		  <li>For the <code>XhiveNameHandlerIf</code> argument in the above call you must provide your own implementation of that
		  interface. The goal of that interface is to map JAAS user/group objects (<code>Subject</code>s) to <nobr>X-Hive/DB</nobr> usernames
		  and groupnames (<code>String</code>s).</li>
		  <li>Then, when connecting on a session you must use <code>connect(databaseName, CallbackHandler)</code> instead 
		  of the standard <code>connect(userName, password, databaseName)</code>.</li>
		  <li>The callback handler used in the call above is a JAAS interface that allows passing authentication parameters to your PAM.
		  You can provide your own implementation, but there may already be standard classes available that you can use, like
		  <a href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/spec/com/sun/security/auth/callback/DialogCallbackHandler.html" target="_new">
		  DialogCallbackHandler</a> (that is used in the Adminclient for JAAS authentication).</li>
		</ul>
		<p>The exact details of implementing and configuring JAAS are not explained here, as it is dependent on the PAM and actual authentication system used. You can
		start with the following sources for more information:</p>
	  <ul>
	    <li>We provide a sample for connecting to an LDAP server in the <var>XhiveDir</var><code>src/samples/ldap</code> 
	    directory, which shows examples of what interfaces must be implemented, and what API calls must be used to enable JAAS authentication.</li>
	    <li>Sun offers <a href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/JAASRefGuide.html" target="_new">reference guides</a>,
	    <a href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/tutorials/GeneralAcnOnly.html" target="_new">tutorials</a> and
	    <a href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/spec/index.html" target="_new">API documentation</a>.</li>
	  </ul>
		<p class="prefix"><b>See also:</b></p>
			<div class="refheader"><b>samples:</b></div><div class="ref2samples">
				<a href="../../src/samples/manual/../ldap/SampleClient.java">&lt;XhiveDir&gt;\src\samples\manual\../ldap/SampleClient.java</a><br/>
				<a href="../../src/samples/manual/../ldap/XhiveServerWithLDAP.java">&lt;XhiveDir&gt;\src\samples\manual\../ldap/XhiveServerWithLDAP.java</a><br/>
			</div><br/>
			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
				<a href="../apidocs/com/xhive/core/interfaces/XhiveDriverIf.html">com.xhive.core.interfaces.XhiveDriverIf</a><br/>
				<a href="../apidocs/com/xhive/core/interfaces/XhiveSessionIf.html">com.xhive.core.interfaces.XhiveSessionIf</a><br/>
			</div><br/>
		
	</div>
</div>

	
<div class="div1">
	<h2><a name="sessions"/>6 Using Sessions &amp; Locking</h2>
	<p>
    In <nobr>X-Hive/DB</nobr>, all access to the database must take place in transactions within sessions.
    Sessions can be seen as connections to a database. In a session, you can start multiple
    transactions. Within those transactions, you can perform actions on the database,
    commit changes to the database, or do rollbacks.
  </p>
	<p>
    Associated with transactions are locks. Whenever you change data in a transaction, that data
    is locked. Locks are released when a transaction is committed or rollbacked. When one transaction
    has locked data, other transactions can not alter it at the same time.
  </p>
	<p>
    The <nobr>X-Hive/DB</nobr> session mechanism complies with the ACID database properties:
    <ul>
			<li>
				<p>
        Atomicity: either all actions in a transaction succeed and are made persistent in the database 
        (after a <code>commit()</code>), or none of the actions are (after a <code>rollback()</code>).
      </p>
			</li>
			<li>
				<p>
        Consistency: within a transaction you get a coherent view of the database. 
	This means that during a transaction, all read actions on a particular part of the database will 
	return the same value.
      </p>
			</li>
			<li>
				<p>
        Isolation: changes made in one transaction are not visible in concurrent transactions until the transaction is committed.
      </p>
			</li>
			<li>
				<p>
        Durability: it is guaranteed that when a <code>commit()</code> succeeds, the data is really
        written to the disk.
      </p>
			</li>
		</ul>
	</p>
	<div class="div2">
		<h3><a name="session_objects"/>6.1 Working with sessions</h3>
		<p>
	    This section gives information on how <code>XhiveSessionIf</code> objects should be used.
	    There is information on the normal order in which the methods of session are called and details
	    on the individual methods.
	  </p>
		<div class="div3">
			<h4><a name="sessions_flow"/>6.1.1 The session lifecycle</h4>
			<p>
  	    Sample code on how to <a href="#connect_to_the_database" target="">create</a>
  	    and <a href="#using_sessions_and_transactions" target="">work</a>
  	    with sessions can be found in the "Creating Applications" chapter.
  	  </p>
			<p>
    	  A full session lifecycle consists of at least the following
    	  operations (except for <code>createSession()</code> all methods mentioned can be found in the <code>XhiveSessionIf</code> interface):
    	  <ul>
					<li>
						<p>
							<a href="#session_createsession" target=""><code>createSession()</code></a> (on <code>XhiveDriverIf</code>)</p>
					</li>
					<li>
						<p>
							<a href="#session_join" target=""><code>join()</code></a>
						</p>
					</li>
					<li>
						<p>
							<a href="#session_connect" target=""><code>connect()</code></a>
						</p>
					</li>
					<li>
						<p>
							<a href="#session_begin" target=""><code>begin()</code></a>
						</p>
					</li>
					<li>
						<p>Perform database actions</p>
					</li>
					<li>
						<p>
							<a href="#session_commit" target=""><code>commit()</code></a> or <a href="#session_rollback" target=""><code>rollback()</code></a>
						</p>
					</li>
					<li>
						<p>
							<a href="#session_leave" target=""><code>leave()</code></a>
						</p>
					</li>
					<li>
						<p>
							<a href="#session_disconnect" target=""><code>disconnect()</code></a>
						</p>
					</li>
					<li>
						<p>
							<a href="#session_terminate" target=""><code>terminate()</code></a>
						</p>
					</li>
				</ul>
    	  When creating <nobr>X-Hive/DB</nobr> applications, we advise you to follow this model closely. The methods will be described in detail below.
	  </p>
			<p>
    	  We also advise you to reuse sessions as much as possible. The easiest way
    	  to do this is by creating a pool of sessions. 

	  The following code comes from the sample servlet that can be downloaded
    	  from our <a href="http://support.x-hive.com" target="_new">support website</a> and shows how to deal with sessions when a session pool is used:     	  
  
  <div class="eg"><pre>XhiveSessionIf session = sessionPool.getSession();
try {
  session.join();
  session.begin();
 
  executeRequest(session);

  session.commit();
} finally {
  if (session.isOpen()) {
    session.rollback();
  }
  if (session.isJoined()) {
    session.leave();
  }
  sessionPool.returnSession(session);
}</pre></div>
  
        As can be seen, the structure is very simple. There
        is only one conditional statement in the code. The <code>finally</code>-block ensures that the session transaction will never remain open.
        When an exception occurs in the <code>try</code>-block,
        the session will be rolled back, otherwise the commit has succeeded. 
 	</p>
			<p>
	In this sample the actual database operations are performed in <code>executeRequest()</code>, which does 
	not contain any session-related operations at all.
    	</p>

	
	<div class="div4">
		<h5><a name="session_createsession"/>6.1.1.1 <code>XhiveDriverIf.createSession()</code></h5>
							<p>
      					  Creating a session is a relatively slow and resource-hungry task. Our
      					  advice is to call this method only when necessary and to use a pool
      					  of sessions where possible. The easiest way to do this is by using
      					  a <code>java.util.Stack</code> on which to <code>push</code> back sessions when they are
      					  no longer needed. To retrieve a session, you could use the following code:
<div class="eg"><pre>XhiveSessionIf session;
if (! sessionStack.isEmpty()) {
  session = (XhiveSessionIf) sessionStack.pop();
} else {
  session = xhiveDriver.createSession();
}</pre></div>
							</p>
	</div>					
	<div class="div4">					
		<h5><a name="session_join"/>6.1.1.2 <code>join()</code></h5>

        <p>
          By calling this method, you join this session to the current thread.  This means that only
          this thread can use database objects (like documents) that belong to this session.  When a
          session is created, it is automatically joined to the thread that creates it.
        </p>
							<p>
      					  You should always call this method before you start using a session in a certain thread.
      					  When working with servlets or EJBs, you will execute each request in an 'unknown'
      					  thread, but during the execution of the request the thread does not change, so
      					  <code>join()</code> should only be called once.
      					  The time it takes to execute the <code>join()</code> method can almost be neglected. Still you should
      					  only call it when needed, as it can help you to detect unexpected or unwanted  thread changes.
      					</p>
        <div class="note"><p class="prefix"><b>Note:</b></p>
          It is not possible to use a single session concurrently in multiple threads, use separate
          sessions for multithreaded use of <nobr>X-Hive/DB</nobr>.  You should not try to serialize use of a
          session in multiple threads by synchronizing (using the Java synchronized keyword) on the
          session object.  This will conflict with internal use of the session synchronization and
          may lead to deadlocks.  If you need to serialize use of a session, use an application
          object to synchronize on.
        </div>
	</div>
	<div class="div4">
		<h5><a name="session_leave"/>6.1.1.3 <code>leave()</code></h5>

							<p>
      					  By calling this method, you indicate the session is no longer bound to
      					  this thread.
      					</p>
							<p>
      					  It is important to call <code>leave()</code> on no longer used sessions
      					  in threads. Otherwise it might not be possible to terminate the session after the thread is exited and <code>terminate()</code> is called from another thread.
      					</p>
	</div>
	<div class="div4">
		<h5><a name="session_connect"/>6.1.1.4 <code>connect()</code></h5>
					<p> A session is connected to a database by calling <code>connect()</code>. The overhead of this call is relatively small, so in a multi-user setting you may choose to connect every time you start using a session.
    					 </p>
	</div>
	<div class="div4">
		<h5><a name="session_begin"/>6.1.1.5 <code>begin()</code></h5>


							<p>
    					    A call to <code>begin()</code> starts a transaction. After the call to <code>begin()</code>:
    					    <ul>
									<li>
										<p>
    					        All the changes you make in the database are part of the  transaction, and only become visible in the database after a <code>commit()</code> or <code>checkpoint()</code>.
    					      </p>
									</li>
									<li>
              <p>
                All the data you are reading from the database is in the same state as at the time
                of the <code>begin</code>.
              </p>
									</li>
								</ul>
    					  </p>
	</div>
	<div class="div4">
		<h5><a name="session_commit"/>6.1.1.6 <code>commit()</code></h5>
						<p>
    					    A call to this method commits all changes you made to the database, and cleans
    					    up data temporarily stored in the database (like intermediate query results).
    					    Also, all locks are released.
    					  </p>
							<p>
    					    The time taken up by a commit depends on the amount of changes made in the
    					    transaction, especially certain removal operations can be quite expensive in terms 
									of processing time.
    					  </p>
	</div>
	<div class="div4">
		<h5><a name="session_rollback"/>6.1.1.7 <code>rollback()</code></h5>
							<p>
      					  When you call <code>rollback()</code>, all changes made in the database since 
      					  <code>begin()</code> or <code>checkpoint()</code> are revoked. This method can have
      					  considerable overhead, as changes that were made may already have been written
      					  to disk.
      					</p>
	</div>
      <div class="div4">
        <h5><a name="session_checkpoint"/>6.1.1.8 <code>checkpoint()</code></h5>
        <p>
          When <code>checkpoint()</code> is called, the changes made since <code>begin()</code>
          or the last <code>checkpoint()</code> within the transaction are committed in the database.
          The changes will now be visible to other sessions.
          The transaction remains open after a <code>checkpoint()</code>.
        </p>
        <p>
          There are differences between <code>checkpoint()</code> and a
          <code>commit()</code>/<code>begin()</code> pair:
          <ul>
            <li>
              <p>
                The locks on the database are kept (unless you pass the option <code>true</code>
                to downgrade the locks).
              </p>
            </li>
            <li>
              <p>
                <code>checkpoint()</code> is faster than a <code>commit()</code>/<code>begin()</code>
                pair.
              </p>
            </li>
          </ul>
        </p>
        <p>
          Like a <code>commit()</code>, <code>checkpoint()</code> will delete all temporary objects,
          like XQuery constructed result nodes or elements created but not appended to their
          document.  Therefore, even though references to existing database objects remain valid,
          you can no longer use these temporary objects after a <code>checkpoint()</code>.
        </p>
      </div>
	<div class="div4">
		<h5><a name="session_disconnect"/>6.1.1.9 <code>disconnect()</code></h5>
				<p>
    					  A call to <code>disconnect()</code> brings the session back to the state
    					  it was in when the session was first created. <code>disconnect()</code> has
    					  no overhead.
    				</p>
	</div>
	<div class="div4">
		<h5><a name="session_terminate"/>6.1.1.10 <code>terminate()</code></h5>
        <p>
          When you terminate a remote session, it will close the TCP connection to the server.
          Terminating a local session has no effect.  After a call to <code>terminate()</code>, the
          session object can no longer be used.
        </p>
        <p>
          If you do not terminate a session, it will continue to use resources until it is garbage
          collected.  The finalizer will close any TCP connection to the server.  Open sessions
          (those within a transaction) have internal references pointing to them and will never be
          garbage collected.  Sessions not in a transaction (whether connected or not) will be
          garbage collected when you release all references to them.
        </p>
	</div>
	
			<p class="prefix"><b>See also:</b></p>
				<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
					<a href="../apidocs/com/xhive/core/interfaces/XhiveSessionIf.html">com.xhive.core.interfaces.XhiveSessionIf</a><br/>
				</div><br/>
			
		</div>
		<div class="div3">
			<h4><a name="sessions_and_objects"/>6.1.2 Sessions and references to database objects</h4>
			<p>
        Objects in the database can only be accessed in an open transaction.
        Furthermore, objects retrieved from a database in one transaction cannot
        be used in following transactions after a <code>commit()</code>. So for instance, the following is not
        allowed:
<div class="eg"><pre>session.begin();
XhiveLibraryIf library = session.getDatabase().getRoot();
session.commit();
session.begin();
System.out.println(library.getName());
session.commit();</pre></div>

     Instead, you should do:
     
<div class="eg"><pre>session.begin();
XhiveLibraryIf library = session.getDatabase().getRoot();
session.commit();
session.begin();
library = session.getDatabase().getRoot();
System.out.println(library.getName());
session.commit();</pre></div>

        The reason for this is that after you have called <code>commit()</code> and <code>begin()</code>
        the library may have been removed in another session. If you do try to use an
        object in a different transaction, you will usually get an <code>XhiveException.OBJECT_DEAD</code>,
        which indicates that the object cannot be used anymore in your Java application.
      </p>
			<p>
        Instead of calling <code>commit()</code> and <code>begin()</code>, you can also call
        <code>checkpoint()</code>, which makes all changes permanent, but does not
        refresh the view on the database. Also, by default, all locks are kept. Therefore, you
        can keep using all references to database objects you have retrieved.
      </p>
		</div>
	</div>
  <div class="div2">
    <h3><a name="sessions_visibility"/>6.2 Sessions and transaction isolation</h3>
    <p>
      As mentioned before, <nobr>X-Hive/DB</nobr> supports transaction isolation and atomicity.  When
      <code>begin()</code> is called, the view on the database for that session is updated, meaning
      the changes made in other transactions within other sessions become visible.  This section
      gives an example with three sessions and shows when a change in readwrite session A becomes
      visible for the other <a href="#sessions_readonly" target="">readonly sessions</a> (B and C). Each
      column shows the actions in a session, in chronological order.
    </p>
		<div class="eg"><pre>
  Session A           |    Session B           |     Session C
                      |                        |
  begin()             |                        |
                      |                        |
                      |    begin()             |
                      |                        |
  addDocument 'doc'   |                        |
                      |                        |
                      |    // 'doc' not seen   |     begin()
                      |                        |
                      |                        |     // 'doc' not seen
                      |                        |
                      |                        |     commit()
                      |                        |
  commit()            |                        |
                      |                        |
                      |    // 'doc' not seen   |     begin()
                      |                        |
                      |    commit()            |     // 'doc' is seen
                      |                        |
                      |    begin()             |     commit()
                      |                        |
                      |    // 'doc' is seen    |
                      |                        |
                      |    commit()            |
</pre></div>
    <p>
      As shown in the example above, the document added in the transaction within session A is not
      visible in any other transaction until the transaction within session A is committed. And even
      then, the open transaction of session B still would not see the document that was added until
      its next call to <code>begin()</code>.
    </p>
	</div>
	<div class="div2">
		<h3><a name="sessions_locking"/>6.3 Sessions and locking</h3>
    <p>
      To ensure that the same data cannot be modified in different transactions, data is locked
      during modification. These locks are placed on the related objects as soon as they are
      modified, and they are released after a <code>commit()</code> or <code>rollback()</code>. When
      an object is locked, other transactions cannot change it at the same time. By default, a
      transaction that attempts to use a locked object blocks until the lock is released.
    </p>
    <p>
      Besides implicit locking of data during modification, you can also lock libraries explicitly
      by calling <code>lock()</code> on them.
    </p>
		<div class="div3">
			<h4><a name="session_locks_table"/>6.3.1 What gets locked when?</h4>
			<p>
  	    An <nobr>X-Hive/DB</nobr> database is divided into a number of so-called 'locking contexts'.
  	    Within a locking context, as soon as you make a change in any one item within
  	    that context, the entire locking context gets locked. For instance, 
  	    a library is a locking context. When you add a document to that library,
  	    other concurrent sessions cannot add any other documents in that library until
  	    <code>commit()</code> is called.
  	  </p>
			<p>
  	    The following table shows a number of sample actions and describes what will get locked:
  	  </p>
			<table id="table_lockswhen" width="100%" border="1">
				<caption/>
				<tbody>
					<tr>
						<th align="left" rowspan="1" colspan="1">Action</th>
						<th align="left" rowspan="1" colspan="1">What gets locked</th>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Add/remove a document (or library)</td>
						<td rowspan="1" colspan="1">The library to which the document is added.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Modify a document</td>
						<td rowspan="1" colspan="1">The document.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Add/remove an index to/from a library</td>
						<td rowspan="1" colspan="1">The library to which the index is added.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Add/remove a user/group</td>
						<td rowspan="1" colspan="1">The database object (which means that one concurrent thread can make these changes).</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Update a user/ group</td>
						<td rowspan="1" colspan="1">The database object.
  					</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Update a context conditioned index</td>
						<td rowspan="1" colspan="1">The contect conditioned index.
  					</td>
					</tr>
				</tbody>
			</table>
      <p>
        Documents in <nobr>X-Hive/DB</nobr> use an internal data structure called namebase.  This structure
        cannot be accessed directly using the API, but its existence is relevant for the locking
        behaviour.  The namebase maps element and attribute names to small integers that take less
        space and time to process.  When the namebase is changed (e.g., when a document is parsed
        that contains new element names) it is locked.  When creating a library you can specify two
        options that influence the namebase locking behaviour for that library:
      </p>
      <ul>
        <li>
          <p>
            <code>XhiveLibraryIf.LOCK_WITH_PARENT</code>: By default, each library will be created
            with its own namebase.  However, in certain cases you may want to share the namebase of
            the parent library, especially if you have many libraries with very little content.
          </p>
        </li>
        <li>
          <p>
            <code>XhiveLibraryIf.DOCUMENTS_DO_NOT_LOCK_WITH_PARENT</code>: By default, all documents
            in a library share the same namebase.  If you have a reasonably fixed set of documents,
            where the contents of the documents gets changed often, it could be useful to use the
            <code>DOCUMENTS_DO_NOT_LOCK_WITH_PARENT</code> in the creation of the library. In that
            case, each document in the library will get its own private namebase.
          </p>
        </li>
      </ul>
      <p>
        Using more namebases improves concurrency, but adds some space and processing overhead.  The
        default options are a sufficient compromise for most applications.  We recommend using the
        default options unless testing conclusively shows a need to do otherwise.
      </p>
			<p class="prefix"><b>See also:</b></p>
				<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
					<a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
				</div><br/>
			
		</div>
		<div class="div3">
		  <h4><a name="sessions_locking_what_happens"/>6.3.2 <nobr>X-Hive/DB</nobr> behavior when a locking conflict occurs</h4>
		  <p>
		    When one transaction tries to lock a database object for writing while another transaction
		    has read the same object, or when one transaction tries to read a database object that another
		    transaction is currently writing, that transaction cannot continue. What happens at that point
		    depends on the wait option setting and the status of the collection of all current locks.
      </p>
      <p>
        You can specify what <nobr>X-Hive/DB</nobr> must do when a transaction attempts to use a locked object, 
        through the wait option setting on a session (<code>XhiveSessionIf.setWaitOption()</code>). 
        By default (<code>WAIT</code>), 
        the transaction blocks until the lock is released by the other transaction (when that tranaction ends). 
        You also set the wait option to not wait at all (<code>NO_WAIT</code>), in that case an
        <code>XhiveLockNotGrantedException</code> is thrown as soon as a locked object is encountered.
        It is also possible to set a time (in milliseconds) that must be waited for a lock to be granted,
        this option is useful if you want to wait for locks but not for concurrent transactions that take
        a very long time. When the wait time has passed and the other transaction still locks the database object,
        an <code>XhiveLockNotGrantedException</code> is thrown.
      </p>
      <p>
        Regardless of the wait option used, it is possible to get lock exceptions. This is because deadlocks
        can occur. Here is one common scenario:
<div class="eg"><pre>Transaction A reads document X
Transaction A writes document X
Transaction B reads document Y
Transaction A wants to write document Y 
    -&gt; blocks because transaction B already has a readlock
Transaction B wants to read X
    -&gt; blocks because transaction A already has a writelock</pre></div>

        At this moment, both transactions cannot continue, because they are both waiting for each other to finish.
        In this case, <nobr>X-Hive/DB</nobr> will pick one transaction and throw an <code>XhiveDeadlockException</code>
        (which is a subclass of <code>XhiveLockNotGrantedException</code>) in it. If a rollback
        is then performed on that transaction, the locks will be released so that 
        the other transaction can continue.
      </p>
      <p>
        It is possible to get a deadlock even when only one database object is involved:
<div class="eg"><pre>Transaction A reads document X
Transaction B reads document X
Transaction A wants to write document X
    -&gt; blocks because transaction B already has a readlock
Transaction B wants to write document X
    -&gt; blocks because transaction A already has a readlock</pre></div>
      </p>
      <p>
        In your application code, you should always take into account that locking exceptions can occur,
        and catch them and act appropriately. Usually the appropriate thing to do is to restart the transaction
        and try the same operation again. By using readonly transactions (see below) that do not use locks, 
        you can help alleviate the number of potential locking conflicts.
      </p>
		</div>
    <div class="div3">
      <h4><a name="sessions_readonly"/>6.3.3 Readonly transactions</h4>
      <p>
        On session objects, you can set readonly mode by calling <code>setReadOnlyMode()</code>.
      </p>
      <p>
        By default, transactions are readwrite.  This means that they can modify database objects.
        Readonly transactions cannot modify database objects.  The advantage of readonly
        transactions is that they do not take any locks, not even read locks.  This improves
        concurrency with transactions that do modify data.
      </p>
      <p>
        To get a consistent view of the database without using locks, readonly transactions view a
        logical snapshot of the data at the time the transaction begins (using the
        <code>begin()</code> method of the session).  Any modifications to the data since that time
        (whether committed or not) are not seen by the readonly transaction.
      </p>
      <p>
        Data pages that have been deleted (e.g., when deleting a document) will not be reallocated
        to new documents as long as there are still open transactions that could possibly use the
        old data.  Therefore, you should not keep transactions open indefinitely.
      </p>
      <p>
        The <code>checkpoint()</code> method has no effect in readonly transactions.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="XHSessionInfo_tool"/>6.4 The XHSessionInfo tool</h3>
    <p>
      The XHSessionInfo tool prints debug information on the currently open transactions and the
      locks that they have.  It is a simple wrapper around the
      <code>XhiveDriverIf.printSessionInformation()</code> API that prints the information to
      standard output.  Only sessions that are currently open (in a transaction) are shown.  If
      sessions are not open, they are not listed in any internal administration to allow them to be
      garbage collected if no longer referenced by user code.
    </p>
    <p>
      Locks are printed as either R(ead) or W(rite) locks, an internal id and a short description of
      the locked object.  If the description says "&lt;page not in cache&gt;", this usually means
      that the object locked is new and its first page has not yet been entered in the database
      server cache.  It can also mean that the first object page has been removed from the cache to
      create space for other pages.  Although in this case the object could be read from disk to
      retrieve the name, this is not done to avoid affecting the performance of current transactions
      too much.
    </p>
    <p>
      If your application creates different sessions for different purposes, it can be useful to
      give the sessions a name to identify them in the output of XHSessionInfo.  This name can be
      set by creating the sessions using <code>XhiveDriverIf.createSession(String name)</code>.
    </p>
  </div>
</div>

	
<div class="div1">
  <h2><a name="xquery"/>7 Using XQuery</h2>
  <p>This chapter explains how to use XQuery in <nobr>X-Hive/DB</nobr>.</p>
  <div class="div2">
    <h3><a name="xquery_executing"/>7.1 Executing queries</h3>
    <p>You can execute an XQuery query using the <code>executeXQuery(String query)</code> method on
      the <code>XhiveNodeIf</code> interface. It returns an iterator that represents the
      result sequence. Each element of the result is an instance of <code>XhiveXQueryValueIf</code>.
      In <nobr>X-Hive/DB</nobr> for Java 5 (JDK 1.5 and later) all iterators and results are also typed using the 
      new template syntax (e.g. <code>executeXQuery(String)</code> returns an 
      <code>Iterator&lt;XhiveXQueryValueIf&gt;</code>).
      </p>
    <div class="eg"><pre>
XhiveNodeIf lc = ... ;
Iterator result = lc.executeXQuery("document('doc')//item");
while (result.hasNext()) {
  XhiveXQueryValueIf value = (XhiveXQueryValueIf)result.next();
  // We know this query will only return nodes.
  Node node = value.asNode();
  // Do something with the node ...
}
</pre></div>
    <p>
      Within the query, the context item (accessible via <code>.</code>) is initially bound to the
      node the query was executed on. Example (Java 1.5 syntax):
    </p>
    <div class="eg"><pre>
XhiveNodeIf node = ...;
Iterator&lt;XhiveXQueryValueIf&gt; result = node.executeXQuery("./author/first, ./author/last, ./contents");
for (XhiveXQueryValueIf value : result) {
  // do something with the value ...
}
</pre></div>
    <p>If you only want to display the result, you can use the <code>toString()</code> method on the
      values returned, regardless of their type:</p>
    <div class="eg"><pre>
XhiveLibraryChildIf lc = ... ;
String query = ... ;
Iterator result = lc.executeXQuery(query);
while (result.hasNext()) {
  System.out.println(result.next().toString());
}
</pre></div>
    <p>If the query uses node constructors, any nodes created are created in a temporary document.
      If desired, these nodes can be inserted into another document using the DOM
      <code>importNode()</code> method.</p>
    <p>If you want to insert the nodes into a particular document, you can specify an owner document
      for new nodes in the call. This is more efficient than creating a temporary document and
      importing its nodes into the destination document.</p>
    <div class="eg"><pre>
XhiveLibraryChildIf lc = ... ;
XhiveDocumentIf doc = ... ; // Create new nodes in this document
Iterator result = lc.executeXQuery("&lt;count&gt;{count(//item)}&lt;/count&gt;", doc);
// We know this query will only return a single node.
XhiveXQueryValueIf value = (XhiveXQueryValueIf)result.next();
Node node = value.asNode();
// Append it to the document element of destination document
doc.getDocumentElement().appendChild(node);
</pre></div>
    <p>The query result is evaluated lazily, i.e., each time you call <code>next()</code> on the
      result iterator. Beware not to call <code>result.next()</code> after a modification (in the
      same session) of the searched documents or libraries. If you do this, undefined results may
      occur. If you want to use the query output to modify the searched documents, use the
        <code>xhive:force()</code> function or the update syntax (see below).</p>
  </div>
  <div class="div2">
    <h3><a name="xquery_external_vars_funcs"/>7.2 External variables and functions</h3>
    <p>
      XQuery provides a method for importing external values into the query scope (parameters). To use this feature,
      first create a query using the method <code>createXQuery(String query)</code> on a <code>XhiveNodeIf</code>.
      This method parses the query, resolves module imports etc, and then returns an object of type 
      <code>XhiveXQueryQueryIf</code> that represents the query.
      The <code>XhiveXQueryQueryIf</code> object is only valid for the current database session, so make sure
      you don't use it across multiple sessions.
    </p>
    <div class="eg"><pre>
XhiveNodeIf node = ...;
XhiveXQueryQueryIf query = node.createXQuery(
    "declare variable $pi external; " + 
    "for $rad in document('radius.xml')//radius " + 
    "return ($rad * $rad * $pi)");
query.setVariable("pi", java.lang.Math.PI);
Iterator&lt;XhiveXQueryValueIf&gt; result = query.execute();
...
</pre></div>
    <p>
      <code>XhiveXQueryQueryIf</code> also provides a <code>executeOn(XhiveNodeIf node)</code> method, that
      allows you to run the same query multiple times on different context items. Using <code>executeOn()</code>
      the initial context item ("<code>.</code>") will point to the given <code>XhiveNodeIf</code>.
    </p>
    <p>
      <code>XhiveXQueryQueryIf</code> provides methods to set variables to all kinds of primitive Java types
      (<code>int</code>, <code>float</code>, ...). It also understands certain Javas numeric objects (<code>Integer</code>,
      <code>Float</code>, ... and the two unlimited precision datatypes <code>BigInteger</code> and 
      <code>BigDecimal</code>) and, of course, <code>String</code>s and all <code>XhiveXQueryValueIf</code> objects.
    </p>
    <p>
      It is also possible to supply an <code>Iterator</code> over a sequence of such objects. This can be especially
      handy for executing XQuerys over the results of other querys, effectively creating a lazily executed XQuery 
      pipeline. <code>Iterator</code>s used by a query cannot be reused afterwards, not even by the same query,
      so the declared variable will be empty if this query is run again. 
    </p>
    <div class="eg"><pre>
XhiveNodeIf node = ...;
Iterator&lt;XhiveXQueryValueIf&gt; subresult = node.executeXQuery(...);
XhiveXQueryQueryIf query = node.createXQuery(
    "declare variable $values external; " + 
    "for $value in $values " + 
    "return $value + 5");
query.setVariable("values", subresult);
Iterator&lt;XhiveXQueryValueIf&gt; result = query.execute();
...
</pre></div>
    <p>
      Custom functions can be set using the <code>setFunction(String, XhiveXQueryExtensionFunctionIf)</code> 
      method. You can find out more about the extension functions in the API docs for 
      <code>XhiveXQueryExtensionFunctionIf</code>. Your supplied function may or may not be called, depending
      on optimization, and it may especially be called in a different order then you expect.
    </p>
    <div class="eg"><pre>
XhiveNodeIf node = ...;
XhiveXQueryQueryIf query = node.createXQuery(
    "declare function circle-area($radius as xs:number) as xs:double external;" +
    "for $rad in document('radius.xml')//radius " + 
    "return circle-area($rad)");
query.setFunction("circle-area", new XhiveXQueryExtensionFunctionIf() {
  public Object[] call(Iterator&lt;? extends XhiveXQueryValueIf&gt;[] args) {
    double rad = args[0].next().asDouble();
    double res = java.lang.Math.PI * rad * rad;
    return new Double[]{ new Double(res) };
  }
});
Iterator&lt;XhiveXQueryValueIf&gt; result = query.execute();
...
</pre></div>
    <p>
      All the methods for setting variables and those for functions come in two flavors, one which takes
      a single <code>String</code> as the name and places the variable/function in the empty namespace,
      the other one takes two <code>String</code> arguments, the first being the namespace URI and the 
      second the localname. If you use a namespace URI you will have to declare a prefix for it within the query.
    </p>
    <p>
      In <nobr>X-Hive</nobr> it is not strictly necessary to declare external variables and functions, but it is recommended
      for compatibility with other XQuery implementations.
    </p>
  </div>
  <div class="div2">
    <h3><a name="xquery_accessing"/>7.3 Accessing documents and libraries</h3>
    <p>In a query, you can refer to specific documents using the XQuery <code>document()</code>
      function. Its argument should be a path, optionaly starting with a '/' and containing names or ids of
      libraries or documents, separated by '/'. Paths that don't start with a '/' are evaluated relative
      to the context item the query is executed on, or it's parent library. If the path designates a library, 
      the function returns a sequence of all documents in that library and its descendant libraries. 
      Examples:
    </p>
    <div class="eg"><pre>
document("/"), (: All documents in the database :)
document("/document.xml"), (: The document "document.xml" in the root library :)
document("/MyLibrary"), (: All documents in "MyLibrary" :)
document("/id:10"), (: The document (or all documents in the library) with id "10" :)
document("/mylib/mydoc"),
document("/mylib/mysublib/id:1234")
document("relative/path")
document("../steps/work/./too")
</pre></div>
    <p>The argument does not have to be a string literal, it can be any expression returning a
      string.</p>
    <p>In <nobr>X-Hive/DB</nobr>, the <code>collection()</code> function is currently a synonym for
        <code>document()</code> and works in precisely the same way.</p>
    <p>If there is a context node, an absolute path expression starts at the root of the context
      node <code>fn:root(.)</code>. Otherwise (in an outer expression), it starts at the document or
      all documents in the library that the <code>executeXQuery</code> method was called on. If you
      want to access the calling document(s) when there is a context node, use the
        <code>xhive:input()</code> function.</p>
    <div class="eg"><pre>
/docelem[//@id="2"]
(: this is equivalent to :)
xhive:input()/docelem[root(.)//@id="2"]
</pre></div>
  </div>
  <div class="div2">
    <h3><a name="xquery_model_discrepancies"/>7.4 Data model discrepancies</h3>
    <p>
      The <nobr>X-Hive/DB</nobr> data model (which is the Document Object Model with extensions like libraries)
      does not fit the XQuery/XPath data model perfectly. Following the <a href="http://www.w3.org/TR/DOM-Level-3-XPath/">Document Object Model (DOM) Level 3 XPath
      Specification</a> <nobr>X-Hive/DB</nobr> does the following:
    </p>
    <ul>
      <li>
        <p>Entity reference nodes are treated as if they had been expanded. Queries will never
          return entity reference nodes. Children of an entity reference node are treated as
          siblings of the siblings of the entity reference node.</p>
      </li>
      <li>
        <p>Adjacent text and CDATA section DOM nodes are treated as single XQuery text nodes. The
          string value of the XQuery text node is the concatenation of the contents of the adjacent
          DOM text and CDATA section nodes. A query like <code>//text()</code> returns only the
          first of each set of adjacent DOM nodes.</p>
      </li>
      <li>
        <p>
          BLOB nodes and library nodes don't have a representation in XQuery/XPath, so they are invisible
          to queries. However, selecting a library using the <code>document()</code> function returns
          all elements in the library, as described above.
        </p>
      </li>
    </ul>
  </div>
  <div class="div2">
    <h3><a name="xquery_impl"/>7.5 Current implementation</h3>
    <p>X-Hive's XQuery implementation is based on the <a href="http://www.w3.org/TR/2005/WD-xquery-20050915/">XQuery 1.0 Working Draft (15 September 2005)</a>.
      Because this is not yet a final Recommendation, XQuery (and therefore also our implementation)
      is likely to change.</p>
    <div class="div3">
      <h4><a name="d1e7794"/>7.5.1 XPath axes</h4>
      <p>
        <nobr>X-Hive</nobr> implements the 'Full Axis Feature', thus providing the axes
        <code>ancestor</code>, <code>ancestor-or-self</code>, <code>following</code>,
        <code>following-sibling</code>, <code>preceding</code> and <code>preceding-sibling</code>.
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e7821"/>7.5.2 Module Imports</h4>
      <p>
        <nobr>X-Hive</nobr> implements the 'Module Import Feature', which provides a way of creating library functions.
        Modules can be imported using the following syntax:
      </p>
      <div class="eg"><pre>
import module namespace prefix = 'http://some/namespace/uri' at 'location';
(: ... use functions from the module ... :)
</pre></div>
      <p>
        XQuery leaves the syntax for the location of modules as implementation defined. In X-Hive, the location part can be
        any valid Java URI (think <code>file://...</code>, <code>http://...</code> etc.) as well as a URI
        within the database. Use <code>xhive://</code> or just a relative/absolute path without a protocol identifier,
        it follows the same syntax as for the <code>document()</code> function). Import paths are evaluated relative
        to the <code>XhiveNodeIf</code> (or respectively the library containing it) on which the query is 
        executed or created. 
      </p>
      <p>
        Importing a module into the current query will make all those functions and variables available, that 
        have been declared within the module namespace. Modules can import other modules themselves (as long as 
        they don't create a loop). If a module imports another module, functions and variables from the latter one
        are available only within the directly importing module, they are not propagated further. In a slight 
        extension of the standard <nobr>X-Hive</nobr> allows modules to declare variables and functions outside the module
        namespace. Those can only be used within the module itself.
      </p>
      <p>
        XQuery modules can be stored within <nobr>X-Hive/DB</nobr> either as BLOB nodes or as XML documents. BLOB nodes
        must contain the module in flat UTF-8 text, XML documents can have any encoding as long as it is
        correctly specified when importing them. In XML documents the string-value of the document root
        element, as defined by the XQuery Data Model, is used as the query. This basically means that the
        query is the concatenation of all text nodes below that root node. Example:
        </p>
      <div class="eg"><pre>
&lt;queryModule&gt;&lt;![CDATA[
  module namespace mns = 'http://some/namespace/uri';
  declare variable $mns:pi := 3.14159265;
  declare function mns:circle-area($r as xs:double) as xs:double
  {
    $r * $r * $mns:pi
  };
]]&gt;&lt;/queryModule&gt;</pre></div>
      <p>
        The name of the root element (here: &lt;queryModule/&gt;) is ignored, anything will work. 
        Feel free to choose something interesting.
      </p>
      <p>
        Be careful about escaping XML within the query. It is recommended to use a CDATA block for the
        contents of the module, as otherwise embedded direct element constructors will be interpreted
        as XML syntax. For example in the following module:
      </p>
      <div class="eg"><pre>
&lt;queryModule&gt;
  module namespace foo = 'bar';
  declare variable $foo:element := &lt;element&gt;"Hello World!"&lt;/element&gt;;
&lt;/queryModule&gt;
</pre></div>
      <p>
        the variable $foo:element will just contain the string <code>"Hello World!"</code>, because 
        &lt;element/&gt; was not escaped.
      </p>
      <p>
        XQuery modules that are stored outside of <nobr>X-Hive/DB</nobr> (accessed via URIs) are always expected 
        to be in UTF-8 character encoding.
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e7878"/>7.5.3 Supported options and extension expressions (pragmata)</h4>
      <p>
        <nobr>X-Hive</nobr> supports a set of options. Those can be set globally in the query prolog using the syntax:
        </p>
      <div class="eg"><pre>
declare option QName "Value";
</pre></div>
      <p>
        If you just want to set an option for a specific part of you query, you can use an extension 
        expression. Extension expressions are specified using the syntax
      </p>
      <div class="eg"><pre>
(# QName Value #)
{ expr }
</pre></div>
      <p> 
        where the option identified by the <code>QName</code> is set for the whole inner expression. 
        Quotes around <code>Value</code> are optional. Multiple options can be set at once by writing 
        multiple (# #) parts before the curly braces.
      </p>
      <p>
        Currently supported options are:
      </p>
      <div class="div3">
      <ul>
        <li>
          <p><code>xhive:index-debug</code> allows you to check if an index is used in a query. When
            its value is either "stdout" or "stderr", the query evaluator will print a message
            to the specified output stream whenever a value is looked up in an index selected by
            the optimizer.</p>
          <p>If the message must be sent to another stream, use the Java
            <code>System.setOut</code> or <code>System.setErr</code> method.</p>
        </li>
        <li>
          <p><code>xhive:queryplan-debug</code> - works like <code>index-debug</code> but shows how the
            query is divided into parts (and in what order the parts are executed), and shows
            what indexes (with what options) are looked for.</p>
        </li>
        <li>
          <p><code>xhive:pathexpr-debug</code> - works like <code>index-debug</code> but shows what low
            level expressions within the XQuery are executed, and in what order.</p>
        </li>
        <li>
          <p><code>xhive:fts-analyzer-class</code> - set a fully specified classname of the Analyzer
            that is to be used in the <a href="#xquery_fts" target=""><code>xhive:fts</code></a> 
            function when no indexes are present.</p>
        </li>
        <li>
          <p><code>implicit-timezone</code> - set the implicit-timezone, used by functions and operations
            on the various date types (xs:date, ...) if no explicit timezone is given.</p>
        </li>
      </ul>
      </div>
      <p>
        Examples:
      </p>
      <div class="eg"><pre>
declare option xhive:index-debug "stdout";
document("/products")//product[@product_id = "42"]
</pre></div>
      <div class="eg"><pre>
(# xhive:index-debug "stdout" #) {
  document("/products")//product[@product_id = "42"]
}
</pre></div>
      <div class="eg"><pre>
(# xhive:queryplan-debug "stderr" #)
(# xhive:pathexpr-debug  "stdout" #) {
  document("/products")//product[@product_id = "42"]
}
</pre></div>
      <div class="eg"><pre>
declare option implicit-timezone 'PT10H';
adjust-dateTime-to-timezone(xs:dateTime("2002-03-07T10:00:00-07:00"))
</pre></div>
    </div>
    <div class="div3">
      <h4><a name="xquery_updates"/>7.5.4 Update Syntax for XQuery</h4>
      <p>
        Currently there is no W3C standard available for Updates within XQuery. XQuery is expected to get an
        update syntax as there is already a task force and a set of use cases, but so far nothing has been
        published. Therefore <nobr>X-Hive</nobr> implements a proprietary syntax for updating XML documents and the database
        repository using XQuery statements.
      </p>
      <p>
        Updates can be invoked using one of the functions described below. The query evaluation is independent
        of the update syntax and follows snapshot semantics. Conceptually the single update operations are 
        generated, cached and not applied until after query execution. There are currently no checks for
        conflicting updates within one query. 
      </p>
      <p>
        To make sure that all updates have been generated and applied after <code>execute()</code>/<code>executeXQuery()</code> 
        returns an XQuery using the update syntax is not evaluated lazily but rather at once, caching the 
        results. This can lead to bigger memory usage if a query executes updates and returns a lot of values.
      </p>
      <ul>
        <li>
          <p>
            <code>xhive:create-library($uri as xs:string) as empty-sequence()</code> creates a library with the given
            <code>$uri</code>. If parent libraries mentioned in the path are missing, they are created too 
            (the function behaves like UNIX <code>mkdir -p</code>). 
          </p>
        </li>
        <li>
          <p>
            There is a set of insert functions that follow the same style. The functions are
            <code>xhive:insert-into($where as node(), $what as item()*) as empty-sequence()</code>,
            <code>xhive:insert-into-as-first($where as node(), $what as item()*) as empty-sequence()</code>,
            <code>xhive:insert-into-as-last($where as node(), $what as item()*) as empty-sequence()</code>,
            <code>xhive:insert-before($where as node(), $what as item()*) as empty-sequence()</code>,
            <code>xhive:insert-after($where as node(), $what as item()*) as empty-sequence()</code>
          </p>
          <p>
            Applying an insert function inserts the given items (<code>$what</code>) relative to <code>$where</code>:
            into it as last, as first, before or after it, respectively. <code>insert-into</code> and 
            <code>insert-into-as-last</code> behave identical. 
            Atomic values within <code>$what</code> are converted into text nodes like in element constructors. 
            If <code>$where</code> is not a node or the empty sequence, an error is raised.
          </p>
        </li>
        <li>
          <p>
            <code>xhive:insert-document($uri as xs:string, $document as document-node()) as empty-sequence()</code> 
            inserts the given <code>$document</code> at <code>$uri</code>. If there is already a document
            at <code>$uri</code> an error is raised. 
          </p>
        </li>
        <li>
          <p>
            <code>xhive:remove($nodes as node()*) as empty-sequence()</code> removes the given <code>$nodes</code> 
            from their parents. <code>xhive:delete()</code> is an alias to this function.
          </p>
        </li>
        <li>
          <p>
            <code>xhive:remove-library($uri as xs:string) as empty-sequence()</code> removes the library at 
            <code>$uri</code> with all it's children.
          </p>
        </li>
        <li>
          <p>
            <code>xhive:rename-to($what as node(), $newName as xs:QName) as empty-sequence()</code> renames the given
            node to <code>$newName</code>. This function raises an error if it's target is not an 
            attribute node, an element node, a processing instruction or a document node. Additionally
            processing instructions can only be renamed to unqualified localnames, e.g. QNames without a 
            namespace URI. To construct a QName, use the standard function 
            <code>fn:QName($uri as xs:string?, $qname as xs:string) as xs:QName</code>.
          </p>
        </li>
        <li>
          <p>
            <code>xhive:replace-value-of($where as node(), $newContents as item()*) as empty-sequence()</code> removes
            all children of <code>$where</code> and replaces them with <code>$newContents</code>.
            Similar to <code>xhive:delete($where/item()),xhive:insert-into($where, $newContents)</code>.
          </p>
        </li>
      </ul>
      <p>Examples:</p>
      <div class="eg"><pre>
for $book in document('bib.xml')/bib/book
where @year &lt; 1990
return
  xhive:remove($book)
</pre></div>
      <div class="eg"><pre>
for $book in document('bib.xml')/bib/book,
    $review in document('http://example.com/reviews.xml')//review
where @isbn = $book/@isbn
return
  xhive:insert-into($book, $review)
</pre></div>
      <div class="eg"><pre>
xhive:insert-document('/lib/newfile.xml',
  document {
    &lt;root&gt;
      ...
    &lt;/root&gt;
  }
)
</pre></div>
    </div>
    <div class="div3">
      <h4><a name="xquery_order_by_proprietary"/>7.5.5 Conditional Order By</h4>
      <p>
        <nobr>X-Hive/DB</nobr> implements a proprietary extension to <code>order by</code>
        statements that makes it possible to order the results of a query
        depending on user input.
      </p>
      <p>
        The XQuery FLWOR grammar is extended as follows: 
      </p>
      <div class="eg"><pre>
orderModifier:
  ("ascending" | "descending"
  | &lt;"ascending" "if" "("&gt; ExprSingle ")")?
  (&lt;"empty" "greatest"&gt; | &lt;"empty" "least"&gt;)? ("collation" URILiteral)?
</pre></div>
      <p>
        The expression in parenthesis is evaluated to a boolean value and the 
        result is order ascending if the result is true, descending otherwise.
      </p>
      <p>
        This syntax can be quite useful for writing queries that need data to  
        be ordered by many different columns, depending on user input. Imagine
        ordering tabular data with 8 columns in all descending/ascending 
        combinations by writing 64 different queries and encapsulating
        them in if statements.
      </p>
      <div class="eg"><pre>
declare variable $asc_order1 external;
declare variable $asc_order2 external;
      
for $entry in //...
order by $entry/id ascending if ($asc_order1), 
         $entry/name ascending if ($asc_order2)
return
  $entry
</pre></div>
      <p>
        Together with dynamic checks for QNames (e.g. 
        <code>$entry/*[node-name() eq $order_col1]</code> instead of
        <code>$entry/id</code>) you can avoid writing a lot of duplicated query
        code. Please note that this functionality is proprietary and queries
        using it will not be compatible to other XQuery implementations.
      </p>
    </div>
    <div class="div3">
      <h4><a name="xquery_extension_functions"/>7.5.6 Extension functions</h4>
      <p><nobr>X-Hive/DB</nobr> implements a number of useful functions that are not part of the XQuery Working
        Draft. These are all in the namespace
        <code>http://www.x-hive.com/2001/08/xquery-functions</code>.</p>
      <ul>
        <li>
          <p><code>xhive:fts($context as node(), $query as xs:string, $options as xs:string) as xs:boolean</code> executes a
            query using <nobr>X-Hive/DB</nobr>'s full text index. The <code>$options</code> argument is optional
            and (if present) should be a string literal containing a semicolon-separated list of
            options. There is a <a href="#xquery_fts" target="">separate section</a> on this function.
            Example: </p>
          <div class="eg"><pre>
document("/library")//chapter[xhive:fts(title, "venice and merchant*")]
</pre></div>
          <p>The <code>include-attrs</code> option executes a query using <nobr>X-Hive/DB</nobr>'s full text
            index, but also looks in attributes of elements under <code>$context</code>. </p>
        </li>
        <li>
          <p><code>xhive:evaluate($query as xs:string) as item()*</code> takes a single string argument and
            evaluates it as an XQuery query. It returns the result of that query. Example: </p>
          <div class="eg"><pre>
for $query in document("/queries")//query 
return
&lt;queryresult&gt;
  { $query }
  &lt;result&gt;{ xhive:evaluate($query) }&lt;/result&gt;
&lt;/queryresult&gt;
</pre></div>
        </li>
        <li>
          <p><code>xhive:input() as document-node()</code> returns the the calling document(s), useful for when there
            is another active context node. For a sample see above.</p>
        </li>
        <li>
          <p><code>xhive:java(xs:string $class, ...) as item()*</code> calls a function written in Java by the
            user. Please see the API docs for
              <code>com.xhive.query.interfaces.XhiveXQueryExtensionFunctionIf</code> for details. </p>
          <div class="eg"><pre>
xhive:java("com.mydomain.myclass", $x, document("/mydoc")//item)
</pre></div>
        </li>
        <li>
          <p><code>xhive:get-nodes-by-key($library as xs:string, $indexname as xs:string,
            $key as xs:string) as node()*</code> looks up the key in the index with the specified name on the specified
            library (or document) and returns the nodes in the index, providing direct access to indexes. 
            E.g., </p>
          <div class="eg"><pre>
xhive:get-nodes-by-key("/MyLibrary", "item_index", "pc34")
</pre></div>
        </li>
        <li>
          <p><code>xhive:set-option(xs:string $optionname, xs:string $value) as empty-sequence()</code> sets an option
            (as a side effect) and returns the empty sequence. The possible options are described
            above. This method is deprecated, use the syntax described above!
          </p>
        </li>
        <li>
          <p><code>xhive:document-name($document as document-node())</code> returns the name of the document as
            set by <code>XhiveLibraryChildIf.setName(String name)</code>. If the node passed is not
            a document or is a document without a name, this function returns the empty sequence.
          </p>
        </li>
        <li>
          <p><code>xhive:force($items as item()*) as item()*</code> forces the immediate evaluation of its argument.
            If you use this function as the outermost expression of your query, the query will be
            evaluated immediately and the result will be stored internally. This can be used if you
            want to use the query result to modify the data. This is normally impossible, because of
            lazy evaluation.</p>
          <div class="eg"><pre>
String query = "xhive:force(document('doc')//elem)";
Iterator result = lc.executeXQuery(query);
while (result.hasNext()) {
  XhiveXQueryValueIf value = (XhiveXQueryValueIf)result.next();
  // We know this query will only return nodes.
  Node node = value.asNode();
  // Remove this node
  node.getParentNode().removeChild(node);
}
</pre></div>
        </li>
        <li>
          <p><code>xhive:version($document as document-node()*, $version as xs:string) as document-node()*</code> 
            returns a sequence of
            documents that represent the contents of specific versions of a set of input documents.
            For nodes that are not documents, or are not versioned, or for non-existing versions, an
            empty sequence is returned. The <code>version</code> argument is first evaluated as a
            label, if no version with that label is found, the argument is evaluated as a version id
            (so if you have a version <code>1.4</code> which has as label <code>"1.2"</code>, a
            query for version <code>1.2</code> will yield version <code>1.4</code>. </p>
          <p> It is possible to specify a set of documents as an argument, this is useful for for
            instance a query like <div class="eg"><pre>xhive:version(document("/versioned-lib"), "release2")</pre></div>
            that will get all document-versions from a library that have the label
            <code>release2</code>. </p>
        </li>
        <li>
          <p><code>xhive:version-property($document as document-node()*, $version as xs:string,
            $property as xs:string) as xs:string*</code> returns the value of a specified attribute of a version. This function
            acts mostly like the <code>xhive:version</code> function, but the result consists of a
            sequence of strings. The <code>property</code> argument must be one of <code>date</code>
            (give back the date on which the version was created, in the format yyyy-mm-ddThh:mm),
              <code>creator</code> (the name of the user who created the version) or
              <code>checked-out-by</code> (the name of the user who has checked out this version of
            the document, if it is indeed checked out). </p>
        </li>
        <li>
          <p><code>xhive:version-ids($document as node()*[, $branchversion as xs:string]) as xs:string*</code> returns the
            ids of versions of a document (although you can pass multiple documents to this
            function, you will usually only pass one). If no second argument is specified, all
            version ids of the version space are returned as a sequence of strings. By passing a
            second argument, you can get some detailed information: <ul>
              <li>
                <p>If you specify the id of a branch, the result will contain only those version ids
                  that are part of that branch (but that includes all version ids the branch shares
                  with other branches).</p>
              </li>
              <li>
                <p>If you pass <code>"1"</code> as the argument, the result will contain a list of
                  all ids of branches in the version-space of the document argument.</p>
              </li>
              <li>
                <p>If you specify the id of a version, the result will contain the labels set on
                  that version, if there are any.</p>
              </li>
            </ul>
          </p>
          <p> For non-versioned documents, or when the <code>branchversion</code> argument refers to
            a non-existing branch or version, the result will be the empty sequence. </p>
          <p> As an example of these versioning functions, this query gets all the different titles
            of a book-document of all versions created before 2003:<div class="eg"><pre>distinct-values( let $doc :=
              document("/version-lib/book.xml") for $version in xhive:version-ids($doc) where
              xhive:version-property($doc, $version, "date") &lt; "2003-01-01" return
              xhive:version($doc, $version)/book/title )</pre></div>
          </p>
        </li>
        <li>
          <p><code>xhive:metadata($document as document-node(), $key as xs:string) as xdt:untypedAtomic*</code> 
            retrieves the 
            value that
            belongs to <code>$key</code> in the metadata of the document <code>$document</code>. If
            the key is the empty sequence, the result will be a sequence with the values of all
            metadata fields. </p>
          <div class="eg"><pre>
xhive:metadata(document("/mydoc"), "author")
</pre></div>
        </li>
      </ul>
    </div>
    <div class="div3">
      <h4><a name="d1e8426"/>7.5.7 Namespace declarations</h4>
      <p>For your convenience, several namespace prefixes have been bound by default. Of course, you
        can override these in the query prolog. In addition to those specified in the XQuery working
        draft (<code>xml, xs, xsd, xsi, local</code>), the following two prefixes have been
        predefined:</p>
      <ul>
        <li>
          <p><code>fn</code> is bound to the XQuery functions namespace
              <code>http://www.w3.org/2003/05/xpath-functions</code>. This is also the default
            function namespace, allowing use of standard XQuery functions without prefix.</p>
        </li>
        <li>
          <p><code>xhive</code> is bound to the <nobr>X-Hive/DB</nobr> extension functions namespace
              <code>http://www.x-hive.com/2001/08/xquery-functions</code>.</p>
        </li>
      </ul>
    </div>
    <div class="div3">
      <h4><a name="d1e8463"/>7.5.8 Collation support</h4>
      <p>Several XQuery functions take a collation argument. The possible values of this argument
        are implementation defined. In <nobr>X-Hive/DB</nobr>, a collation consists of a locale and an optional
        strength, separated by a slash. The possible locales are those supported by the
          <code>java.text.Collator</code> class. You can create a list using the code fragment</p>
      <div class="eg"><pre>
java.util.Locale[] locales = java.util.Locale.getAvailableLocales();
for (int i = 0; i &lt; locales.length; ++i) {
  System.out.println(locales[i].toString());
}
</pre></div>
      <p>The strength argument is a number from 1 to 4, corresponding to the collator strengths
        PRIMARY, SECONDARY, TERTIARY and IDENTICAL. If the strength is unspecified, the default
        strength of the <code>java.text.Collator</code> instance is used. Example usages:</p>
      <div class="eg"><pre>
compare($string1, $string2, xs:anyURI("en")),
starts-with($string, "abc", xs:anyURI("nl_NL")),
ends-with($string, "xyz", xs:anyURI("no/1")),
substring-after($string1, $string2, xs:anyURI("fr_CA/2"))
</pre></div>
      <p>If you do not specify a collation, the implementation will use the normal Java String class
        methods for comparison, effectively comparing UTF-16 code units. Note that functions like
          <code>substring</code> and <code>string-length</code> always count Unicode code points,
        which may not give the same result as counting Java characters.</p>
    </div>
    <div class="div3">
      <h4><a name="d1e8496"/>7.5.9 Limitations</h4>
      <p>We do not implement the complete working draft, in particular:</p>
      <ul>
        <li>
          <p> The following items are not supported: <ul>
              <li>
                <p> Collations in "order by" specifications </p>
              </li>
              <li>
                <p> The XML base-uri declaration and the construction declaration </p>
              </li>
              <li>
                <p> Type names in element tests and attribute tests </p>
              </li>
            </ul>
          </p>
        </li>
        <li>
          <p> Of the XQuery optional features we support: <ul>
              <li>
                <p>Full Axis Feature: supported</p>
              </li>
              <li>
                <p>Schema Import Feature: not supported</p>
              </li>
              <li>
                <p>Static Typing Feature: not supported</p>
              </li>
              <li>
                <p>Module Feature: supported</p>
              </li>
              <li>
                <p>Static Typing Extensions: not supported</p>
              </li>
            </ul>
          </p>
        </li>
        <li>
          <p> As in XPath 1.0, a path step does not set the context size and position, only
            predicates do so. You can work around that by using a <code>for</code> iterator
            with a positional variable (<code>for $x at $y in ...</code>) and the <code>count()</code>
            function.
          </p>
        </li>
      </ul>
    </div>
  </div>
  <div class="div2">
    <h3><a name="xquery_indexes"/>7.6 Using indexes in XQuery</h3>
    <p><nobr>X-Hive/DB</nobr> contains <a href="#indexes" target="">several kinds of indexes</a>:</p>
    <ul>
      <li>
        <p><a href="#indexes_library_indexes" target="">Library name indexes and library id indexes</a>.
          If available, these are always used by the XQuery <code>document()</code> function.</p>
      </li>
      <li>
        <p><a href="#indexes_id_attribute_indexes" target="">Id attribute indexes</a> on documents are
          always used by the XQuery <code>id()</code>function. Id attribute indexes on libraries are
          never used by queries (except when explicitly used with the
          <code>xhive:get-nodes-by-key()</code> extension function).</p>
      </li>
      <li>
        <p><a href="#indexes_value_indexes" target="">Value indexes</a> and <a href="#indexes_element_name_indexes" target="">element name indexes</a> are used when the
          optimizer can determine that they can be used for a specific expression in the query. See
          below for details.</p>
      </li>
      <li>
        <p><a href="#indexes_context_conditioned_indexes" target="">Content conditioned indexes</a> can
          only be used with the <code>xhive:get-nodes-by-key()</code> extension function.</p>
      </li>
      <li>
        <p><a href="#indexes_full_text_indexes" target="">Full text indexes</a> in XQuery can be used
          through the <code>xhive:fts</code> function, see the <a href="#xquery_fts" target="">"Full text
            searching" paragraph</a> for more details. External full text indexes are never used
          by queries.</p>
      </li>
    </ul>
    <div class="div3">
      <h4><a name="d1e8665"/>7.6.1 Value and element name indexes</h4>
      <p>Value indexes and element name indexes are used for path expressions that:</p>
      <ul>
        <li>
          <p>Start with a call to the XQuery <code>document()</code> function that specifies the
            document or library containing the index or one of its ancestor libraries. If the
            specified library does not contain a useful index, but one or more descendant libraries
            do, the evaluator will use the index on those descendant libraries and evaluate the
            query in the other libraries by brute force search.</p>
        </li>
        <li>
          <p>Contain only "downward" steps. That is: <code>child</code>, <code>descendant</code> or
              <code>descendant-or-self</code>. Of course, this includes the abbreviated versions
            like <code>//</code>. For element name indexes, the first step must be a
              <code>descendant(-or-self)</code> step.</p>
        </li>
        <li>
          <p>Contain at most one predicate per step. If you have multiple predicates in a step,
            rewrite them to use <code>and</code>. For instance, replace <div class="eg"><pre>//parent[@color =
              "red"][elem[@attr = "green"]]</pre></div> with <div class="eg"><pre>//parent[@color = "red" and elem[@attr =
              "green"]]</pre></div> to have the query use possible value indexes on
            <code>parent/@color</code> and <code>elem/@attr</code>. </p>
        </li>
        <li>
          <p>For value indexes: contain a predicate or where-clause that checks the indexed value
            using <code>eq</code> or <code>=</code> against any expression that is constant for this
            path expression and whose type corresponds to the type of the value index.</p>
        </li>
        <li>
          <p>For element name indexes: contain a step with an indexed element name.</p>
        </li>
      </ul>
      <p>Assume there is a value index (with the default type "STRING") on attribute
        <code>attr</code> of element <code>elem</code> on the root library. Here are some examples:</p>
      <div class="eg"><pre>
(: Use index without further checks :)
document("/")//elem[@attr = $var]

(: Ditto :)
for $x in document("/")//elem
where $x/@attr eq func(2)
return ...

(: Use index and check parent of indexed element :)
document("/")//parent[@color = "red"]/elem[@attr = "green"]

(: Use index and check ancestors of indexed element :)
document("/")/parent[@color = "red"]//elem[@attr = "green"]

(: Use index and lookup children :)
document("/")//elem[@attr eq substring($str, 1, 3)]/name

(: Use index and return parent of indexed node :)
document("/")//parent[elem/@attr = "black"]

(: Use index and return all ancestors of
    indexed nodes called "parent" :)
document("/")//parent[descendant::elem/@attr = "black"]
</pre></div>
      <p>With an element value index, the predicate or where-clause must check the contents of the
        element for an index to be used. Assume an element value index on the <code>elem</code>
        element in the root library:</p>
      <div class="eg"><pre>
(: Use the index directly :)
document("/")//elem[. eq "red"]

(: In a flower expression :)
for $x in document("/")//elem
where $x = "green"

(: Uses text() instead of context node :)
document("/")//person/elem[text() = "yellow"]

(: Use the index and return the parent of the indexed node :)
document("/")//person[elem = "black"]

(: Or equivalently :)
for $x in document("/")//person
where $x/elem = "black"
return $x
</pre></div>
      <p> See also the <a href="#indexes_path_indexes" target="">section on path indexes</a> for more
        examples of queries using indexes. </p>
    </div>
    <div class="div3">
      <h4><a name="d1e8773"/>7.6.2 Range queries</h4>
      <p>Range queries are queries that constrain data to a range of values, instead of to a single
        value. If the optimizer finds a predicate or where-clause that uses both "less than (or
        equal)" and "greater than (or equal)" on the same node, it can use an index (if available)
        to find the values in the requested range. Only indexes with the
          <code>XhiveIndexIf.KEY_SORTED</code> property can be used for range queries. Example:</p>
      <div class="eg"><pre>
document('/')//book[@author &gt;= "A" and @author &lt; "B"]
</pre></div>
      <p>If there is an index (with sorted keys) on <code>book/@author</code>, the optimizer will
        scan the index from A to B to find the result of this expression.</p>
      <p>You should be careful that the optimizer can be sure that the conditions refer to the same
        node. In this example:</p>
      <div class="eg"><pre>
(: Cannot use range query on author index :)
document('/')//book[author &gt;= "A" and author &lt; "B"]
</pre></div>
      <p>the optimizer cannot use the <code>author</code> index in a range query, because the book
        may have one author satisfying the first condition and another author that satisfies the
        second condition. To make both conditions refer to the same author and allow use of the
        index, you have to write the query like this:</p>
      <div class="eg"><pre>
(: Can use range query on author index :)
document('/')//book[author[. &gt;= "A" and . &lt; "B"]]

(: Can use path index book[author + title] :)
document('/')//book[author = "Asimov" and title[. &gt;= "Robot" and . &lt; "Second"]]
</pre></div>
    </div>
    <div class="div3">
      <h4><a name="d1e8809"/>7.6.3 Indexes on metadata</h4>
      <p> To use an index that has been created on the library <code>mylib</code> on the metadata
        field <code>author</code>, use: </p>
      <div class="eg"><pre>
document("/mylib")[xhive:metadata(., "author") = "Jane Doe"]
</pre></div>
      <p> This will look up <code>Jane Doe</code> in the <code>author</code> index and return all
        documents found. The optimizer can only use indexes for expressions where the metadata key
        is a string literal or the literal empty sequence (for an index on all metadata fields), not
        a generic expression. With full text indexes, you need an expression like: </p>
      <div class="eg"><pre>
document("/mylib")[xhive:fts(xhive:metadata(., "p"), "XQuery")]
</pre></div>
    </div>
    <div class="div3">
      <h4><a name="d1e8839"/>7.6.4 Multiple indexes</h4>
      <p> If different parts of a query can use different indexes, this is done in the obvious way.
        E.g., if you have an index on attribute x of element x, and an index on attribute y of
        element y, both will be used in </p>
      <div class="eg"><pre>
for $x in document("/")//x[@x = "x"]
for $y in document("/")//y[@y = $x/@yref]
return ...

(: or, equivalently :)

for $x in document("/")//x
for $y in document("/")//y
where $x/@x = "x"
and $y/@y = $x/@yref
return ...
</pre></div>
      <p>If both indexes can be used for a single path expression, the optimizer creates a query
        plan with an intersection. If you use a query like</p>
      <div class="eg"><pre>
document("/")//x[@x="x"]/y[@y="y"]
</pre></div>
      <p>the optimizer first looks up <code>"x"</code> in the index for <code>x/@x</code> and stores
        the result in a temporary set. It then looks up <code>"y"</code> in the index for
        <code>y/@y</code>, and checks that the parents of the indexed elements are present in the
        temporary set. If so, the node element is put in the result set. This is somewhat like
        evaluating the query</p>
      <div class="eg"><pre>
let $x := xhive:get-nodes-by-key("/", "x/@x", "x")
return xhive:get-nodes-by-key("/", "y/@y", "y")[parent::x intersect $x]
</pre></div>
      <p> With metadata indexes, you can create similar combinations. <div class="eg"><pre>
document("/")[xhive:metadata(., "status") = "ready" and .//x/@x = "x"]

document("/")[xhive:metadata(., "author") = "PP"]//chapter[xhive:fts(title, "<nobr>X-Hive/DB</nobr>")]
</pre></div>
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e8881"/>7.6.5 Using indexes to enhance order by performance</h4>
      <p>
        Indexes with the property <code>XhiveIndexIf.KEY_SORTED</code> can be used to speed up queries
        that use an <code>order by</code> statement. This is only possible if
      </p>
      <ul>
        <li>the single order specs (the expressions given in the <code>order by</code> statement, 
          separated by commata) match the indexed values, in the correct order</li>
        <li>the FLWOR expression is run on a single indexed library or document</li>
        <li>the <code>order by</code> is not <code>stable</code></li>
      </ul>
      <p>
        If there is a multi-valued path value index, the optimizer will try to use as many values from the index
        as possible. In this case the order specs have to be in the same order as in the index
        specification.
      </p>
      <div class="eg"><pre>
(: with an index on foo.xml, this will use an order by index :)
for $book in document('foo.xml')//book[@year] 
  (: have to mention child for index usage :)
order by $book/@year descending
return $book
</pre></div>
      <p>
        You can find out if your <code>order by</code> query is being optimized by enabling the 
        queryplan debug statements. Given a path value index like 
        <code>//book[@year&lt;STRING&gt; + title&lt;STRING&gt;]</code> this query will print something
        like <code>Found an index to support the first 2 order specs</code>.
      </p>
      <div class="eg"><pre>
declare option xhive:queryplan-debug 'stdout';
for $book in document('foo.xml')//book[@year and title]
order by $book/@year, $book/title
return $book
</pre></div>
      <p>
        It is also possible to optimize a subset of the order specs, e.g. if an index can only 
        support two of three order specs, only the last order spec has to be evaluated, and that
        only in the case the first two values are equal.
      </p>
      <p>
        Queries that use range or equality comparisons on index values in combination with an
        order by statement will also benefit from indexes.
        With the path value index from the last example, this query will be speed up, too.
      </p>
      <div class="eg"><pre>
for $book in document('/booklib/')//book[@year = '2002' and title &gt; 'V']
order by $book/@year, $book/title
return $book
</pre></div>
    </div>
  </div>
  <div class="div2">
    <h3><a name="xquery_type"/>7.7 Type information and XQuery</h3>
    <p>There are two ways in which type information is stored in <nobr>X-Hive/DB</nobr>:</p>
    <ul>
      <li>
        <p>Value indexes can have a <a href="#indexes_value_indexes" target="">type</a>.</p>
      </li>
      <li>
        <p>During validation of a document, <a href="#catalog_PSVI" target="">PSVI</a> information can be
          stored with the nodes of the document, registering the type of the node as declared in the
          associated XML Schema.</p>
      </li>
    </ul>
    <p>In this section, information is given on how this typed information is used in XQuery. The
      focus here is on the basic data-types (as defined in XML Schema and used in XQuery), not on
      derived types that can also be used in XQuery and in PSVI.</p>
    <p>When you have a query like <div class="eg"><pre>//element[@id &lt; /my/first/idelement]</pre></div> the way the
      comparison between the <code>id</code>-attribute and the <code>idelement</code> element is
      processed, depends on the type-information that can be found for the data:</p>
    <ul>
      <li>
        <p>If no type information can be found anywhere, the comparison is performed between the
          string-values of the two items involved.</p>
      </li>
      <li>
        <p>If PSVI information is stored for the items involved, it will use that. For instance, if
          it is known that <code>/my/first/idelement</code> represents an integer, the comparison
          will be performed as if both values are integers. This can be important for ordering (e.g.
          2 &lt; 12, but '2' &gt; '12').</p>
      </li>
      <li>
        <p>If the <code>id</code> attribute is known to be an integer, but
          <code>/my/first/idelement</code> is known to be of an incompatible type (through PSVI),
          the XQuery processor will give an exception.</p>
      </li>
      <li>
        <p>In the above example, the XQuery processor would be able to use a value index on the
            <code>id</code> attribute (it should be noted that this would have to be a sorted index
          because of the '&lt;'). For the query example what kind of index is looked for
          actually depends on the type of <code>/my/first/idelement</code>. If the element would be
          untyped, or the PSVI information would indicate it represents a string, a value index of
          type string would be used. But if PSVI information indicates that the type of
            <code>/my/first/idelement</code> in the linked XML Schema is an integer, an integer
          index would be looked up (and, when only a string value index would be defined it would
          not be used).</p>
        <p>What is important to realize is that the index-type will never determine the type used in
          the comparison. First a type is determined for the comparison, and only then will an index
          of that type be looked for. However, when a typed index is used it can lead to different
          query results compared to a query evaluation without that index, as
          <code>id</code>-attributes would be treated as integers when an integer index would be
          used, where otherwise they may have been untyped and treated as text.</p>
        <p>It can be useful to add <a href="#xquery_setoption_options" target="">xhive:set-option("queryplan-debug", "stdout")</a> to your query, then debugging
          information will be printed on what indexes (and indexes of what type with what options)
          are being sought by the XQuery processor. </p>
      </li>
      <li>
        <p>If you would want to execute the sample XQuery with an integer comparison, but
            <code>/my/first/idelement</code> does not have PSVI information or has PSVI information
          but is of a non-integer type in the linked XML Schema, you can still get the correct
          result by explicitly casting the compared value to the right type, or using one of the
          internal conversion functions, like <div class="eg"><pre>//element[@id &lt;
          int(/my/first/idelement)]</pre></div> or <div class="eg"><pre>//element[@id &lt; (/my/first/idelement cast as
            xs:integer)]</pre></div>
        </p>
      </li>
    </ul>
    <p class="prefix"><b>See also:</b></p>
      <div class="refheader"><b>samples:</b></div><div class="ref2samples">
        <a href="../../src/samples/manual/TypedIndex.java">&lt;XhiveDir&gt;\src\samples\manual\TypedIndex.java</a><br/>
      </div><br/>
    
  </div>
  <div class="div2">
    <h3><a name="xquery_misc"/>7.8 Miscellaneous performance tips</h3>
    <li>
      <p>If a path expression uses an index, use as few explicit steps as possible, as these must
        all be checked to verify whether they match. On the other hand, if the path expression does
        not use an index, but must be searched by scanning the document, use as many explicit steps
        and predicates as possible, so that branches of the DOM tree can be skipped as soon as
        possible. <div class="eg"><pre>
(: Preferred with index :)
document("/")//elem[@attr = "green"]

(: Preferred without index :)
document("/")/docelem/persons/person/name/elem[@attr = "green"]
</pre></div>
      </p>
    </li>
    <li>
      <p>Some predicate expressions are optimized to stop searching as soon as the required number
        of items are found. If the predicate is an integer expression that does not depend on the
        context node, context position or context size evaluation will stop as soon as possible.
        Similarly if the predicate requires <code>position()</code> to be less than (or equal to)
        such an expression.</p>
      <div class="eg"><pre>
(: Stops searching after the second foo element :)
let $x := document("/mydoc")//foo
return $x[position() le 2]

(: Also stops searching after the second foo element :)
let $x := document("/mydoc")//foo
return $x[2]
</pre></div>
      <p>Sometimes you can rewrite a query to make it use such a predicate.</p>
      <div class="eg"><pre>
(: Tests predicate for all foo elements :)
(document("/mydoc")/descendant::foo)[position() = 2 to 4]

(: Stops after the fourth foo element :)
(document("/mydoc")/descendant::foo)[position() le 4][position() ge 2]
</pre></div>
      <p>In cases like the above example, you can also use the <code>subsequence()</code> function
        to make sure that the a search does not continue after the requested number of items.</p>
      <div class="eg"><pre>
(: Stops searching after the fourth foo element :)
let $x := document("/mydoc")//foo
return subsequence($x, 2, 3)
</pre></div>
    </li>
    <li>
      <p>Use <code>let</code> to move expensive computations out of loops. </p>
      <div class="eg"><pre>
(: Before (searches document b for each occurrence of element a) :)
document("/a")//a[@id = document("/b")//b[@id = "10"]/@ref_a_id]

(: After (searches document b at most once) :)
let $ref_a_id := document("/b")//b[@id = "10"]/@ref_a_id
return document("/a")//a[@id = $ref_a_id]
</pre></div>
    </li>
    <li>
      <p>If you know something occurs only once, use a predicate <code>[1]</code> to allow the
        evaluator to stop searching after the 1st occurrence. </p>
      <div class="eg"><pre>
(: Even better if you know each id is only used once,
    will stop searching after 1st occurrence found. :)
let $ref_a_id := (document("/b")//b[@id = "10"])[1]/@ref_a_id
return (document("/a")//a[@id eq $ref_a_id])[1]

(: Do not confuse the previous query with this one.
    This query is probably not what the user intended. :)
let $ref_a_id := document("/b")//b[@id = "10"][1]/@ref_a_id
return document("/a")//a[@id eq $ref_a_id][1]
</pre></div>
    </li>
    <li>
      <p>Use the <code>unordered</code> function where possible. If the order of the result is not
        important, using <code>unordered</code> may speed up your query by allowing the evaluator to
        elide sorting the result in document order. </p>
      <div class="eg"><pre>
(: Assuming the query uses an index, this needs to 
    sort the values looked up in the index. :)
document("/")//elem[@attr = 'value']

(: This version needs no sorting step. :)
unordered(document("/")//elem[@attr = 'value'])
</pre></div>
    </li>
    
  </div>
  <div class="div2">
    <h3><a name="xquery_fts"/>7.9 Full text searching</h3>
    <p><nobr>X-Hive</nobr> extends XQuery with a full text search function. The full text search function can be
      used to search for terms within a text string. In general you can think of 'terms' as words.
      For example, the string, 'yadda yadda yadda' contains three terms, each with the value
      'yadda'. In <nobr>X-Hive</nobr> terms are the basic units for full text indexing and searching. This is
      different from for instance the contains function in XQuery that considers the text as a
      single monolithic string. Using the full text search function has a number of advantages,
      since the full text search function :</p>
    <ul>
      <li>
        <p>looks upon the input string as a list of terms, instead of a list of charachters like the
          contains function does. This makes the usage of indexes more practical. Currently no
          indexes are used when using the contains function, the full text search, however, can use
          indexes.</p>
      </li>
      <li>
        <p>Allows usage of wildcards, and prefixes.</p>
      </li>
      <li>
        <p>Allows you to search for exact or sloppy phrases.</p>
      </li>
    </ul>
    <p>What is exactly seen as a term is determined by the <a href="#fts_tokenization" target="">tokenization process</a> which is controlled by the <a href="#fts_analyzer" target="">analyzer</a> class</p>
    <p>X-Hive's current full text search implementation is partially based on code from the <a href="http://jakarta.apache.org/lucene/docs/index.html" target="">Lucene</a> project. This manual
      also contains parts from the Lucene <a href="http://lucene.sourceforge.net/cgi-bin/faq/faqmanager.cgi" target="">Lucene FAQ</a></p>
    <div class="div3">
      <h4><a name="d1e9202"/>7.9.1 xhive:fts function</h4>
      <p>The full text search function is declared as follows:</p>
      <div class="eg"><pre>
  xhive:fts(node(s), querystring, options)
</pre></div>
      <p>The first argument of the function should be a (set of) node(s). The second argument is
        expected to be a <a href="#fts_syntax" target="">query string</a>. If a set of nodes is provided
        as the first argument the full text search is executed on all the nodes. The
        <code>options</code> argument is optional and (if present) should be a string literal
        containing a semicolon-separated list of options.</p>
      <p>The result is a boolean value returning true if the text matches the query.</p>
      <p>There is an option <code>include-attrs</code>, with this option when you execute the
        function on elements, the attribute values of that element (and descendants) are evaluated
        along with the other text-nodes. Note that if you want to use the <code>include-attrs</code>
        option in combination with full text indexes, you must use the
        <code>FTI_INCLUDE_ATTRIBUTES</code> option on that index (and vice versa, if you do not use
          <code>include-attrs</code> the option may not be set on the index).</p>
    </div>
    <div class="div3">
      <h4><a name="fts_syntax"/>7.9.2 Full text search query syntax</h4>
      <p>The syntax of full text search queries is as follows:</p>
      <div class="eg"><pre>      
 Query       ::=  Clause  ( [ Conjunction ] Clause ) *

 Conjunction  ::= 'AND' | 'OR' | '||' | '&amp;&amp;'

 Clause       ::=  [ Modifier ] BasicClause  [ Boost ]

 Modifier     ::= '-' | '+' | '!' | 'NOT'

 BasicClause  ::= ( TermQuery | Phrase | '(' Query ')' )

 TermQuery    ::= ( Term | WildCardTerm | PrefixQuery ) [ Fuzzy ] 

 PrefixQuery  ::= Term '*'
 
 Phrase       ::= '"' Term * '"' [ SlopFactor ]

 Fuzzy        ::= '~' 
 
 SlopFactor   ::= '~' DecimalDigit+

 Boost        ::= '^' DecimalDigit+ '.' DecimalDigit+

 Term         ::= &lt;a-word-or-token-to-match&gt;
 
 WildCardTerm ::= &lt;a-word-or-token-to-match-with-wildcards&gt; 

</pre></div>
    </div>
    <div class="div3">
      <h4><a name="d1e9253"/>7.9.3 Boolean queries</h4>
      <p>A boolean query represents a composite query that may contain sub queries of arbitrary
        nesting level and with composition rules such as 'and', 'or' or 'not'. </p>
      <p>Each sub query of a boolean query has two binary qualifiers that control how its super
        query is matched. These qualifiers are:</p>
      <ul>
        <li>
          <p>prohibited - when this flag is set, the matching status of the sub query is negated
            such that the query is considered as a match only when the sub query does not match.</p>
        </li>
        <li>
          <p>required - when this flag is set, the sub query is required to match (or not to match
            if its 'prohibited' flag is set) for the super query to match. This this is a necessary
            but not sufficient condition for the super query to match.</p>
        </li>
      </ul>
      <p>The default conjunction is OR, so a query like "apples oranges bananas" is equal to "apples
        OR oranges OR bananas"</p>
      <p>There is some overlap of functionality with XQuery. XQuery also allows you to use the same
        boolean operators. For instance the query:</p>
      <div class="eg"><pre>
//element[xhive:fts(., "apples AND oranges")]
</pre></div>
      <p>Yields the same results as the query:</p>
      <div class="eg"><pre>
//element[xhive:fts(., "apples") and xhive:fts(., "oranges")]
</pre></div>
      <p>So there is no semantical differences between the two options. But in the current
        implementation the first type of query will be siginifcantly faster than the second type
        (this could change in future versions).</p>
    </div>
    <div class="div3">
      <h4><a name="d1e9298"/>7.9.4 Prefix search</h4>
      <p>Search for all terms starting with a certain prefix.</p>
    </div>
    <div class="div3">
      <h4><a name="d1e9307"/>7.9.5 Phrase search</h4>
      <p>A phrase query represents a query that is matched against a consecutive sequence of terms
        in the field. For example, the phrase query 'winding road' should match 'winding road' but
        not 'road winding' (with the exception of more relaxed slop factors as discussed below).</p>
      <p>A phrase query may have an optional boost factor and an optional slop parameter (default =
        0). The slop parameter can be used to relax the phrase matching by accepting somewhat out of
        order sequences of the terms.</p>
    </div>
    <div class="div3">
      <h4><a name="d1e9319"/>7.9.6 Wildcards</h4>
      <p>The following wildcards can be used: *, ?. The * wildcard is a substitute for an abitrary
        number of charachters, the ? wilcard substitutes a single charachter.</p>
      <p>Take care when using wilcards as first character of a term since <nobr>X-Hive</nobr> is not able to use
        an index.</p>
    </div>
    <div class="div3">
      <h4><a name="fts_tokenization"/>7.9.7 Tokenization</h4>
      <p>Tokenization is the process of breaking content in 'terms' (words). In <nobr>X-Hive</nobr> tokenization
        is done by an object called the <a href="#fts_analyzer" target="">analyzer</a>.</p>
    </div>
    <div class="div3">
      <h4><a name="fts_analyzer"/>7.9.8 The analyzer</h4>
      <p>An analyzer breaks up content in tokens, and can also change tokens to improve
        searchability. It might change the terms to lowercase, or change a term from plural to
        singular.</p>
      <p>For example, an analyzer can break the text 'The ill dogs' into the tokens 'the', 'ill,
        dogs' (lower case) while another analyzer can break it into 'ill', 'dog' (lower case, plural
        normalized to singular and the common word 'the' removed').</p>
      <p>Both the text to be searched and the query are passed through the same analyzer. If an
        index is available then the same analyzer as used for building the index is used for
        analyzing the query. If no index is available then it depends on the value of the
        "fts-analyzer-class" option which analyzer is used. To use a different analyzer in the
        query, include its class name as an option in the optional <code>options</code> argument of
        the <code>xhive:fts</code> function.</p>
      <p>The default analyzer used by the fts function has the following behaviour: <ul>
          <li>
            <p>It creates terms containing only letters and/or digits (everything else will trigger
              the start of a new term).</p>
          </li>
          <li>
            <p>It converts all charachters in a term in lower case.</p>
          </li>
          <li>
            <p>English stopwords are filtered out. The list of english stopwords that are filtered
              out is: "a", "and", "are", "as", "at", "be", "but", "by", "for", "if", "in", "into",
              "is", "it", "no", "not", "of", "on", "or", "s", "such","t", "that", "the", "their",
              "then", "there", "these", "they", "this", "to", "was", "will", "with".</p>
          </li>
        </ul>
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e9388"/>7.9.9 Examples</h4>
      <p>An example with java code is included in the distribution.</p>
      <p>Examples of full text search queries are</p>
      <div class="eg"><pre>  
(: The text should contain the terms 'apples' and 'oranges' :)
'apples AND oranges' 

(: The text should contain the term 'oranges' but not the term 'apples' :)
'!apples &amp;&amp; oranges'  

(: The text should contain terms starting starting with appl* :)
'appl*' 

(: The text should contain the phrase "apples and oranges" :)
'" apples and oranges "' 

(: The text should contain something like the phrase 
    "apples and oranges" the maximum distance between 
    the terms should be at most 3 terms. :)
'" apples and oranges " ~3'
</pre></div>
    </div>
    <div class="div3">
      <h4><a name="d1e9403"/>7.9.10 Limitations</h4>
      <p> The current full text search implementation has some limitations: <ul>
          <li>
            <p>The query parses recognizes boost factor, but currently it's not possible to rank the
              end results.</p>
          </li>
          <li>
            <p>Prefix queries are not passed through the analyzer. This is especially important to
              know if your index contains only lowercase terms, because in that case you should not
              use uppercase letters in your prefix query.</p>
          </li>
          <li>
            <p>Using phrase queries on indexed nodes when the index does not support phrase queries
              will currently yield an unsupported operation exception. This means that when using
              phrase queries you should either use an index that supports phrase queries, or no
              index at all.</p>
          </li>
          <li>
            <p>Phrase queries should always be surrounded by double quotes. A list of terms within
              single quotes is not yet recognized by the query parser as a phrase query.</p>
          </li>
        </ul>
      </p>
    </div>
  </div>
</div>

	
<div class="div1">
	<h2><a name="indexes"/>8 Using indexes</h2>
	<p>Indexes are used to speed up queries. Especially in case of large datasets, indexes
	are essential to query performance.</p>
	<p>An index stores key-value pairs. In <nobr>X-Hive/DB</nobr>, the index key is a string or (for value
        indexes only) a number type and its value a node set. <nobr>X-Hive/DB</nobr> currently has the following indexing methods:</p>

  <ul>
	  <li><p><a href="#indexes_library_indexes" target="">Library indexes.</a></p></li>
	  <li><p><a href="#indexes_id_attribute_indexes" target="">Id attribute indexes.</a></p></li>
	  <li><p><a href="#indexes_element_name_indexes" target="">Element name indexes.</a></p></li>
	  <li><p><a href="#indexes_value_indexes" target="">Value indexes.</a></p></li>
	  <li><p><a href="#indexes_path_indexes" target="">Path indexes.</a></p></li>
	  <li><p><a href="#indexes_full_text_indexes" target="">Full text indexes.</a></p></li>
	  <li><p><a href="#indexes_context_conditioned_indexes" target="">Context conditioned indexes.</a></p></li>
	</ul>
	
	<p>Each <nobr>X-Hive/DB</nobr> indexing method has certain characteristics:</p>
	<ul>
    <li>
	<p>An index is either 'live' or 'non-live'. 'Live' indexes are automatically updated when the indexed data is updated. 'Non-live' indexes are only updated on request .</p>
  	<p>All indexes, except for context conditioned indexes, are 'live' indexes.  As a result, the existence of indexes affect data update performance in a negative way. To maintain performance of data updates, it is important to add a 'live' index only if the index is essential to query performance and to select index type and location with care.</p>
	<p>Context conditioned indexes are updated at user-request and therefore data update performance is not influenced by this type of indexes.</p>	
    </li>
    <li><p>An index can be defined on library or document level and is maintained automatically for all descendants (id attribute, value, library, element name and full text indexes) or for all children (library indexes) of that level. Context conditioned indexes are updated on request.</p></li>
    <li><p>Library name and library id indexes can only be defined on libraries, all other indexes on both libraries and documents (in most cases, you will want to place indexes on the libraries).</p></li>
    <li><p>An index is either accessible or inaccessible through an index list (<code>XhiveIndexListIf</code>).</p></li>
	</ul>

	<p>All index types have a common interface (<code>XhiveIndexIf</code>).
	These indexes are created with the following default properties:
  <ul>
		<li><p>The index does not keep the keys sorted.</p></li>
		<li><p>The index is stored in a separate storage container and therefore not locked with its owner library or document. This way, concurrent acces to the index is improved.</p></li>
		<li><p>The key type of value indexes is <code>XhiveIndexIf.TYPE_STRING</code>.</p></li>
	</ul>			
	</p>
		
	<p>Indexes are very scalable: the number of keys and values of an index can grow without limitations. Especially in case of Id attribute, element name and value indexes, values (node sets) can become very large. Information about how to optimize index performance can be found <a href="#index_performance" target="">here</a>.</p>

  <p>The following paragraphs describe each indexing method in detail.</p>

		<div class="note"><p class="prefix"><b>Note:</b></p>
    <p>A detailed description of how XQuery uses indexes internally can be found <a href="#xquery_indexes" target="">here</a></p>
		</div>

	<div class="div2">
		<h3><a name="indexes_library_indexes"/>8.1 Library indexes</h3>
		<p>Library indexes improve the performance and scalability of access to the children of a library. This indexing method can only be applied to libraries. Library indexes are 'live', which means that indexes are updated automatically when library children (e.g. documents, libraries, BLOB nodes etc.) are inserted, replaced or removed. Library indexes are stored in a <code>XhiveIndexListIf</code> and must have a unique name.</p>
		<p>There are two types of library indexes:
    <ul>
      <li><p><a href="#indexes_library_indexes_id" target="">Library id index.</a></p></li>
		  <li><p><a href="#indexes_library_indexes_name" target="">Library name index.</a></p></li>
    </ul>
		</p>
		<p>A library can only have one library id and one library name index. Adding a second library id or library name index will generate a exception.</p>
    <p>By default, a library has a library name index. The root library also has a library id index.</p>
		<div class="div3">
			<h4><a name="indexes_library_indexes_id"/>8.1.1 Library id indexes</h4>
			<p>A library id index stores the children of a library by their id. This index improves the performance and scalability of method <code>get(long id)</code> in <code>XhiveLibraryIf</code>. As each library child is given a unique id, each child of the library can be accessed through the index. It is recommended to use library id indexes when a large number of children is stored in the library and the <code>get(long id)</code> method is used.</p>
		</div>
		<div class="div3">
			<h4><a name="indexes_library_indexes_name"/>8.1.2 Library name indexes</h4>
			<p>A library name index stores the children of a library by their name. This index improves the performance and scalability of method <code>get(String name)</code> in <code>XhiveLibraryIf</code>. As names are not mandatory for library children, not all children may be represented by the index. It is recommended to use library name indexes when method <code>get(String name)</code> is used and a large number of library children is involved. The index also improves performance of XLink operations and full path XPointer queries as library and document names are used to uniquely identify a document in a library.</p>
		</div>
	</div>
	<div class="div2">
		<h3><a name="indexes_id_attribute_indexes"/>8.2 Id attribute indexes</h3>
		<p>An id attribute index stores elements by their element id. An element id is the (unique) attribute of an element of type ID. The id attribute index is used by and improves the performance of DOM method <code>getElementById(String elementId)</code> and XQuery/XPath/XPointer queries.</p>
    <p>You can specify which attributes are ID-attributes in the DTD or XML-schema linked to the document. When a DTD  is associated with the document in the database (e.g. by parsing with validation), attributes created through the DOM call <code>createAttribute(String name)</code> will be made ID-attributes when so defined in the DTD. If you do not want to work with a DTD, you can also explicitly make ID-attributes by calling <code>createIDAttribute(String name)</code> on <code>XhiveDocumentIf</code>.</p>
		<p>Id attribute indexes can be created on either library or document level. Element id's are only unique within the context of a document. Therefore, id attribute indexes on library level can have more values for a given id. Furthermore, not validated documents may also have more elements with the same id. The index does not  limit the number of entries for a given key.</p>
		<p>Id attribute indexes are 'live', which means that they are automatically updated when element id's are inserted, replaced or removed. The indexes are of class <code>XhiveIndexIf</code> and stored in a <code>XhiveIndexListIf</code>. As index lists can store indexes of different types, each index in the index list must have a unique name. Each index list can only contain one id attribute index.</p>
		<div class="note"><p class="prefix"><b>Note:</b></p><p>Id attribute indexes are used by XQuery/XPath/XPointer queries and the <code>getElementsById(String elementId)</code> method. This type of indexes will most likely not be accessed directly by users.</p></div>
	</div>
	<div class="div2">
		<h3><a name="indexes_element_name_indexes"/>8.3 Element name indexes</h3>
		<p>An element name index stores elements by their name. This means they are only useful if you want to get all elements with a certain name. To access elements with certain values, see the <a href="#indexes_value_indexes" target="">Value Indexes</a>. Two types of element name indexes are supported:
		<ul>
		  <li><p>All elements are indexed.</p></li>
		  <li><p>Only elements of a selection of element names are indexed. This type of index is called a selected element name index.</p></li>
		</ul></p>
		<p>To maintain performance of data updates, users are recommended to use selected element name indexes, if at all.</p>
    <p> To distinguish between elements of same (local)name with different namespaces, keys must be 
      namespaceaware. An element is indexed with key: <ul> <li><p>String nodeName, when 
      the namespaceURI is null</p></li> <li><p>String namespaceURI + ' ' + 
      localName, when the namespaceURI is not null. The string contains both namespaceURI 
      and local name, divided by one single space character. I.e. an element with namespaceURI 
      <code>http://www.x-hive.com</code> and local name <code>chapter</code> is indexed by key 
      <code>http://www.x-hive.com chapter</code></p></li> </ul> </p>
		<p>Element name indexes can be created on either library or document level.</p>

	</div>

	<div class="div2">
		<h3><a name="indexes_value_indexes"/>8.4 Value indexes</h3>
		<p>A value index stores elements by an element  value or an attribute value.
		  Value indexes are created on either library or document level.</p>
		<p>There are three different types of value indexes:
			<ul>
				<li><p>Value indexes that store elements by element value.</p></li>
				<li><p>Value indexes that store elements by attribute value.</p></li>
				<li><p>Value indexes that store named elements by attribute value.</p></li>
			</ul>
		</p>
		<p>Value indexes are 'live' which means that they are automatically updated when
		 elements and/or attributes are inserted, replaced or removed.</p>
		<p>An index list can contain multiple value indexes.</p>
		<p>Value indexes have namespace support. Whenever namespaces are used, the documents involved
		must have been parsed with the <code>XhiveIndexIf.PARSER_NAMESPACES_ENABLED</code> option and the
		<code>elementURI</code> and/or <code>attributeURI</code> parameters must be supplied to the
		<code>addValueIndex()</code> method.</p>
		<div class="div3">
		  <h4><a name="indexes_value_indexes_type"/>8.4.1 Value Index Types</h4>
  		<p>For value indexes, it is possible to specify a type, which indicates the type of values that are put in the index. 
  		The default, and also the most common type, is the string type. The complete list of types is 
  		<code>TYPE_STRING</code>,
  		<code>TYPE_LONG</code>,
      <code>TYPE_INT</code>,
      <code>TYPE_FLOAT</code>,
      <code>TYPE_DOUBLE</code>,
      <code>TYPE_DAY_TIME_DURATION</code>,
      <code>TYPE_DATE_TIME</code>,
      <code>TYPE_DATE</code>,
      <code>TYPE_TIME</code>, and
      <code>TYPE_YEAR_MONTH_DURATION</code>.
      All these types match basic XML Schema data-types. 
      </p>
      <p>When selecting a type for the index, it is the responsibility of the
      user to make sure that all data that is indexed adheres to the type. This means that it is not required that the
      documents indexed for instance adhere to an XML Schema in which data-types are specified, as long as the values of 
      all elements and attributes that are placed in the index match the type-syntax the index will properly  constructed. When
      an attempt is made to index data that does not match the syntax of the type of the index, an exception is thrown.
  		</p>
  		<p>All data can be indexed using <code>TYPE_STRING</code>. However, it can be useful to index data that represents e.g.
  		decimals with type <code>TYPE_DOUBLE</code>, because:
  		<ul>
  		  <li><p>In the case of a sorted index, the sorting will be based on type rather than always in lexicographical order (e.g. 2 &lt; 15).</p></li>
  		  <li><p>Different lexicographical representations of the same value are registered under the same index key (e.g. 100.0 == 100.00).</p></li>
  		</ul>
  		Furthermore, when the XQuery processor is looking for an value of type integer and may be able to use an index, it will only look for
  		an integer value index.
  		</p>
  		<div class="note"><p class="prefix"><b>Note:</b></p><p>Value indexes are not integrated within XPath and XPointer, but are used by <a href="#xquery_indexes" target="">XQuery</a>.</p></div>
  		<p class="prefix"><b>See also:</b></p>
  			<div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
  				<a href="../apidocs/com/xhive/index/interfaces/XhiveIndexIf.html">com.xhive.index.interfaces.XhiveIndexIf</a><br/>
  			</div><br/>
  		
    </div>
	</div>

  <div class="div2">
    <h3><a name="indexes_path_indexes"/>8.5 Path indexes</h3>
    <p>
      Path indexes are like value indexes in that they index the value of elements and
      attributes. But path indexes allow a more general way of specifying the indexed element and
      also allow multiple element and/or attribute values to be used as index keys.
    </p>
    <p>
      Path indexes are specified using an XPath-like syntax consisting of a path to the indexed
      element and optionally a specification of the values to use as index keys. Like normal element
      value indexes, the element whose value is used as index key can only contain a single child
      node that must be a text or cdata section node. Here are various examples:
    </p>
    <ul>
      <li>
        <p>
          <code>//elem</code> will index the value of all elements with the name
          <code>elem</code>. This is exactly like an element value index. Such an index will be able
          to speed up queries like <code>//elem[. = "value"]</code>, but also for queries like
          <code>/foo/bar/elem[. = "value"]</code> or <code>/foo[bar/elem = "value"]</code>.
        </p>
      </li>
      <li>
        <p>
          <code>//elem[@attr]</code> will index the value of all <code>attr</code> attributes of
          <code>elem</code> indexes. This is exactly like an attribute value index. Such an index
          will speed up queries like <code>//elem[@attr = "value"]</code>.
        </p>
      </li>
      <li>
        <p>
          <code>//{http://www.example.com}elem[@{http://www.example.com}attr]</code> is like the
          previous index, except that now the elements and attributes must be in the namespace
          <code>http://www.example.com</code>.
        </p>
      </li>
      <li>
        <p>
          <code>//*[@attr]</code> will index the value of all <code>attr</code> attributes,
          regardless of the name of their owner element. This is exactly like an attribute value
          index. Such an index will speed up queries like <code>//*[@attr = "value"]</code> and also
          <code>//elem[@attr = "value"]</code>.
        </p>
      </li>
      <li>
        <p>
          <code>//chapter/title</code> will index the value of all <code>title</code> elements that
          are children of <code>chapter</code> elements. This is useful if you also have other title
          elements that should not be found in your query.
        </p>
      </li>
      <li>
        <p>
          <code>//chapter[title]</code> will also use the value of the title elements beneath
          chapter elements, but unlike the previous example the indexed nodes will be the
          <code>chapter</code> elements instead of the <code>title</code> elements. Both indexes can
          be used for a query like <code>//chapter[title="Intro"]</code>, but this index will save
          a parent lookup step from the indexed element. Only the previous example index can be used
          for the query <code>//chapter/title[. = "Intro"]</code>.
        </p>
      </li>
      <li>
        <p>
          <code>/root[node/@id]</code> will create an index where the keys are the values of
          <code>id</code> attributes of <code>node</code> elements that are children of the document
          element <code>root</code>. Using a path with only child steps like this can speed up index
          updates, because the whole document does not have to be searched for indexed elements.
        </p>
      </li>
      <li>
        <p>
          <code>//elem[@attr1 + @attr2]</code> will create an index where the keys are pairs of the
          values of the attributes <code>attr1</code> and <code>attr2</code>. This is useful for
          queries like <code>//elem[@attr1 = "value1" and @attr2 = "value2"]</code> that can be
          evaluated with only a single lookup in this index. This index will also be used for a
          query like <code>//elem[@attr1 = "value1" and @attr2]</code>, but not for a query like
          <code>//elem[@attr1 and @attr2 = "value2"]</code>. If one (or both) of the attributes does
          not exist for a particular element, the index will not contain that element, because the
          example query should never return that element.
        </p>
      </li>
      <li>
        <p>
          <code>//elem&lt;INT&gt;</code> will index the values of <code>elem</code> elements as
          integers, like a value index with the option <code>TYPE_INT</code>. This is useful for a
          query like <code>//elem[. = 10]</code> Specifying the type as an option is not possible
          with path indexes, because in a multivalue index each of the values used as the index key
          can have a different type.
        </p>
      </li>
      <li>
        <p>
          <code>//items/item[@id&lt;INT&gt; + price&lt;FLOAT&gt; +
          description/name&lt;STRING&gt;]</code> is an example of an index where the various values
          have different types. It can be used for the query <code>//items/item[@id = 10 and price =
          xs:float(4.53) and description/name = "keyboard"]</code>.
        </p>
      </li>
    </ul>

    <div class="div3">
      <h4><a name="d1e10055"/>8.5.1 Path index specification syntax</h4>
      <p>
        Here is a syntax for path index specifications.
      </p>
      <table frame="void">
        <tbody>
          <tr>
            <td rowspan="1" colspan="1"><code>spec</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>elementpath ( type | '[' values ']' )?</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>elementpath</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>elementstep+</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>elementstep</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>('/' | '//') name</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>values</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>value ( '+' value )*</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>value</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>('.' | '@' name | valuepath) type?</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>valuepath</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>'.//'? name (('/' | '//') name)* ('/@' name)?</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>type</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>'&lt;' ( 'STRING' | 'INT' | 'LONG' | 'FLOAT' | 'DOUBLE' | 'DATE_TIME' | 'DATE'
            | 'TIME' | 'YEAR_MONTH_DURATION' | 'DAY_TIME_DURATION' ) '&gt;'</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>name</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>'*' | uri? localname</code></td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"><code>uri</code></td>
            <td rowspan="1" colspan="1"><code>:=</code></td>
            <td rowspan="1" colspan="1"><code>'{' ([^&amp;}] | reference)* '}'</code></td>
          </tr>
        </tbody>
      </table>
      <p>
        In these productions <code>localname</code> is an XML name and <code>reference</code> is an
        XML character or predefined entity reference.
      </p>
    </div>

    <p class="prefix"><b>See also:</b></p>
      <div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
        <a href="../apidocs/com/xhive/index/interfaces/XhiveIndexIf.html">com.xhive.index.interfaces.XhiveIndexIf</a><br/>
      </div><br/>
    
  </div>

	<div class="div2">
		<h3><a name="indexes_full_text_indexes"/>8.6 Full text indexes</h3>
		<p>A full text index stores elements by the full text information of its element text value(s) or an attribute value.
		  Value indexes are created on either library or document level.</p>
		<p>There are three main differences with value indexes:
			<ul>
				<li><p>Value indexes can be used to get elements by their complete value, with full text indexes you can search for individual words of the value.</p></li>
				<li><p>Besides looking for individual words, full text indexes can be used in more complex boolean and wildcard queries (unlike value indexes, where you can only look for a complete text match).</p></li>
				<li><p>Value indexes can only index elements with exactly one text-node child, with full text indexes you can optionally index all the underlying text of an element (including the text of sub-elements).</p></li>
			</ul>
			Thus, full text indexes are more versatile than value indexes. This versatility comes with a price: full text indexes are slower (especially during updates) than value indexes.
		</p>
    <p>There are a number of index options specifically for full text indexes:
			<ul>
				<li><p>
				  <code>FTI_GET_ALL_TEXT</code>, The element is indexed by its string value, which is computed from the string value of all descendant nodes. 
				  If not set, the element can only have text-child nodes, but will result in faster index updates.
				</p></li>
				<li><p>
				  <code>FTI_SUPPORT_PHRASES</code>, if set the index will be optimized to perform phrase queries (at the
				  cost of a larger index).
				</p></li>
				<li><p>
				  <code>FTI_SA_ADJUST_TO_LOWERCASE</code>, if set the indexed terms will be converted to lower case, meaning
				  queries are performed case-insensitively.
				</p></li>
				<li><p>
				  <code>FTI_SA_FILTER_ENGLISH_STOP_WORDS</code>, if set words will not be indexed if they are from a list of
				  standard (English) stopwords.
				</p></li>
				<li><p>
				  <code>FTI_INCLUDE_ATTRIBUTES</code>, if set words that are part of the attribute values of the elements being
				  indexed will also be indexed. Has no effect on full text indexes placed on attributes. When this option is
				  set, you should use the <code>xhive:fts-including-attrs</code> XQuery function, otherwise use the regular
				  <code>xhive:fts</code> function.
				</p></li>
			</ul>
			For indexes, it is also possible to specify a custom <code>Analyzer</code> class, which acts as a tokenizer
			and allows for finer-grained control over the indexing process.
		</p>
		<p>Full text indexes are 'live' which means that they are automatically updated when
		 elements and/or attributes are inserted, replaced or removed.</p>
		<p>An index list can contain multiple full text indexes.</p>
		<p>Full text indexes have namespace support. Whenever namespaces are used, the documents involved
		must have been parsed with the <code>XhiveIndexIf.PARSER_NAMESPACES_ENABLED</code> option and the
		<code>elementURI</code> and/or <code>attributeURI</code> parameters must be supplied to the
		<code>addFullTextIndex()</code> method.</p>

		<div class="note"><p class="prefix"><b>Note:</b></p><p>Full text indexes are used by XQuery, specifically by the <a href="#xquery_fts" target=""><code>xhive:fts</code></a> function.</p></div>
	</div>

  <div class="div2">
    <h3><a name="indexes_context_conditioned_indexes"/>8.7 Context conditioned indexes</h3>
    <p>A context conditioned index stores <code>Node</code> objects by a user-defined key. A 
      <code>Node</code> can be an element, text node, processing instruction, comment or document. 
      Each context conditioned index has a <a href="#indexing_creating_index_node_filter" target="">user-defined index node filter</a> that is used 
      to determine which nodes should be included in the index and what key should be used.</p>
    <p>Context conditioned indexes are not automatically updated. In other words, context 
      conditioned indexes are 'non-live', and must be updated periodically, by the application 
      program.</p>
    <p>Context conditioned indexes should be used for:</p>
    <ul>
      <li>
        <p>Searching for elements by element value or attribute value while the search can not use 
          <a href="#indexes_value_indexes" target="">value indexes</a>.</p>
      </li>
      <li>
        <p>Complex queries: in certain cases a (well-defined) context conditioned index is faster 
          than its equivalent XQuery/XPath/XPointer query.</p>
      </li>
    </ul>
    <p>The three basic steps involved in creating a context conditioned index are:</p>
    <ol>
      <li>
        <p>Get a handle to the index list.</p>
      </li>
      <li>
        <p>Create an <code>XhiveCCIndexIf</code> object.</p>
      </li>
      <li>
        <p>Create an index node filter (using <code>XhiveIndexNodeFilterIf</code>) to define which 
          nodes to include and not include in the index.</p>
      </li>
    </ol>
    <p>An example of using context conditioned indexes can be found <a href="#indexes_context_conditioned_indexes" target="">here</a></p>
  </div>

  <div class="div2">
	  <h3><a name="index_performance"/>8.8 Index performance</h3>

  	<p>This chapter aims to give information on how to speed up query performance by using indexes while maintaining a reasonable data update performance.</p>
    <p>The following topics are discussed:</p> 
    <ul>
			<li><p><a href="#index_performance_scope" target="">Index scope</a>.</p></li>
			<li><p><a href="#index_performance_selectiveness" target="">Index selectiveness</a>.</p></li>
			<li><p><a href="#index_performance_sortkeys" target="">Index property: sorted keys</a>.</p></li>
			<li><p><a href="#index_performance_summary" target="">Summary</a>.</p></li>
	  </ul>   
    <p>Section <a href="#xquery_indexes" target="">"Using indexes in XQuery"</a> explains how indexes are used internally by XQuery.</p>
  
    <div class="div3">
  	  <h4><a name="index_performance_scope"/>8.8.1 Index scope</h4>
  	  <p>
  	  <nobr>X-Hive/DB</nobr> supports nested library structures. Users are free to select the scope (context) of an index. I.e. the scope of the root-library is bigger than the scope of a nested library.
  	  The smaller the scope of the live index, the less index updates will be triggered by a data update within the selected scope. Therefore the smaller the index scope, the better the performance of data updates.
  	  As the value (the number of nodes) by key is smaller, query performance is also better.
  	  </p>
  	  <p>
  	  The scope of library indexes is of no importance as library indexes only apply to the direct children of the library.
  	  </p>
  	</div>
  	
  	<div class="div3">
  	  <h4><a name="index_performance_selectiveness"/>8.8.2 Index selectiveness</h4>
      <p>
        In general, indexes provide the best query and update performance when the index is as
        'selective' as possible. In other words: each key must have the smallest possible number of
        nodes.
      </p>
  	  <p>
  	  As library indexes have unique names and id's, both library name and id indexes have optimal selectiveness and therefore have excellent query- and update behaviour.
  	  Next to library indexes, especially value indexes and id attribute indexes are fit to serve as selective indexes. Element name indexes are usually not very selective: most documents do not have unique element names.
  	  To maintain a good data update performance, users are advised to use selected element name indexes instead of the default element name indexes as selected element names only index a subset of all elements.
  	  </p>
    </div>
    
    <div class="div3">
      <h4><a name="index_performance_sortkeys"/>8.8.3 Index property: sorted keys</h4>
      <p>
      An index with property <code>XhiveIndexIf.KEY_SORTED</code> maintains its keys sorted.
      Indexes with sorted keys may need more time to update than indexes without sorted keys.
      By default, indexes do not keep their keys sorted.  Sorted keys are necessary to use the index
      for inequality queries in XQuery.
      </p>
    </div>
    
    <div class="div3">
      <h4><a name="index_performance_summary"/>8.8.4 Summary</h4>
      <p>Follow these rules to achieve the best index performance:
      <ul>
        <li><p>Do not add more indexes than required</p></li>
        <li><p><a href="#index_performance_scope" target="">Reduce the scope of the index as much as possible</a></p></li>
        <li><p><a href="#index_performance_selectiveness" target="">Make the index as selective as possible</a></p></li>
        <li><p>Use selected element name indexes instead of default element name
        indexes</p></li>
        <li>
          <p>
            Create indexes after loading the data
          </p>
        </li>
      </ul>
   		</p>
    </div>
    
  </div>
  <div class="div2">
    <h3><a name="indexes_concurrent"/>8.9 Concurrent indexes</h3>
    <p>Indexes can be specified as concurrent, using the <code>XhiveIndexIf.CONCURRENT</code> flag 
      when creating the index. Concurrent indexes are not locked for the duration of the 
      transaction when accessed or modified. Only the pages actually used are latched, and only for 
      the time that they are actually read or modified. This improves concurrency at the expense of 
      some extra overhead when using the indexes. Whether the net effect is beneficial will depend 
      on your application. There are a few things to beware of when using concurrent indexes:</p>
    <ul>
      <li>
        <p>When using the <code>XhiveIndexIf.getKeys()</code> method, the index may return keys 
          that have no nodes. If you only use indexes from within XQuery, this is not an issue.</p>
      </li>
      <li>
        <p>Uniqueness checking is not implemented for concurrent indexes. The extra locking 
          required to ensure uniqueness would defeat the main purpose of concurrent indexes. 
          (Simply checking that a key is not present is not sufficient, because its removal may 
          not yet have been committed and could still be rolled back.)</p>
      </li>
      <li>
        <p>Concurrent indexes do not provide phantom protection. If you read from the index a 
          second time during the same transaction, new keys and nodes that have been committed 
          since the previous lookup may appear. (Keys and nodes read can never disappear, because 
          the actual data read is still read locked for the duration of the transaction.)</p>
      </li>
      <li>
        <p>Concurrent indexes do not have a separate authority value. The 
          <code>XhiveIndexIf.getAuthority()</code> method will return the authority of the 
          owning library child.</p>
      </li>
    </ul>
  </div>
</div>

	
<div class="div1">
  <h2><a name="catalog"/>9 Using validation and the Catalog</h2>
  <p>This chapter gives some background on working with XML Schemas and DTDs in <nobr>X-Hive/DB</nobr>.</p>

  <div class="div2">
    <h3><a name="catalog_introduction"/>9.1 Introduction</h3>
    <p>
      In <nobr>X-Hive/DB</nobr> libraries, XML documents (as well as sub-libraries and BLOBs) can be stored.
      XML documents can have a DTD (document type definition) or an XML Schema attached to it
      which can be used to validate the document.
    </p>
    <p>
      DTDs and XML Schemas are also accessible from the catalog, as <code>ASModel</code> objects. This section does
      not deal with using <code>ASModel</code> objects, there is
      <a href="#use_as_models" target="">another section</a>
      that gives information on that.
    </p>
    <p>
      In this section, it is explained how you can get information in and out of the catalog,
      and how the catalog is used in combination with documents, during parsing and validation.
    </p>
    <p>
      In the rest of this section, DTDs and XML Schemas are referred to as 'models'.
    </p>
  </div>

  <div class="div2">
    <h3><a name="catalog_content"/>9.2 Catalog content</h3>
    <div class="div3">
      <h4><a name="catalog_location"/>9.2.1 Calalog location</h4>
      <p>
        A catalog is linked to a library. By default, only the root-library has a catalog, and all models
        would be stored there. However, it is also possible to place a catalog on a sub-library, and in
        this way you can split your models over multiple catalogs.
        Those catalogs on sub-libraries are so-called local catalog, and are created by calling <code>addLocalCatalog</code> on a
        library. When adding local catalogs, they override information in the root-catalog. What this
        means is that when information in the catalog is looked up, it will first look
        in the local catalog, but if nothing could be found there, it will look up to higher
        level catalogs. This also works the other way around. You can put a model with a certain
        <a href="#catalog_model_identification" target="">id</a> in the root-library that is used in all libraries.
        But if you add a local catalog to some sub-library and put a model with the same
        <a href="#catalog_model_identification" target="">id</a> in it that one will be used for documents in that sub-library,
        and possible descendant libraries of that library.
      </p>

    </div>
    <div class="div3">
      <h4><a name="catalog_model_identification"/>9.2.2 Identification of XML Schema and DTD models</h4>
      <p>
        Each model in a catalog has a unique id. The id depends on the schema type of the model:
        <ul>
          <li>
            <p>
              A DTD model is identified by its public id. This
              id is a string and can be more or less picked at random. If you do not set
              a public id on a DTD itself, <nobr>X-Hive/DB</nobr> will automatically generate one for it
              when required.
            </p>
          </li>
          <li>
            <p>
              An XML schema is identified by its filename.
            </p>
          </li>
        </ul>
      </p>
    </div>

    <div class="div3">
      <h4><a name="catalog_managing_models"/>9.2.3 Managing models</h4>
      <p>
        DTDs and XML schemas stored in the catalog are accessible as <code>ASModel</code> objects. That interface is
      part of the DOM <a href="#use_as_models" target="">Abstract Schema</a> specification. It provides several interfaces
        for functionality like access to model information, guided document editing, parsing and serialization.
      </p>
      <p>
        Documents with a DTD can have internal subsets, which means there is a document
        type declaration along with DTD declarations in the document itself. When parsed with
        validation, that internal subset is stored and available as an <code>ASModel</code>,
        but the internal subset is not stored in the catalog. It is only available on the
        document itself.
      </p>
      <p>A document with a DTD has at most one external <code>ASModel</code> object. A document with an XML schema can have multiple
        <code>ASModel</code> objects as each schema document is represented by a separate <code>ASModel</code>.
      </p>

      <p>
        You can add models to a catalog in two ways:
        <ul>
          <li><p>
            Explicitly, by parsing a model onto it. There
            is a code sample for this in the <a href="#use_as_models" target="">Abstract Schema</a> section.
          </p></li>
          <li><p>
            Implicitly, when you <a href="#catalog_validated_parsing" target="">parse a document with validation</a> enabled,
            the model linked to the document will automatically be stored in the catalog.
          </p></li>
        </ul>
      </p>

      <p>
        On a catalog, you can set a default DTD (through its <code>ASModel</code>).
        This default is only used <a href="#catalog_validated_parsing_dtd" target="">during parsing</a>.
        It is not possible to set a default XML Schema.
      </p>
    </div>
    <p class="prefix"><b>See also:</b></p>
	  <div class="refheader"><b>API documentation:</b></div><div class="ref2apis">
	    <a href="../apidocs/com/xhive/dom/interfaces/XhiveLibraryIf.html">com.xhive.dom.interfaces.XhiveLibraryIf</a><br/>
		  <a href="../apidocs/com/xhive/dom/interfaces/XhiveCatalogIf.html">com.xhive.dom.interfaces.XhiveCatalogIf</a><br/>
		  <a href="../apidocs/org/w3c/dom/as/ASModel.html">org.w3c.dom.as.ASModel</a><br/>
		</div><br/>
	 
  </div>

  <div class="div2">
    <h3><a name="catalog_documents_link"/>9.3 Linking models to documents</h3>
    <p>
      When accessing schema information of a document (i.e. by the validator), <nobr>X-Hive/DB</nobr> will automatically try to find
      the correct model for it in the catalog of the library where the document is (to be) stored.
      This section explains how models can be linked to documents in <nobr>X-Hive/DB</nobr>.
    </p>

    <div class="div3">
      <h4><a name="catalog_link_to_dtd"/>9.3.1 DTDs</h4>
      <p>
        If a document in <nobr>X-Hive/DB</nobr> has a document type declaration, it may have
        a DTD in the catalog linked to it.
        An example of a document type declaration is
        <div class="eg"><pre>&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "svg10.dtd]"&gt;</pre></div>
        Here the document type declaration has both a public id (<code>-//W3C//DTD SVG 1.0//EN</code>)
        and a system id (<code>svg10.dtd</code>).
      </p>
      <p>
        When you <a href="#use_as_models" target="">get the active
        <code>ASModel</code></a> of a document, it will look up the <code>ASModel</code> representing the model
        by looking it up by its <a href="#catalog_model_identification" target="">id</a>, in all catalogs up the hierarchy until
        the root-library is encountered.
      </p>
      <p>
        You can <a href="#use_as_models" target="">set the active <code>ASModel</code></a> using Abstract Schema. What
        happens then effectively is that a document type declaration is introduced in the document if it does
        not exist yet, and the <a href="#catalog_model_identification" target="">id</a> is set to the id of the <code>ASModel</code>.
        This is one way to change what model is linked to a document. You can also replace the model in the catalog and
        assign the <a href="#catalog_model_identification" target="">id</a> to the new model. It then becomes the model for all
        documents that refer to that id.
      </p>
    </div>
    <div class="div3">
      <h4><a name="catalog_link_to_schema"/>9.3.2 XML Schema</h4>
      <p>
        The link from a document to its XML schema can be specified in two ways:
        <ul>
          <li>
            <p>
              By the schema location attribute on the document element.
              An example is:
              <div class="eg"><pre>
&lt;personnel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                     xsi:noNamespaceSchemaLocation='personal.xsd'&gt;
              </pre></div>
            </p>
          </li>
          <li>
            <p>
              By the schema location parameter in the document configuration as shown in the
              <a href="#Revalidation_document_schema" target="">Revalidation</a> sample.
            </p>
          </li>
        </ul>
      </p>
      <p>
        A document with XML schema may have more than one active model attached to it. 
        For documents with XML schema, linked models can be changed by setting the schema-location parameter
        in the document configuration settings. It is also possible to use <code>setActiveASModel</code> and
        <code>addAS</code> from <a href="#use_as_models" target="">abstract schema</a> for this. These functions also modify
        the schema-location parameter value.
      </p>
      <p>
        After validation (or validated parsing), the string concatenation of the
        <a href="#catalog_model_identification" target="">ids</a> of all
        <code>ASModel</code>s used are stored on the document. This string is used to identify the <code>ASModel</code>s
        for validation or access to the PSVI interfaces.
        The document configuration parameter "xhive-schema-ids" shows the value of this string.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="catalog_validated_parsing"/>9.4 Validated parsing</h3>

    <p>
      If you parse with validation and the models used are not found in the catalog, the models are stored
      automatically in the catalog. If you do not parse with validation, no models are stored in the catalog.
      We have added <a href="#dom_configuration_additions" target="">options</a> that allow storing of the model
      (and/ or internal subset) without validation or to validate without model storage.
    </p>
    <p>
      As model resolution is handled in different ways for DTD and XML schema models, they are handled separately.
    </p>
    <div class="div3">
      <h4><a name="catalog_validated_parsing_dtd"/>9.4.1 DTDs</h4>
      <p>
        When parsing with validation, the following steps are executed when a document type declaration is encountered:
        <ol>
          <li><p>If the document type declaration has a public id, this id is used to identify the <code>ASModel</code> to validate against.</p></li>
          <li><p>If no public id was specified, or if no DTD with that public id can be found, it is checked whether a default DTD is specified. If it is, it will use that one to validate against.</p></li>
          <li><p>If no DTD was found through the two methods above, the DTD specified by the system id will be read from the file-system to be validated against.</p>
          <p>Besides that, the DTD will also be stored in the first local catalog encountered (when going up to the root-library). If a public id was specified, that one is used, otherwise one is generated by <nobr>X-Hive/DB</nobr>.</p></li>
        </ol>
      </p>
      <p>
        The third step in the above parsing scenario holds some important information for documents with DTD.
        If you do not have a public id in the document type declaration of your documents, a DTD will be stored for each
        document that you parse with validation, even if they all point to a DTD with the same system id. This is because
        we cannot be sure that the system id really refers to the DTD stored in the catalog.
        To prevent this, without modifying your input files, you should load the DTD beforehand, and set the resulting
        <code>ASModel</code> as the default model, to be used when no DTD could be found through public id resolution.
      </p>

    </div>
    <div class="div3">
      <h4><a name="catalog_validated_parsing_schema"/>9.4.2 XML Schema</h4>
      <p>
        When parsing with validation, the following scenario is followed to identify the XML schema models:
        <ol>
          <li>
            <p>
              If the document is parsed by using the <code>LSParser</code> interface and a schema-location is
              specified in the <code>LSParser</code> configurations settings, the <code>ASModel</code> defined by
              this setting is used for validation. This schema-location is also set in the configuration settings of
              the document.
            </p>
          </li>
          <li>
            <p>
              If one of the XML schema instance attributes "noNamespaceSchemaLocation" or "schemaLocation" is set,
              the corresponding <code>ASModel</code> is used for validation.
            </p>
          </li>
        </ol>
      </p>
      <p>
        A Model defined by configuration parameter schema-location overrides a model defined by the schema location
        attributes of the document if both models have the same target namespace.
      </p>
    </div>

  </div>
  <div class="div2">
    <h3><a name="catalog_validation"/>9.5 Validation</h3>
    <p>
      A Document stored in <nobr>X-Hive/DB</nobr> can by (re)validated against its model.
      The validation of documents with XML schema is handled differently from validation of documents with DTD.
    </p>

    <div class="div3">
      <h4><a name="catalog_validation_DTD"/>9.5.1 DTDs</h4>
      <p>
        The validator uses the <code>ASModel</code> defined by the PUBLIC id of the document.
        If the corresponding document is not found in the catalog, validation fails.
        Validation of a document with DTD can be executed by using the <a href="#use_as_models" target="">AS</a> interfaces.
      </p>
    </div>
    <div class="div3">
      <h4><a name="catalog_validation_schema"/>9.5.2 XML Schema</h4>
      <p>
        The XML schema validation process can be influenced by the <a href="#dom_configuration" target="">configuration</a>
        settings of the document.
        Validation of the document is handled as shown in
        <a href="#Revalidation_document_schema" target="">Revalidate documents with XML schema</a>.
      </p>
      <p>
        The validator tries to find the ASModel(s) of the document in the order as shown below.
        If a model is found, the model is used for validation.
        <ol>
          <li>
            <p>
              The <code>"schema-location"</code> parameter in the configuration settings of the document.
            </p>
          </li>
          <li>
            <p>
              The attributes of the XML schema instance attributes "noNamespaceSchemaLocation" or
              "schemaLocation" specified in the document.
            </p>
          </li>
        </ol>
        A Model defined by configuration parameter schema-location overrides a model defined by the schema location
        attributes of the document if both models have the same target namespace.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="catalog_PSVI"/>9.6 PSVI</h3>
    <p>
      <nobr>X-Hive/DB</nobr> supports <a href="http://www.w3.org/TR/xmlschema-2/" target="_new">XML Schema data types</a>.
      This enables the <a href="#xquery_type" target="">use of data types by XQuery queries</a>.
      Furthermore, <nobr>X-Hive/DB</nobr> supports the <a href="http://xml.apache.org/xerces2-j/faq-xs.html#faq-3" target="_new">
      Xerces XML Schema API</a> that provides access to the Post Schema
      Validation Infoset (PSVI) and <a href="http://www.w3.org/TR/xmlschema-1/" target="_new">XML Schema model information</a>.
      This api is not yet submitted to W3C. Users should be aware that interfaces may change in the future.
    </p>
    <p>
      The XML Schema API can be used to traverse XML schema components like type definitions, element declarations and
      schema constraints.
      In addition to the schema information, psvi information of each individual node can be accessed like validity,
      validation context, normalized value, typedefinition and member type definition as shown in
      <a href="#use_psvi_interfaces" target="">Access PSVI information</a>.
    </p>
    <p>
      Nodes storing state information need more diskspace. Users can set a configuration option
      <a href="#dom_configuration" target=""><code>"xhive-psvi"</code></a> to enable storage of psvi information.
      If this option is not set, queries will not support data types and the XML Schema API is
      only partially accessible. I.e. no validity information of a node is available.
    </p>
    <p>
      When accessing schema information of a document by using the XML Schema API, the corresponding <code>ASModel</code>s
      are identified by the value of the <a href="#dom_configuration" target=""><code>"xhive-schema-ids"</code></a>
      configuration setting. This value shows the schema ids corresponding to information stored by the
      configuration schema-location parameter and schema-location attributes. If possible, the
      xhive-schema-ids value excludes the schema locations of the attributes that are overruled by the schema-location
      value.
    </p>
  </div>

</div>

    

<div class="div1">
  <h2><a name="performance"/>10 Performance</h2>
  <p>
    This chapter gives some tips on getting the best performance out of <nobr>X-Hive/DB</nobr>.  For XQuery query
    performance, see also the <a href="#xquery" target="">chapter on XQuery</a>.
  </p>
  <div class="div2">
    <h3><a name="internal_server"/>10.1 Internal server</h3>
    <p>
      Usually the easiest and most effective way of speeding up your <nobr>X-Hive/DB</nobr> application is to run
      the <nobr>X-Hive/DB</nobr> server in the same JVM as your application.  Instead of client/server
      communication over TCP/IP, all requests are done as simple method calls, which are much
      faster.  Additionally, the system will not use a separate client and server cache, which
      allows you to use more RAM for the single cache.
    </p>
    <p>
      Because only one server can be running for a specific federation, using an internal server is
      only possible if your application architecture allows it.  If you have many users running a
      client application that uses <nobr>X-Hive/DB</nobr> directly, you cannot use a server in the client.
      However, in many application architectures all database accesses are done from a single
      application server.  In these cases, using an internal server will not only speed up database
      calls, it will also simplify application deployment.
    </p>
    <p>
      An internal server can also function as a server for remote clients.  If you run an internal
      <nobr>X-Hive/DB</nobr> server within your application server, you can still connect to it with the
      administrator client, a data loading utility, the XHBackup tool, etc.  To set this up, your
      main application has to contain code like this:

      <div class="eg"><pre>
XhiveDriverIf driver = XhiveDriverFactory.getDriver();
driver.init(cachePages);
int port = ...;
ServerSocket socket = new ServerSocket(port);
driver.startListenerThread(socket);
</pre></div>

      The main application has to use the filename of the bootstrap file as the
      <code>xhive.bootstrap</code> property or as an argument to
      <code>XhiveDriverFactory.getDriver()</code>.  This will make it run the <nobr>X-Hive/DB</nobr> server
      internally.  All other applications use an URL of the form
      <code>xhive://</code><var>host</var><code>:</code><var>port</var> to connect to the server
      that runs in your application.
    </p>
    <p>
      If you want to use the same internal <nobr>X-Hive/DB</nobr> server from different applications in the same
      application server, you should make sure that both applications use the same Java class loader
      to load the <nobr>X-Hive/DB</nobr> classes.  Otherwise, the <nobr>X-Hive/DB</nobr> code loaded by each class loader will
      attempt to start its own <nobr>X-Hive/DB</nobr> server and all but the first one will fail.
    </p>
  </div>
  <div class="div2">
    <h3><a name="database_page_size"/>10.2 Database page size</h3>
    <p>
      When creating a federation, you need to specify a page size for the database pages.  This
      should be a power of 2 from 512 to 65536. In most cases, the best page size to use is the
      same page size that the filesystem uses (see below).
    </p>
    <p>
      Each document and blob will use an integral number of pages.  If you expect to have many small
      documents, it may be useful to choose a database page size that is smaller than the filesystem
      page size.  This saves disk space.  The disadvantage is that if <nobr>X-Hive/DB</nobr> writes a database
      page, the operating system will have to retrieve the old filesystem page, copy the database
      page into the filesystem page and write back the whole filesystem page.  When a database page
      equals a filesystem page, retrieving the old filesystem page is not necessary.
    </p>
    <p>
      Choosing a database page size that is bigger than the filesystem page size is not advisable,
      because then file-writes are no longer atomic. In the event of an operating system crash, 
      a database page may be written to the disk in part, which can cause that page, and thus perhaps 
      the entire database, to become inaccessible.
    </p>
    <p>
      On Solaris, the filesystem block size is usually 8192 bytes, on MS Windows
      (with a default NTFS filesystem) and on Linux this is usually 4096. These defaults 
      can be overriden though. To find out the page size of a filesystem on 
      which you are going to deploy database files, you can:
      <ul>
        <li><p>
        On Windows 2000, run <code>chkdsk c:</code>, to find out the size of an allocation
        unit (this command will also check the file system, so may take some time to run).
        </p></li>
        <li><p>
        On Windows XP, run <code>fsutil fsinfo ntfsinfo c:</code> (one command), to find 
        out the number of bytes per cluster.
        </p></li>
        <li><p>
        On Linux, run <code>tune2fs -l /dev/device</code>, to find out with what block size 
        the filesystem was created. You need to be root
        to run this command. You can run <code>mount</code> to find the mapping 
        between devices and logical mount points.<br/>
        </p></li>
        <li><p>
        On Solaris or HP-UX, run <code>mkfs -m /dev/device</code>, to find
        out with what blocksize (bsize) the filesystem was created. You need to be root
        to run this command. You can run <code>mount</code> to find the mapping 
        between devices and logical mount points.<br/>
        This command may also work on other Unix-variants, but use with care as
        <code>mkfs</code> is also used to create new filesystems.
        </p></li>
      </ul>
    </p>
  </div>
  <div class="div2">
    <h3><a name="multiple_disks"/>10.3 Multiple disks</h3>
    <p>
      If you have multiple physical disks available, you should put the log directory on a separate
      disk.  Writes to the federation log are usually more performance critical than writes to the
      database files, because a committing transaction has to wait until its log records have been
      flushed to the disk before it can continue.  Unless the cache has too many dirty pages in it,
      writes to database files happen asynchronously from a background thread.
    </p>
    <p>
      If you have multiple disks for the actual data, the easiest and most effective way of
      spreading the disk access load is to use hardware or software to put the disks in a RAID 0 or
      RAID 1+0 configuration.
    </p>
  </div>
  <div class="div2">
    <h3><a name="disk_write_caches"/>10.4 Disk write caches</h3>
    <p>
      Some hard disk drives have internal write caches that can be enabled to tell the operating
      system that a write to the disk has succeeded, even though the data is not yet physically on
      the disk.  Although enabling such a disk cache can speed up transaction commit, we strongly
      advise against doing so.  If you enable such a cache and your computer crashes (e.g., due to a
      power failure) data may be lost, which could corrupt your federation.
    </p>
    <p>
      Of course, if the drive contains a backup battery to guarantee that confirmed writes are
      always written to the physical disk even on a power failure, it is ok to enable this.
    </p>
  </div>
</div>

	

<div class="div1">
	<h2><a name="internal_structure"/>11 Internal structure of <nobr>X-Hive/DB</nobr></h2>
	<p>This chapter describes the internal architecture of <nobr>X-Hive/DB</nobr></p>
  <div class="note"><p class="prefix"><b>Note:</b></p>The information in this chapter is only applicable to the latest version of <nobr>X-Hive/DB</nobr>. Similar information about databases created with older versions of <nobr>X-Hive/DB</nobr> can be found in their respective manuals.</div>
  <div class="div2">
    <h3><a name="internal_architecture"/>11.1 Segments and files</h3>
    <div class="div3">
      <h4><a name="database_segments"/>11.1.1 Segments</h4>
      <p>
        A database consists of a number of segments. A segment is a locical storage location within
        an <nobr>X-Hive</nobr> database. Each database always has at least one segment, the default segment. The
        default segment can never be deleted without deleting the database. Segments can be added
        and deleted (when empty) programmatically using the <nobr>X-Hive</nobr> API.
      </p>
      <p>
        You can specify in which segment data is stored.  By default, all data is stored in the
        default segment.  Data will never be automatically stored in another segment, even if the
        current segment is full.  If you want automatic overflow, use a single segment with multiple
        files.  You can specify the segment for temporary data using the
        <code>XhiveDatabaseIf.setTemporaryDataSegment()</code> method.  You can specify the segment
        to store all children (documents, sublibraries, blobs) of a specific library in using the
        <code>XhiveLibraryIf.setChildSegmentId()</code> method.
      </p>
    </div>
    <div class="div3">
      <h4><a name="database_files"/>11.1.2 Files</h4>
      <p>
        A segment can be spread physically over multiple files. A segment always has at least one
        file, the default file. The default file can never be deleted without deleting its owner
        segment. Files can be added using the adminclient and programmatically using the <nobr>X-Hive</nobr> API.
      </p>
      <p>
        If no <nobr>X-Hive/DB</nobr> code is running, it is safe to move database files to a new location and
        manually edit the paths in the bootstrap file.  You should never edit the bootstrap file
        while an <nobr>X-Hive/DB</nobr> server is running for that federation.  You should also never change the
        file ids in the bootstrap file.  If you have moved database files, you should not create an
        incremental backup without creating a full backup first.  While creating such an incremental
        backup will seem to succeed, you will lose data when the backup is restored.
      </p>
      <p>
        A file consists of a number of pages.  The pagesize is set when creating the federation.
        You can limit the maximum size of a file.  If the file has reached this maximum size,
        further allocation in the segment will happen in the next file of the segment.  If all the
        files in the segment have reached their maximum size, any further allocation in the segment
        will fail.  There is no way to control or check in which file of a segment data is stored,
        different pages of single document can be stored in different files.  If you need control
        over the location of data, use different segments.
      </p>
      <div class="note"><p class="prefix"><b>Note:</b></p>
        If a file has a maximum size limit of 0 (meaning unlimited), the next file of the segment
        will never be used, not even if the disk containing the first file is full.  Unfortunately,
        the only reliable way of detecting a full disk is actually writing the (still empty) page to
        the file while allocating the page.  We consider this too expensive.
      </div>
      <div class="note"><p class="prefix"><b>Note:</b></p>
        Sometimes <nobr>X-Hive/DB</nobr> has to allocate pages for internal page allocation administration.  At
        those times, the maximum file size limit is not heeded.  This is because the allocation
        administration is required and there is no way to continue and keep the data consistent
        without allocating this space.  Therefore, a file can become slightly larger than the limit
        set by the administrator.
      </div>
    </div>
		<div class="div3">
			<h4><a name="database_configurations"/>11.1.3 Setting up database configurations</h4>
			<p>Configurations can be set up in three ways:</p>
      <ul>
        <li><p>Using the admin client. You can use the admin client to create or delete segments and or files, and change default cluster rules.</p></li>
        <li><p>Using the API. You can also use the API to create or delete segments and or files, and change default cluster rules.</p></li>
        <li><p>Using a configuration file when creating a database. The configuration file can be used to specify an initial database configuration. The configuration can be specified when creating a database using the adminclient, the command line tool or the API.</p></li>
      </ul>
      <p>The default configuration (the one used when using the admin client and specifying the default configuration, or when using the command line tool or API and not supplying a custom configuration file), has the following parameters:</p>
      <ul>
        <li><p>The database has a single segment with a single file.</p></li>
        <li><p>All data is clustered in the default segment.</p></li>
      </ul>
      <p>
        As indicated before, these settings of the database can all be changed later with the API or the Administrator client.
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e11273"/>11.1.4 Log files</h4>
      <p>
        To ensure recoverability of data, <nobr>X-Hive/DB</nobr> uses the well known database technique of write
        ahead logging (WAL).  Data is first committed to the database log before being written to
        the actual database files.  Log files are written to the log directory specified when
        creating the federation and are sequentially numbered.  If the keep-log-files option of the
        federation is unset, log files that are no longer needed for recovery are automatically
        deleted.  If the option is set, log files are only deleted after creating a backup.  See
        also <a href="#incremental_backups" target="">the section on incremental backups</a>.
      </p>
      <p>
        If (and only if) no <nobr>X-Hive/DB</nobr> server is running for the federation, you can safely move the
        log files manually and edit the bootstrap file accordingly.
      </p>
    </div>
	</div>
	<div class="div2">
		<h3><a name="database_configurationfiles"/>11.2 Database configuration files</h3>
		<p>Database configuration files can be used to describe initial database configurations. They are only used when creating a database, modifications of a file do not influence existing databases. The configuration file is in XML format. This section describes the possible elements and attributes. For example, this is the configuration file for a default database:</p>

		<div class="eg"><pre>&lt;xhive-clustering&gt;
  &lt;segment id="default"/&gt;
&lt;/xhive-clustering&gt;</pre></div>

		<div class="div3">
			<h4><a name="database_xhive-clustering_elem"/>11.2.1 xhive-clustering element</h4>
      <p>Document element for the configuration file</p>
			<p>Possible child elements: <a href="#database_config_segment_elem" target="">segment</a>.</p>
	  </div>
		<div class="div3">
			<h4><a name="database_config_segment_elem"/>11.2.2 segment element</h4>
			<p>Represents a <a href="#database_segments" target="">segment</a>. For each occurence of this element a segment is created.</p>
			<p>
			  <table width="100%" border="1">
			    <caption>Attributes</caption>
			    <tbody>
			      <tr>
			        <td rowspan="1" colspan="1">Name</td>
			        <td rowspan="1" colspan="1">Use</td>
			        <td rowspan="1" colspan="1">Default</td>
			        <td rowspan="1" colspan="1">Description</td>
			      </tr>
			      <tr>
			        <td rowspan="1" colspan="1">id</td>
			        <td rowspan="1" colspan="1">Required</td>
			        <td rowspan="1" colspan="1">-</td>
			        <td rowspan="1" colspan="1">Id for the segment. Should be unique within the configuration file.</td>
			      </tr>
			      <tr>
			        <td rowspan="1" colspan="1">path</td>
			        <td rowspan="1" colspan="1">Optional</td>
			        <td rowspan="1" colspan="1">-</td>
			        <td rowspan="1" colspan="1">Path to the location where the default file should be placed. If not supplied then the default file is placed in the same directory as that of the federated database.</td>
			      </tr>
			      <tr>
			        <td rowspan="1" colspan="1">max-size</td>
			        <td rowspan="1" colspan="1">Optional</td>
			        <td rowspan="1" colspan="1">0</td>
			        <td rowspan="1" colspan="1">Maximum number of bytes that are allowed in the default file.  0
			        means unlimited.</td>
			      </tr>
			      <tr>
			        <td rowspan="1" colspan="1">temporary</td>
			        <td rowspan="1" colspan="1">Optional</td>
			        <td rowspan="1" colspan="1">false</td>
			        <td rowspan="1" colspan="1">Whether this segment is a temporary data segment.</td>
			      </tr>
			    </tbody>
			  </table>
			</p>
			<p>Possible child elements: <a href="#database_file_elem" target="">file</a></p>
    </div>
		<div class="div3">
			<h4><a name="database_file_elem"/>11.2.3 file element</h4>
			<p>Represents a <a href="#database_files" target="">file</a>. For each occurence of this element a file is created.</p>
			<p>
			  <table width="100%" border="1">
			    <caption>Attributes</caption>
			    <tbody>
			      <tr>
			        <td rowspan="1" colspan="1">Name</td>
			        <td rowspan="1" colspan="1">Use</td>
			        <td rowspan="1" colspan="1">Default</td>
			        <td rowspan="1" colspan="1">Description</td>
			      </tr>
			      <tr>
			        <td rowspan="1" colspan="1">path</td>
			        <td rowspan="1" colspan="1">Optional</td>
			        <td rowspan="1" colspan="1">-</td>
			        <td rowspan="1" colspan="1">Path to the location where the file should be placed. If not supplied then the file is placed in the same directory as that of the federated database.</td>
			      </tr>
			      <tr>
			        <td rowspan="1" colspan="1">max-size</td>
			        <td rowspan="1" colspan="1">Optional</td>
			        <td rowspan="1" colspan="1">0</td>
			        <td rowspan="1" colspan="1">Maximum number of bytes that are allowed to be created in the
			        file.  0 means unlimited.</td>
			      </tr>
			    </tbody>
			  </table>
			</p>
    </div>
  </div>
</div>

	

<div class="div1">
  <h2><a name="administering"/>12 Administering <nobr>X-Hive/DB</nobr></h2>
  <p>
    This chapter describes administration of <nobr>X-Hive/DB</nobr>.
  </p>
  <p>
    The adminclient provides access for administrators and super users to key database functions. Using the adminclient, you can rapidly perform most tasks with <nobr>X-Hive/DB</nobr> databases, in a user friendly way. The adminclient works based on the <nobr>X-Hive/DB</nobr> API, so everything that can be done with the adminclient can also be done in a Java program with the API. In fact, the sources of the administrator client are included so you can inspect how the Adminclient uses the <nobr>X-Hive/DB</nobr> API to perform certain tasks.
  </p>
  <p>
    This chapter contains a short tutorial on how to accomplish certain tasks in the adminclient, to get an idea of its functionality.
  </p>
  <ul>
    <li><p><a href="#starting_admin" target="">Starting the adminclient</a></p></li>
    <li><p><a href="#admin_importing" target="">Importing data</a></p></li>
    <li><p><a href="#admin_export_edit" target="">Editing and exporting data</a></p></li>
    <li><p><a href="#admin_indexes" target="">Adding indexes</a></p></li>
    <li><p><a href="#admin_querying" target="">Querying with XQuery</a></p></li>
  </ul>
  <p>
    Separate from the adminclient, <nobr>X-Hive/DB</nobr> also includes a set of tools to:
    <ul>
      <li>
        <p>
          <a href="#create_federation" target="">Create a new federation</a>
        </p>
      </li>
      <li>
        <p>
          <a href="#creating_backup" target="">Create backups</a>
        </p>
      </li>
      <li>
        <p>
          <a href="#restoring_database" target="">Restore backups</a>
        </p>
      </li>
    </ul>
    There is also an advanced topic on these tools on our support website, in an article called 'Information on the database files and the utilities that operate on them'.
  </p>
  <div class="div2">
    <h3><a name="starting_admin"/>12.1 Starting the adminclient</h3>
    <p>To start the <nobr>X-Hive/DB</nobr> adminclient:</p>
      <ol>
        <li>
          <p>Execute the command <code>XHAdmin</code> in the
            <var>XhiveDir</var><code>\bin</code> directory of the installation (or, on Microsoft Windows platforms: choose that program in the start menu). This starts the <nobr>X-Hive/DB</nobr> adminclient. (note: the <code>font.properties</code> messages that this may cause on a Unix platform may be ignored)</p>
        </li>
        <li>
          <p>An alternative way to run the administrator client is to execute the command <code>xhive-ant run-admin</code> in the <var>XhiveDir</var><code>\bin</code> directory of the installation, this will compile and run the administrator client from the included sources</p>
          <p>Note, in Xhive/DB version 7.0 and higher this requires the
          <code>JAVA_HOME</code> environment variable in <code>xhive-ant</code>
          should point to a JDK 1.5
          </p>
        </li>
        <li>
          <p>Select <code>"Database-&gt;Connect"</code>. The Connect to a database window is displayed.</p>
        </li>
        <li>
          <p>Enter the database name, user name, and password for a valid user.</p>
        </li>
      </ol>
    <p>
      The adminclient is a database explorer which contains in the left part a treeview of the database information. In the right part of the database explorer details are shown off the selected node in the treeview. Most operations are accessible by right clicking on nodes in the treeview. 
    </p>
    <div class="image"><img src="images/administering/admin_main_screen.png" alt="Main administrator view"/><div class="caption">Figure 17. Main administrator view</div></div>
    <div class="note"><p class="prefix"><b>Note:</b></p>
      The status bar in the bottom right corner is a memory usage indicator, by clicking the trashcan in the right 
      corner you can force a garbage collect on the Adminclient.
    </div>
    <div class="note"><p class="prefix"><b>Note:</b></p>
      A number of preferences are automatically stored (like the last query executed and the last database connected to).
      Theses preferences are stored in a file named <code>.xhive.admin.properties</code> in your home directory (on MS Windows 2000,
      this is the directory <code>c:\Documents and Settings\username</code> by default), you may remove this file if you want
      to reset the settings of the Adminclient program.
    </div>
    <p>
      There are four main nodes in the tree:
    </p>
    <ul>
      <li>
        <p>
          The <a href="#internal_architecture" target="">Database info node</a>, for the database information such as segments, container pools and cluster rules.
        </p>
      </li>
      <li>
        <p>
          The <a href="manage_users_and_groups" target="">Groups and Users node</a>, for viewing, adding and removing users and groups that act as the basis of the authority model.
        </p>
      </li>
      <li>
        <p>
          The root-library node, the root-library is the top-level library that contains all other libraries and documents.
        </p>
        <p>
          Below the root-library, the hierarchy of libraries with their contents is presented. Besides the regular children of the
          library, there can be special types of 'folders' presented as children of the library. Folders with the letter 'C' in them
          present a (local) catalog of the library, which can hold schema-items such as DTDs and XML Schemas. Folders with the letter
          'V' in them represent version spaces, representing the versioning information of a versioned document in that library. Documents
          in a library that are versioned have a small 'v' letter in the bottom right corner of their pictogram. In the example below,
          the 'V' folder 'briefing.xml' holds the version information of the versioned document 'briefing.xml'.
        </p>
        <div class="image"><img src="images/administering/admin_library_example.png" alt="Library contents example"/><div class="caption">Figure 18. Library contents example</div></div>
      </li>
    </ul>
    <p>
      You can right-click on items in the tree to execute actions on them. For categories of information (e.g. users or libraries) such an action could be to add a new item of that category. For specific items in the tree (e.g. a specific user) you will find actions to change their properties in the right-click menu.
    </p>
    <p>
      There are a couple of actions that are not accessible through the right-click menus of the various nodes in the database treeview, but are in the regular menu of the adminclient window:
    </p>
    <ul>
      <li><p>Creating and deleting databases (in the create database dialog, a default <a href="#internal_architecture" target="">configuration</a> will work for most applications).</p></li>
      <li><p>Change the superuser password (in the settings menu).</p></li>
      <li><p>Enter a new license key (in the settings menu).</p></li>
    </ul>
    <p>
      The rest of the adminclient sections of below deal with some common tasks.
    </p>
  </div>
  <div class="div2">
    <h3><a name="admin_importing"/>12.2 Importing data</h3>
    <p>
      One of the principle functions is to import XML documents into the database. Importing is done
      through the 'Import' menu-item in the right-click menu of library-nodes (the selected library will also
      becomes the target of the imported data). 
    </p>
    <p>
      The basics of importing are very simple. Through the add button you can add (multiple) files
      and directories, and by clicking 'Okay' that data will be imported into the database. By default,
      a sub directory structure of an imported library wil be recreated in the database.
    </p>
    <div class="image"><img src="images/administering/admin_import_basic.png" alt="Main import dialog"/><div class="caption">Figure 19. Main import dialog</div></div>
    <p>
      However, there are a lot of different options in the import dialog that have a serious influence
      on the way data is imported. The options can be divided into three groups:
      <ul>
        <li><p>
          Below the list of items to be imported, there are some options that influence how the importer
          treats those documents that are loaded, mostly concerning where documents are (re-)placed, and
          how libraries are created. For instance, with the 'Flatten library structure' all data imported
          from a directory will be placed directly in the target library.
        </p></li>
        <li><p>
          In the screenshot above, you can see some error messages regarding filters. If the messages would
          not be resolved, the file <code>ship.svg</code> would simply be skipped. The reason is the adminclient
          importer uses filters to determine how each file is stored, and by default only filters for files
          with the extension <code>xml</code> and <code>xsl</code> are defined. The rationale for this is that:
          <ul>
            <li><p>Not every file encountered in processing in for instance a directory being imported 
            needs to be an XML document.</p></li>
            <li><p>A file need not be stored in <nobr>X-Hive/DB</nobr> as an XML document, specifically you can store
            non-XML data as BLOBs, and schema-related files (DTDs and XML Schema's) as schema models
            in the <a href="#catalog" target="">catalog</a>.</p></li>
          </ul>
          Therefore, filename matching filters can be defined in the filters tab of the import dialog. When
          an import is run, it will try to match filenames against the wildcard patterns of the adminclient, in
          the order in which they are specified. If no matching pattern is found, the file is ignored.
          </p>
          <p>Filters are stored in the preferences of the adminclient, so you only need to define them once.
        </p></li>
        <li><p>
          There is also a 'Parser configuration' tab, which holds the parser options used. There you can specify
          whether to use validation, what information items of the original file to preserve in the parsed
          <code>Document</code>, and other properties.
          These are the
          properties that can also be set on the <code>DOMConfiguration</code> object of the 
          <code>LSParser</code> (see the javadoc links in the
          <a href="#dom_configuration" target="">DOMConfiguration</a> section for more information on the semantics
          of the options). Unlike the filters, the configuration options are not stored in the preferences
          (some sensible defaults are chosen).
        </p></li>
      </ul>
    </p>
  </div>
  
  <div class="div2">
    <h3><a name="admin_export_edit"/>12.3 Exporting and editing documents</h3>
    <div class="image"><img src="images/administering/admin_document_menu.png" alt="The right-click menu of a document"/><div class="caption">Figure 20. The right-click menu of a document</div></div>
    <p>
      Just as information can be imported into the database, it can be exported. Exporting is done
      through the 'Export' menu-item in the right-click menu of library, BLOB and document-nodes. You can
      select where the exported files must be placed (libraries will lead to directory creation), along
      with several <code>DOMConfiguration</code> options.
    </p>
    <p>
      You can also edit the documents in the database directly, in two ways. When you browse the document
      through the 'Browse document' menu-item in the right-click menu of documents, you can browse the document
      as a tree. This is very useful for very large documents, you can edit or delete inidividual nodes
      of the document. For relatively small documents, it is easier to use the 'Edit as text' menu-item in the 
      right-click menu of documents to make changes in a document.
    </p>
    <p>
      For <a href="#use_versioning" target="">versioned</a> documents, edits must be performed in a different way
      because versioned documents are read-only. You must use the 'Checkout/Edit/Checkin' menu-item on a version
      in a version-space to make changes, from a versioned document you can easily go to the right version
      in the version space folder by using the 'Go to version space' menu-item in the right-click menu of 
      documents.
    </p>
  </div>

  <div class="div2">
    <h3><a name="admin_indexes"/>12.4 Adding Indexes</h3>
    <div class="image"><img src="images/administering/admin_index_add.png" alt="Adding an index dialog"/><div class="caption">Figure 21. Adding an index dialog</div></div>
    <p>
      For libraries (it is also possible for documents but that is less common), the right panel of the
      adminclient holds an 'Indexes' tab, where the list of <a href="#indexes" target="">indexes</a> for the 
      library can be viewed and changed. The indexes will create and maintain an index for all the data
      contained within (the sub-libraries) of a library.
    </p>
  </div>

  <div class="div2">
    <h3><a name="admin_querying"/>12.5 Querying</h3>
    <div class="image"><img src="images/administering/admin_xquery.png" alt="XQuery dialog"/><div class="caption">Figure 22. XQuery dialog</div></div>
    <p>
      <nobr>X-Hive/DB</nobr> has multiple querying mechanisms, but the most important one is XQuery (we do not have XPath
      support in the Adminclient anymore, because we want to promote XQuery usage). On libraries and documents,
      the 'Execute XQuery' menu-item in the right-click menu opens an XQuery pane at the bottom of the screen.
      It is possible to open multiple of such panes, and when such panes are open it is still possible to use
      the rest of the adminclient to for instance inspect documents. Queries are executed with as context
      the library or document on which the panel was opened.
    </p>
    <p>
      The toolbar and popup menu contain a separate item called "Execute Update XQuery". The
      difference with the normal "Execute XQuery" item is that the latter uses a readonly
      transaction (which does not take locks) to execute the query, while the "Update" version uses
      a readwrite transaction. If you want to use the <a href="#xquery_updates" target=""><nobr>X-Hive/DB</nobr> XQuery
      update syntax</a> in your query you should use "Execute Update XQuery".
    </p>
    <p>
      In the XQuery panel, there are four tabs:
      <ul>
        <li>
          <p>
            The 'Query' tab allows for the entry of queries. It is possible to load and save
            queries, and the last query executed is remembered.
          </p>
          <p>
            The lowest button to the left of the input screen allows for automatic addition of
            <code>set-option</code> commands for debug output of the query engine before the
            query-text.  The screenshot above shows a query where debugging has been turned on.
          </p>
          <p>
            A query can be run with the &gt;&gt; run-button.
          </p>
        </li>
        <li>
          <p>
            The 'Result tree' tab will show the result of a query that has run in a treeview. If the
            query involves the original nodes (so not created through element constructors), they
            may be deleted from the tree (and will be deleted in the original database).
          </p>
          <p>
            While the tree is opened, a transaction is kept opened so that the treeview can be
            live. However, that also means old versions of the data are kept around. Therefore (in a
            very active federation), you may want to disable or clear the result tree tab. You can
            use the 'Do not use result tree' button for this, it causes the query transaction to be
            closed immediately after execution of the query has completed, while keeping the result
            viewable in the 'Result text' tab.
          </p>
          <p>
            This tab and the button are disabled for update queries. They are always committed
            immediately after execution.
          </p>
        </li>
        <li><p>
          The 'Result text' tab holds the result of executed queries, as serialized to text.
        </p></li>
        <li><p>
          The 'Query debug' tab will hold the debug information from the query, if the <a href="#xquery_setoption_options" target="">debug options</a>
          were set in the query. Here is an example of such output, for when an value index can be used to execute the query
          <code>//chapter[@number &lt; 3]</code> (format of actual output may change over time):
<div class="eg"><pre>Creating query plan on node /UN Charter
for expression .../descendant-or-self::node()/child::chapter[@number &lt; ...]
Looking for value index on chapter/@number (sorted) (type=INTEGER)
Found index "Value index"
Looking up "3" in index "Value index"
Using query plan:
index(Value index)</pre></div>
        </p></li>
      </ul>
    </p>
  </div>
  <div class="div2">
    <h3><a name="create_federation"/>12.6 Creating a new federation</h3>
    <p>
      When <nobr>X-Hive/DB</nobr> is installed, a federation is created automatically.  You can also create new
      federations using the <code>XhiveFederationFactoryIf</code> API or the <code>XHCreateFD</code>
      tool.  The tool has the following command line options:
      <ul>
        <li>
          <p>
            <code>-help</code> Print usage information and exit.
          </p>
        </li>
        <li>
          <p>
            <code>-verbose</code> Be extra verbose.
          </p>
        </li>
        <li>
          <p>
            <code>-debug</code> Print stack trace on exception.
          </p>
        </li>
        <li>
          <p>
            <code>-version</code> Print version information and exit.
          </p>
        </li>
        <li>
          <p>
            <code>-federation &lt;value&gt;</code> Specify the path (including the filename) of the
            bootstrap file for the new federation.
          </p>
        </li>
        <li>
          <p>
            <code>-log &lt;value&gt;</code> Specify the directory to create log files in.  If this
            is a relative path, it will be interpreted relative to the directory of the bootstrap
            file.
          </p>
        </li>
        <li>
          <p>
            <code>-pagesize &lt;value&gt;</code> Specify the database page size for the new
            federation.  See also <a href="#database_page_size" target="">Database page size</a>.
          </p>
        </li>
        <li>
          <p>
            <code>-passwd &lt;value&gt;</code> Specify the initial password for the superuser.
          </p>
        </li>
      </ul>
    </p>
  </div>
  <div class="div2">
    <h3><a name="creating_backup"/>12.7 Creating a backup</h3>
    <p>
      You need to backup an <nobr>X-Hive/DB</nobr> federation so that it can be restored in case of an emergency.
    </p>
    <div class="div3">
      <h4><a name="d1e11988"/>12.7.1 Online ("hot") backups</h4>
      <p>
        If any <nobr>X-Hive/DB</nobr> code is running, you cannot use regular file backup utilities to backup
        your federation.  Because the data is being modified concurrently, you could backup and
        restore an inconsistent version of the data.  You can create backups using the API or with
        the XHBackup tool that is a simple wrapper for the API.
      </p>
      <p>
        To create a backup of your federation you need the <code>backup()</code> method of
        <code>XhiveFederationIf</code>.  This sends the backup to a
        <code>java.nio.channels.WritableByteChannel</code>.
        <div class="eg"><pre>
XhiveSessionIf session = XhiveDriverFactory.getDriver().createSession();
session.connect("superuser", "password", null);
XhiveFederationIf federation = session.getFederation();
FileOutputStream out = new FileOutputStream("backupfile");
federation.backup(out.getChannel(), 0);
</pre></div>
      </p>
    </div>
    <div class="div3">
      <h4><a name="incremental_backups"/>12.7.2 Incremental backups</h4>
      <p>
        Incremental backups store only the data that has been modified since the most recent (full
        or incremental) backup.  This is done by storing the federation log in the backup file.  By
        default, any log files no longer needed for transaction rollback or recovery are
        automatically deleted.  To allow incremental backups to be created, you must first turn on
        the keep-log-files option of the federation before creating the initial full backup.  You
        can do this:
        <ul>
          <li>
            <p>With the <code>setKeepLogFiles()</code> method of <code>XhiveFederationIf</code>.</p>
          </li>
          <li>
            <p>With the adminclient.</p>
          </li>
          <li>
            <p>
              Only if no <nobr>X-Hive/DB</nobr> code is running: by editing the bootstrap file by hand.  Set the
              <code>keep-log-files</code> attribute of the <code>log</code> element to
              <code>true</code>.
            </p>
          </li>
        </ul>
        After you have set this option, obsolete log files will only be removed when a backup is
        created.  Once you have done this, incremental backups can be created using the
        <code>BACKUP_INCREMENTAL</code> option to the <code>backup</code> method or the
        <code>-incremental</code> flag to <code>XHBackup</code>.
      </p>
      <p>
        If you create a full backup, the next incremental backup will only be valid relative to that
        full backup.  There may be reasons to create a full backup without disturbing the sequence
        of incremental backups.  This is possible by creating a "standalone" backup, which does not
        affect the next incremental backup, using the <code>BACKUP_STANDALONE</code> option to the
        <code>backup</code> method or the <code>-standalone</code> flag to <code>XHBackup</code>.
        It is not possible to create an incremental backup relative to a standalone backup.
      </p>
    </div>
    <div class="div3">
      <h4><a name="xhbackup"/>12.7.3 The XHBackup tool</h4>
      <p>
        The XHBackup tool creates an online backup to a single backup file (or stdout).  To use it
        on a running server, the server has to listen for remote clients and the tool must use a
        remote bootstrap property of the format <code>xhive://host:port</code>.  It is called as

        <div class="eg"><pre>
XHBackup [options] superUserPassword
</pre></div>
        and has the following command line options:
        <ul>
          <li>
            <p>
              <code>-help</code> Print usage information and exit.
            </p>
          </li>
          <li>
            <p>
              <code>-verbose</code> Be extra verbose
            </p>
          </li>
          <li>
            <p>
              <code>-debug</code> Print stack trace on exception
            </p>
          </li>
          <li>
            <p>
              <code>-version</code> Print version information and exit
            </p>
          </li>
          <li>
            <p>
              <code>-federation &lt;value&gt;</code> Specify the bootstrap file or remote server
            </p>
          </li>
          <li>
            <p>
              <code>-file &lt;value&gt;</code> Specify the output file.  If not given, output will
              be sent to standard output.
            </p>
          </li>
          <li>
            <p>
              <code>-incremental</code> Create an incremental backup.
            </p>
          </li>
          <li>
            <p>
              <code>-standalone</code> Create a standalone backup.
            </p>
          </li>
          <li>
            <p>
              <code>-keeplogfiles</code> Do not remove obsolete log files after the backup.
            </p>
          </li>
        </ul>
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e12183"/>12.7.4 Performance considerations</h4>
      <p>
        If you need to backup a lot of data, it will be faster to do so from the same JVM as the
        <nobr>X-Hive/DB</nobr> server.  This avoids sending all the data over a TCP connection.
      </p>
    </div>
    <div class="div3">
      <h4><a name="restoring_database"/>12.7.5 Restoring backups</h4>
      <p>
        You can restore backups using the API or the XHRestore tool, which is a simple wrapper for
        the API.  You must first restore a full backup.  Then you can restore any incremental
        backups in the order they were created.  By default, all files will be restored to the same
        location they were in when the backup was made.  To avoid accidents, existing files will not
        be overwritten.  You need to delete any existing database files manually before restoring a
        federation.  It is also possible to restore the federation to a new location on the same or
        a different machine.
      </p>
      <p>
        Warning: you should never start a server for a federation before restoring the last
        incremental backup.  The unintended interaction between new log records written by the
        server and old log records restored afterwards from the incremental backup will corrupt your
        data.
      </p>
      <p>
        Here is an example of restoring a federation from a backup file through the API:

        <div class="eg"><pre>
XhiveFederationFactoryIf federationFactory = XhiveDriverFactory.getFederationFactory();
FileInputStream in = new FileInputStream("backupfile");
federationFactory.restoreFederation(in.getChannel(), null, null);
</pre></div>
      </p>
    </div>
    <div class="div3">
      <h4><a name="xhrestore"/>12.7.6 The XHRestore tool</h4>
      <p>
        The XHRestore tool restores a backup from a single backup file (or stdin).  To restore a
        full backup and corresponding incremental backups, simply run the tool multiple times.  It
        is called as

        <div class="eg"><pre>
XHRestore [options]
</pre></div>
        and has the following command line options:
        <ul>
          <li>
            <p>
              <code>-help</code> Print usage information and exit.
            </p>
          </li>
          <li>
            <p>
              <code>-verbose</code> Be extra verbose
            </p>
          </li>
          <li>
            <p>
              <code>-debug</code> Print stack trace on exception
            </p>
          </li>
          <li>
            <p>
              <code>-version</code> Print version information and exit
            </p>
          </li>
          <li>
            <p>
              <code>-federation &lt;value&gt;</code> Specify the new bootstrap file location.  If
              not specified, the federation will be restored to the same location it was read from.
              Any relative paths in the original bootstrap file will be interpreted relative to the
              new bootstrap file.  Database files specified with absolute paths will be restored to
              their original location.
            </p>
          </li>
          <li>
            <p>
              <code>-file &lt;value&gt;</code> Specify the input file.  If not given, input will be
              read from standard input.
            </p>
          </li>
        </ul>
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e12279"/>12.7.7 Offline ("cold") backups</h4>
      <p>
        If no <nobr>X-Hive/DB</nobr> code is running, you can backup and restore your federation using any
        regular file backup and restore utility.  Of course, you can still use XHBackup using an
        in-JVM server by specifying the federation bootstrap file as the federation.
      </p>
      <p>
        You should never make a cold backup when <nobr>X-Hive/DB</nobr> code may be running on the federation,
        even if 'you know no transactions are open'.  The server could still flush dirty pages from
        the cache to the database files during the backup, which could result in inconsistent data
        in the backup files.
      </p>
    </div>
    <div class="div3">
      <h4><a name="suspend_disk_writes"/>12.7.8 Snapshot backups</h4>
      <p>
        If you have a low-level software or hardware method to take snapshots of the federation
        files you can use that to create backups.  After creating the snapshot, simply use any
        regular file backup utility to backup the federation files.  If desired, you can also use
        the <nobr>X-Hive/DB</nobr> backup API to create a backup of the snapshot.
      </p>
      <p>
        If the snapshot is really atomic, no special measures are required.  The disk image of the
        federation files is always in a consistent state (otherwise, crash recovery would not be
        possible).
      </p>
      <p>
        If the snapshot is not atomic (e.g., because you have to take snapshots of different
        filesystems to backup a federation), you can temporarily suspend all <nobr>X-Hive/DB</nobr> write
        activity to take a consistent snapshot of the federation.  This is possible using the
        <nobr>X-Hive/DB</nobr> API or the <code>XHSuspendDiskWrites</code> tool that is a simple wrapper around
        the API.  To use the API, please see the API docs for the methods
        <code>XhiveFederationIf.suspendDiskWrites(int options)</code> and
        <code>XhiveFederationIf.resumeDiskWrites</code>.
      </p>
      <p>
        The <code>XHSuspendDiskWrites</code> tool has the following options:
        <ul>
          <li>
            <p>
              <code>-help</code> Print usage information and exit.
            </p>
          </li>
          <li>
            <p>
              <code>-verbose</code> Be extra verbose
            </p>
          </li>
          <li>
            <p>
              <code>-debug</code> Print stack trace on exception
            </p>
          </li>
          <li>
            <p>
              <code>-version</code> Print version information and exit
            </p>
          </li>
          <li>
            <p>
              <code>-federation &lt;value&gt;</code> Specify the bootstrap file or remote server
            </p>
          </li>
          <li>
            <p>
              <code>-flush</code> Flush all dirty pages in the cache to disk.
            </p>
          </li>
          <li>
            <p>
              <code>-checkpoint</code> Take a (lightweight) checkpoint.  If used together with
              <code>-flush</code> the combination is a heavyweight checkpoint.  If creating a backup
              while disk writes are suspended, this makes sure that redo recovery is not necessary
              after restoring the backup.  On a replicator, this option is ignored.  Replicators
              cannot take independent checkpoints.
            </p>
          </li>
          <li>
            <p>
              <code>-sync</code> Flush all files to disk.  Useful if you use a low level backup
              mechanism that bypasses the operating system when copying the federation files.
            </p>
          </li>
          <li>
            <p>
              <code>-resume</code> Resume disk writes after suspension.
            </p>
          </li>
        </ul>
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e12408"/>12.7.9 Storing individual libraries and documents</h4>
      <p>
        You can store individual libraries and documents together with all their metadata like
        indexes, versions and authority information.  This is called serialization.  It stores the
        data in an internal, binary format.  The process is unrelated to online backups and has
        several differences from it:
        <table border="1">
          <thead>
            <tr>
              <th rowspan="1" colspan="1">Online backups</th>
              <th rowspan="1" colspan="1">Serialization</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td rowspan="1" colspan="1">Backup complete federation</td>
              <td rowspan="1" colspan="1">Store individual libraries or documents</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Does not use locks or transactions</td>
              <td rowspan="1" colspan="1">Read locks are taken on serialized data</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Fast</td>
              <td rowspan="1" colspan="1">Less fast</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Restore without running server</td>
              <td rowspan="1" colspan="1">Deserialize with running server</td>
            </tr>
            <tr>
              <td rowspan="1" colspan="1">Restores exactly the same federation contents</td>
              <td rowspan="1" colspan="1">Allows deserialization to different federation, database or parent library</td>
            </tr>
          </tbody>
        </table>
      </p>
      <p>
        Serialization and deserialization can be done using the administrator client or using the
        API calls
        <ul>
          <li>
            <p>
              <code>XhiveLibraryChildIf.serialize(OutputStream out)</code> to serialize a library
              child to an output stream.
            </p>
          </li>
          <li>
            <p>
              <code>XhiveLibraryIf.deserialize(InputStream in)</code> to deserialize a library
              child, making it a child of the calling library.
            </p>
          </li>
          <li>
            <p>
              <code>XhiveDatabaseIf.deserializeRootLibrary(InputStream in)</code> to deserialize a
              library, making it the root library of the calling database.
            </p>
          </li>
        </ul>
        See also the API docs for more information on these methods.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="using_ssl"/>12.8 Using Secure Socket Layer (SSL)</h3>
    <p>
      For maximum security, you can run <nobr>X-Hive/DB</nobr> over an SSL connection.  Because all the data is
      encrypted, this has a severe performance impact.  This section contains instructions on how to
      do so.  It is assumed you are familiar with basic JSSE administration like using
      <code>keytool</code> to set up a keystore and truststore.
    </p>
    <div class="div3">
      <h4><a name="d1e12525"/>12.8.1 Server side setup</h4>
      <p>
        If you use the XHServer tool, you can specify the <code>-ssl</code> command line option.
        This will create an SSL server socket instead of a regular server socket to listen to on the
        specified port.  If you want to use SSL client authentication, also specify the
        <code>-clientauth</code> option.  You can specify system properties (e.g., for the default
        keystore) in the usual Java way: <code>-Djavax.net.ssl.keyStore=keystore</code>.  If you
        need to do anything more complicated (use your own key manager, specify cipher suites, etc),
        you will have to use the API directly.
      </p>
      <p>
        When starting an <nobr>X-Hive/DB</nobr> server through the
        <code>XhiveDriverIf.startListenerThread()</code> API, you have to pass a
        <code>java.net.ServerSocket</code> to listen to.  To use SSL, simply pass a
        <code>javax.net.ssl.SSLServerSocket</code> that has been created with any required options.
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e12555"/>12.8.2 Client side setup</h4>
      <p>
        To use SSL in the client, as the <code>xhive.bootstrap</code> property or as the argument to
        <code>XhiveDriverFactory.getDriver()</code> specify a URL of the form
        <code>xhives://</code><var>host</var><code>:</code><var>port</var>.  The system will use the
        default <code>SSLSocketFactory</code> to connect to the <nobr>X-Hive/DB</nobr> server.  You may have to
        set the usual JSSE system properties programatically or on the Java command line.
      </p>
      <p>
        To do anything special (use your own trust manager, etc), pass the same
        URL to <code>XhiveDriverFactory.getDriver()</code>, but also pass a
        <code>SocketFactory</code> to the <code>XhiveDriverIf.init(int cachePages, SocketFactory
        socketFactory)</code> call.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="readonly_federation"/>12.9 Readonly federations (CDROM usage)</h3>
    <p>
      You may want to distribute an <nobr>X-Hive/DB</nobr> application with a federation on readonly media, like
      a CDROM.  To facilitate such usage, <nobr>X-Hive/DB</nobr> has some special features for readonly
      federations.
    </p>
    <p>
      If the bootstrap file is a readonly file, the <nobr>X-Hive/DB</nobr> code considers the federation to be
      readonly.  This could be because the bootstrap file is on readonly media, but also if it has
      been marked readonly in another way.  A readonly federation is treated differently in the
      following ways:
      <ul>
        <li>
          <p>
            No existing log files are opened, nor are any new ones created.  If you copy a
            federation to a CDROM, you can safely leave out the logfiles and only copy the bootstrap
            file and the database files.  You should only create such a copy if the <nobr>X-Hive/DB</nobr> server
            is not running and has been shut down cleanly.  A clean shutdown allows the server to
            write all modified pages back to disk, so that recovery on startup (using the federation
            log files) is not needed.
          </p>
        </li>
        <li>
          <p>
            The bootstrap file is not locked.  You can safely run multiple <nobr>X-Hive/DB</nobr> applications
            using the same readonly federation.
          </p>
        </li>
      </ul>
    </p>
    <p>
      You cannot modify any data in a readonly federation.  You can, however, create temporary data
      like old versions of documents or new nodes in XQuery queries if you use a RAM segment to do
      so.  A RAM segment is a special kind of database segment.  All currently allocated pages of
      such a segment are kept in the database cache and are never written to any database files.
      This means you should not create more temporary data than fits in the database cache.  Also,
      if a large part of the cache is used to store temporary data, performance may suffer due to
      lack of cache pages for other usages.  You can set a database to use a RAM segment for
      temporary data using the administrator client or with the API using code like

      <div class="eg"><pre>
XhiveDatabaseIf database = session.getDatabase();
database.setTemporaryDataSegment(XhiveDatabaseIf.RAM_SEGMENT_NAME);
</pre></div>
    </p>
  </div>
  <div class="div2">
    <h3><a name="federation_sets"/>12.10 Federation sets</h3>
    <p>
      Federation sets are a way to simplify running multiple federations in a single server, using a
      single page cache and TCP port. A federation set is a simple XML file that lists the
      federations in it. The <code>com.xhive.federationset.interfaces</code> package contains
      methods to manipulate a federation set description file and to get <code>XhiveDriverIf</code>
      objects and/or start servers for the federations in the set. These methods use only the public
      <nobr>X-Hive/DB</nobr> API internally.
    </p>
    <div class="div3">
      <h4><a name="d1e12642"/>12.10.1 Creating federation sets</h4>
      <p>
        There are several ways to create a federation set description file and add federations to
        it:
      </p>
      <ul>
        <li>
          <p>
            Using the API:
            <div class="eg"><pre>
String filename = ...;
XhiveFederationSetFactory.createFederationSet(filename);
XhiveFederationSetIf fs = XhiveFederationSetFactory.getFederationSet(filename, null);
Map&lt;String, String&gt; federations = fs.getFederationMap();
federations.put("fdname", "/path/to/bootstrapfile");
</pre></div>
          </p>
        </li>
        <li>
          <p>
            With the XHFSTool utility:
            <div class="eg"><pre>
XHFSTool create filename
XHFSTool addfd filename -name fdname -value /path/to/bootstrapfile
</pre></div>
          </p>
        </li>
        <li>
          <p>
            Using the admin client. Click on "Create federation set" in the "Federation sets" menu
            and enter the filename of the federation set description file to be created. Then use
            "Modify federation set" and add the federation.
          </p>
        </li>
      </ul>
      <p>
        Initially, the federation set contains no federations. You can add any desired federations
        by specifying the bootstrap file or (for remote federations) the uri. Adding a federation to
        a federation set and creating a federation are separate unrelated actions. A federation does
        not have to exist to be added to a federation set.
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e12681"/>12.10.2 Using federation sets</h4>
      <p>
        Once you have created a federation set, you can run it in a separate server or internally in
        the application JVM. Like with single federations, the latter option is more efficient. A
        federation set server can be started by running the <code>XHServer</code> tool.
            <div class="eg"><pre>
XHServer -federationset /path/to/federationset -port 1235 -cache 4096
</pre></div>
        Your application code will then look like
            <div class="eg"><pre>
XhivePageCacheIf = XhiveDriverFactory.getFederationFactory().createPageCache(4096);
XhiveFederationSetIf fs = XhiveFederationSetFactory.getFederationSet("xhive://hostname:1235/");
XhiveDriverIf driver = fs.getFederation("fdname");
// Use driver normally, e.g., create session on it
</pre></div>
        To use a federation set internally, do not start the federation set server. In your
        application code, only the uri of the federation set needs to change.
            <div class="eg"><pre>
XhivePageCacheIf = XhiveDriverFactory.getFederationFactory().createPageCache(4096);
XhiveFederationSetIf fs = XhiveFederationSetFactory.getFederationSet("/path/to/federationset");
XhiveDriverIf driver = fs.getFederation("fdname");
// Use driver normally, e.g., create session on it
</pre></div>
        All federations in the federation set will share the single page cache.
      </p>
    </div>
  </div>
</div>

    

<div class="div1">
  <h2><a name="replication"/>13 Replication</h2>
  <p>
    This chapter deals with replication of <nobr>X-Hive/DB</nobr>. 
  </p>
  <p>
    Besides the information provided in this manual there is also a 
    <a href="http://support.x-hive.com/documentation" target="_new">tutorial</a>
    describing how you would set up a full replica of an application.
  </p>
  <div class="div2">
    <h3><a name="replication_intro"/>13.1 Introduction</h3>
    <p>
      <nobr>X-Hive/DB</nobr> supports lazy primary copy replication.  Primary copy means that updates are
      performed on a single federation (known as the primary copy or master) and propagated to the
      copies (also known as secondary copies, replicas or slaves).  Readonly transactions and online
      backups can be performed on the replicas to distribute query load.  Lazy means that the master
      does not wait for a transaction to propagate to the replicas before confirming a transaction
      commit.  The replicas are updated asynchronously in the background.
    </p>
    <p>
      Replication works by sending the federation log files to the replicators.  The replicators
      read the log files and redo all updates in their copy of the data.
    </p>
  </div>
  <div class="div2">
    <h3><a name="replica_creation"/>13.2 Creating a replica</h3>
    <p>
      There are several ways to create a replica from a federation.  Before you do this, the
      replicator must be given a name that is registered with the master.  This tells the master
      that a replica will be added, which will make the master preserve any required federation log
      files until the replica (to be created) has confirmed their receival.
    </p>
    <p>
      Registering a replicator can be done with the administrator client or the
      <code>registerReplicator</code> method of the <code>XhiveFederationIf</code> interface.  After
      registering the replicator, create a copy of the federation using any of the following
      methods:
    </p>
    <ol>
      <li>
        <p>
          If you are sure that no server is running for the federation, you can simply copy all the
          federation files using a system file copy command and/or FTP or such to move them to
          another machine.  Do not do this while a server is running for the original federation,
          this will corrupt the data in the replica.
        </p>
      </li>
      <li>
        <p>
          You can create a full online backup, using the <code>XHBackup</code> tool, the
          administrator client or the <code>XhiveFederationIf.backup</code> API.  The backup must be
          made after registering the replicator.  Then restore the backup on the desired machine for
          the replica.
        </p>
      </li>
      <li>
        <p>
          You can create a copy of an online federation directly using the administrator client or
          the <code>XhiveFederationIf.replicateFully</code> API.  If desired, the replicated
          federation can then be moved to another machine by any of the usual means, like FTP.
          Alternatively, you can simply run the procedure on the destination machine, connecting to
          the original server remotely. A tool called <code>XHCreateReplica</code> is provided to make
          it easy to create a replica (including the creation of a replica-id) on a replicating host,
          you can also do it with the administrator client.
        </p>
      </li>
    </ol>
  <p>
    First registering a replicator name with the master
    and then creating the copy of the federation implies this replicator name
    gets registerd with the copy also. Therefore the replicator server
    will also preserve its log records for yet another replicator with this
    name, unless you unregister this name with the copy.
  <p>
  </p>
    The administrator client or the <code>XHCreateReplica</code> tool
    can be used to unregister the replicator name with the copy.
  </p>
  </div>
  <div class="div2">
    <h3><a name="running_replicator"/>13.3 Running a replicator</h3>
    <p>
      As with the master server, there are two different ways to run the replicator.
    </p>
    <div class="div3">
      <h4><a name="replicator_dedicated"/>13.3.1 Dedicated server</h4>
      <p>
        You can run a dedicated <nobr>X-Hive/DB</nobr> server with the <code>XHServer</code> command.  To run it
        as a replicator, you need to give two extra options:
      </p>
      <p>
        <code>-master xhive://</code><var>host</var><code>:</code><var>port</var> to pass the
        location of the master server.  The connection uses the same port as regular client
        connections.  As with client connections, you can use a protocol identifier of
        <code>https</code> to create an SSL connection to the master.
      </p>
      <p>
        <code>-replicator </code><var>replicatorId</var> to pass the name of this replicator.  This
        must be a name that has been registered with the master (see above).
      </p>
      <p>
        The replicator will run as a server, duplicating all updates at the master.  Clients can
        connect to the server for readonly queries and online backups.
      </p>
    </div>
    <div class="div3">
      <h4><a name="d1e12838"/>13.3.2 Internal server</h4>
      <p>
        If you want to use the replicator for queries, not only for failover capability, it is more
        efficient to use an internal server for the replicator.  You can start an internal
        replicator server using the API like in this example:
      </p>
      <div class="eg"><pre>
XhiveDriverIf driver = XhiveDriverFactory.getDriver("/xhive/replica/XhiveDatabase.bootstrap");
driver.configureReplicator("xhive://masterhost:1234", "myReplicator");
driver.init(1024);
</pre></div>
      <p>
        You can then create sessions on this driver object normally, except that these sessions will
        only be able to perform readonly transactions.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="readonly_replicator_usage"/>13.4 Readonly usage of replicators</h3>
    <div class="div3">
      <h4><a name="replicator_temporary_data"/>13.4.1 Temporary data</h4>
      <p>
        Readonly transactions can create temporary data like new nodes in XQuery queries or old
        versions of versioned documents.  Because all data in normal segments is updated by the
        replication mechanism, these segments cannot be used to allocate temporary data at the
        replica.  Therefore, to use temporary data in the replica, you have to create a temporary
        data segment and set the database to use that segment for temporary data.  Updates to that
        segment for temporary data at the master are not logged, and therefore not replicated.  This
        means that the replicator can safely use the segment for its own (completely different)
        temporary data.
      </p>
      <p>
        Alternatively, you can set the database to use a RAM segment for temporary data.  This is
        only useful if you have enough cache pages to hold the temporary data of all simultaneous
        sessions, with some cache space to spare for other usages.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="replica_removal"/>13.5 Removing a replica</h3>
    <p>
      Removing a replica can be done simply by stopping its replication server and removing the
      files.  Once you have done this, you must unregister the replicator with the master.  This
      tells the master that it no longer has to preserve the log records for this replica.  If you
      do not do this, the master will preserve obsolete log files forever, hoping that the
      replicator will connect once more.  Unregistering a replicator can be done with the
      administrator client or the <code>XhiveFederationIf.unregisterReplicator</code> method.
    </p>
  </div>
  <div class="div2">
    <h3><a name="federation_metadata"/>13.6 Federation metadata</h3>
    <p>
      Federation metadata is data that is stored in the federation bootstrap file.  Not all of this
      data is replicated, because it may be necessary to use different settings at the different
      copies of the federation.
    </p>
    <div class="div3">
      <h4><a name="replicated_metadata"/>13.6.1 Replicated metadata</h4>
      <p>
        The superuser password and the license key can only be updated at the master and are
        replicated to the secondary copies automatically.
      </p>
      <p>
        Creation and removal of databases, segments and files will also be replicated.  By default,
        the replica will use the same path to the file as the original.  Relative paths are always
        interpreted relative to the bootstrap file.  Your system configuration may require using
        different paths on the primary and secondary copies.  If your system supports symbolic
        links, it is usually easiest to use those to point to the desired actual directories.
        Otherwise, you can use a path mapper.  See the API documentation.
      </p>
    </div>
    <div class="div3">
      <h4><a name="unreplicated_metadata"/>13.6.2 Metadata not replicated</h4>
      <p>
        Updates to the keep-log-files option are not replicated.  It can be set independently at the
        master and the replicas.  This is useful if you want to use only one of them to create
        incremental backups.  In that case, you should only set the option to true at that copy.
      </p>
      <p>
        Registering and unregistering of replicators can be done at any copy and is not itself
        replicated.  Registering replicator X at replicator Y will make replicator Y retain its log
        records until the registered replicator X has confirmed their receival to the master.  This
        is useful if replicator X may have to take over the role of master for replicator Y.
      </p>
    </div>
  </div>
  <div class="div2">
    <h3><a name="moving_master"/>13.7 Moving the master copy</h3>
    <div class="div3">
      <h4><a name="master_failure"/>13.7.1 Failure of the master server</h4>
      <p>
        If the master copy fails for any reason (e.g., a hardware failure), one of the replicas can
        take over the role of the master.  <nobr>X-Hive/DB</nobr> does not provide tools to detect failure,
        because for the recommended setup of an application server with an internal <nobr>X-Hive/DB</nobr> server
        an <nobr>X-Hive/DB</nobr> specific tool would be useless.  You will have to detect failure of your
        application as a whole (including the <nobr>X-Hive/DB</nobr> server) and initiate failover.
      </p>
      <p>
        If there is only one replica, it can take over the role of the master simply by stopping the
        replicator and starting a regular (dedicated or internal) <nobr>X-Hive/DB</nobr> server.  If desired,
        this can be done using the API like

        <div class="eg"><pre>
driver.close();
driver.configureReplicator(null, null);
driver.init(cachePages);
</pre></div>

        The new master will automatically perform any still necessary updates of log records already
        transferred and rollback any updates of uncommitted transactions.
      </p>
      <p>
        If there are any other replicators, you will have to stop them and restart them with the URL
        of the new master server.  You should have registered those replicators with the new master
        before the failure.
      </p>
      <p>
        Once the old failed master is back up again, you can have it take over the role of the
        master.  To do so, you will first have to do a full replication back from the new master and
        configure the old master as a replica.  This has to be done even if the data of the old
        master has been preserved.  The reason is that the old master may have done updates that
        were not yet replicated at the moment of failure.  These can interfere with the updates that
        were done at the new master, which can corrupt your data.  Once the old master is now
        running as a replicator, use the procedure for scheduled master movement below.
      </p>
    </div>
    <div class="div3">
      <h4><a name="scheduled_moving"/>13.7.2 Scheduled moving of the master copy</h4>
      <p>
        You may want to move the role of master copy to one of the replicas, e.g. because you have
        to bring down the master server.  To turn a master copy into a replica, it first has to be
        synchronized with the replica that is to be the new master.  To do so, it is necessary to
        shut down the master copy specifying the replica that is to be the new master.
        This can be done with the administrator client,
        the <code>XHServer</code> tool (see below) or
        the <code>XhiveFederationIf.shutdown(...)</code> API.
      </p>
      <p>
        After the old and new master have been synchronized in this way, you can start a regular
        (master) server on the new master and (when desired) a replicator server on the old master.
      </p>
      <p>
        The <code>XHServer</code> tool can also be used to shutdown a server.

        <div class="eg"><pre>
XHServer -shutdown -help
XHServer -shutdown -federation master-url -wait "id1, id2" superuserpwd
XHServer -shutdown -federation master-url -wait "" superuserpwd
</pre></div>
        The <code>-wait</code> option is not required.
        The <code>XHServer</code> tool will
        synchronize the master with all registered replicators by default.
        Otherwise it will only synchronize with the replicators listed.
        In order not to wait for any replicators, you may pass an empty string
        as the value for the <code>-wait</code> option.
      </p>
    </div>
  </div>
</div>





	</div>
	
	
	
</body></html>